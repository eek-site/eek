<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile Mechanics NZ - 30-60 Minute Response | Eek Mobile Mechanical</title>
  <meta name="description" content="Eek Mobile Mechanical offers nationwide mobile mechanic services including pre-purchase inspections, wrong fuel rescue, jump starts, and roadside repairs. Target arrival: 30-60 minutes NZ-wide. Call 0800 769 000 now." />
  <meta name="keywords" content="mobile mechanic, mobile mechanics NZ, roadside mechanic, jump start service, fuel drain, wrong fuel, pre purchase inspection, emergency mechanic, mobile car repair, NZ mechanics" />
  <meta property="og:title" content="Mobile Mechanics NZ - 30-60 Minute Response | Eek Mobile Mechanical" />
  <meta property="og:description" content="Nationwide mobile mechanic service ‚Äì inspections, battery help, fuel rescue, roadside repairs. 30-60 minute average arrival time. Call 0800 769 000." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.eek.nz" />
  <meta property="og:image" content="https://www.eek.nz/og-image.jpg" />

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self';
script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net https://widget.reviewability.com;
style-src 'self' 'unsafe-inline' https://widget.reviewability.com;
img-src 'self' data: https: https://app.revu.cloud https://widget.reviewability.com;
connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://conversions-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com https://www.googleadservices.com https://www.google.hn https://app.revu.cloud https://widget.reviewability.com https://www.eek.nz https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com;
frame-src 'self' https://td.doubleclick.net https://www.googletagmanager.com https://app.revu.cloud https://widget.reviewability.com;
font-src 'self' data:;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <!-- Reddit Pixel -->
  <script>
    !function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}
    (window,document);
    
    // Helper functions to extract user data if available
    function getEmailFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const emailParam = urlParams.get('email');
      if (emailParam) return emailParam;
      
      const emailInputs = document.querySelectorAll('input[type="email"], input[name*="email"], input[id*="email"]');
      for (let input of emailInputs) {
        if (input.value && input.value.includes('@')) {
          return input.value;
        }
      }
      return null;
    }
    
    function getPhoneFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const phoneParam = urlParams.get('phone');
      if (phoneParam) return phoneParam;
      
      const phoneInputs = document.querySelectorAll('input[type="tel"], input[name*="phone"], input[id*="phone"]');
      for (let input of phoneInputs) {
        if (input.value) {
          return input.value;
        }
      }
      return null;
    }
    
    function getUserId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('uid') || urlParams.get('user_id') || urlParams.get('customer_id');
    }
    
    function getMobileIds() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        idfa: urlParams.get('idfa'),
        aaid: urlParams.get('aaid')
      };
    }
    
    const mobileIds = getMobileIds();
    const initConfig = {};
    
    const email = getEmailFromForm();
    const phoneNumber = getPhoneFromForm();
    const externalId = getUserId();
    
    if (email) initConfig.email = email;
    if (phoneNumber) initConfig.phoneNumber = phoneNumber;
    if (externalId) initConfig.externalId = externalId;
    if (mobileIds.idfa) initConfig.idfa = mobileIds.idfa;
    if (mobileIds.aaid) initConfig.aaid = mobileIds.aaid;
    
    rdt('init', 'a2_hf16791nsdhx', Object.keys(initConfig).length > 0 ? initConfig : undefined);
    rdt('track', 'PageVisit');
  </script>

  <!-- Google tag (gtag.js) for Google Ads Conversion Tracking -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084465163"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17084465163');
    gtag('config', 'G-DQNKF1YLWR');
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Eek Mobile Mechanical",
    "description": "Mobile mechanic services across New Zealand. Pre purchase vehicle inspections, wrong fuel removal, petrol and diesel removal, emergency roadside repairs.",
    "telephone": "+64800769000",
    "url": "https://www.eek.nz",
    "image": "https://www.eek.nz/brand-image.png",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "NZ"
    },
    "areaServed": {
      "@type": "Country",
      "name": "New Zealand"
    },
    "openingHours": [
      "Mo 07:00-17:00",
      "Tu 07:00-17:00", 
      "We 07:00-17:00",
      "Th 07:00-17:00",
      "Fr 07:00-17:00",
      "Sa 07:00-12:00",
      "Su 07:00-12:00"
    ],
    "serviceType": [
      "Mobile Mechanic",
      "Pre Purchase Vehicle Inspections", 
      "Wrong Fuel Removal",
      "Petrol and Diesel Removal",
      "Emergency Roadside Repairs",
      "Battery Jump Start",
      "Trailer Repairs"
    ]
  }
  </script>

  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0 0 80px 0;
      color: #333;
      text-align: center;
    }
    header {
      background: #ffffff;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .business-name {
      font-size: 2.5em;
      font-weight: bold;
      color: #ff5500;
      margin: 0.3em 0;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    header img {
      max-width: 300px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.8em;
      margin: 0.5em 0 0.2em;
      color: #333;
    }
    p.tagline {
      font-size: 1.2em;
      color: #666;
    }

    /* After Hours Emergency Banner */
    .after-hours-banner {
      background: linear-gradient(135deg, #ff3333, #ff5500);
      color: white;
      padding: 20px;
      margin: 0 auto 20px;
      max-width: 800px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(255,51,51,0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 4px 12px rgba(255,51,51,0.3); }
      50% { box-shadow: 0 4px 20px rgba(255,51,51,0.5); }
    }

    .after-hours-banner h2 {
      margin: 0 0 10px 0;
      font-size: 1.6em;
    }

    .after-hours-banner p {
      margin: 10px 0;
      font-size: 1.1em;
    }

    .emergency-btn {
      display: inline-block;
      background: rgba(255,255,255,0.25);
      color: white;
      padding: 15px 30px;
      margin: 10px;
      font-size: 1.3em;
      border-radius: 8px;
      text-decoration: none;
      border: 2px solid white;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .emergency-btn:hover {
      background: white;
      color: #ff3333;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    .hours-section {
      background: #e8f4f8;
      padding: 15px;
      margin: 20px auto;
      border-radius: 8px;
      border-left: 4px solid #ff5500;
      max-width: 800px;
    }
    .hours-section h3 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .hours-text {
      font-size: 1.1em;
      color: #555;
      font-weight: bold;
    }
    .after-hours-text {
      font-size: 1em;
      color: #ff3333;
      font-weight: bold;
      margin: 10px 0;
    }
    .cta-button {
      display: inline-block;
      background-color: #ff5500;
      color: white;
      padding: 15px 25px;
      margin: 20px auto;
      font-size: 1.2em;
      border-radius: 8px;
      text-decoration: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    .services {
      background: #ffffff;
      margin: 20px auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      max-width: 800px;
    }
    .services h2 {
      color: #222;
    }
    .services ul {
      list-style: none;
      padding: 0;
      font-size: 1.1em;
    }
    .services li {
      padding: 8px 0;
    }
    .keywords-highlight {
      background: linear-gradient(135deg, #ff5500, #ff7733);
      color: white;
      padding: 25px;
      margin: 20px auto;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 800px;
    }
    .keywords-highlight h2 {
      margin-top: 0;
      color: white;
    }
    .service-keywords {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .keyword-item {
      background: rgba(255,255,255,0.15);
      padding: 15px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .keyword-item:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .keyword-item h4 {
      margin: 0 0 8px 0;
      font-size: 1.1em;
    }
    .keyword-item p {
      margin: 0;
      font-size: 0.9em;
      opacity: 0.9;
    }

    /* RevU widget container styling */
    .services [data-bid] {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
      margin-top: 15px;
    }

    /* Style the RevU widget content */
    .services [data-bid] * {
      max-width: 100% !important;
      box-sizing: border-box;
    }

    footer {
      font-size: 0.9em;
      color: #999;
      padding: 20px 0;
    }
    .sticky-call, .sticky-payment {
      position: fixed;
      bottom: 15px;
      right: 15px;
      background-color: #ff5500;
      color: white;
      font-size: 1.1em;
      padding: 14px 20px;
      border-radius: 50px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      text-decoration: none;
      z-index: 999;
    }
    .sticky-payment {
      right: 150px;
      display: none;
    }

    @media (max-width: 768px) {
      .service-keywords {
        grid-template-columns: 1fr;
      }
      
      .business-name {
        font-size: 2em;
      }
      
      header {
        margin: 0 10px;
      }
      
      .hours-section, .keywords-highlight, .services {
        margin: 20px 10px;
      }
    }
  </style>
</head>
<body>

<!-- Business Closed Banner (hidden by default) -->
<div id="closedBanner" class="after-hours-banner" style="display: none; background: linear-gradient(135deg, #666, #888);">
  <h2 id="closedTitle">üïê CURRENTLY CLOSED</h2>
  <div id="afterHoursMessage">
    <p><strong>Business Hours:</strong></p>
    <p>Monday - Friday: 7:00 AM - 5:00 PM</p>
    <p>Saturday - Sunday: 7:00 AM - 12:00 PM</p>
    <p>Please call during business hours or book online for next available service</p>
  </div>
  <div id="tempUnavailableMessage" style="display: none;">
    <p><strong>We're currently experiencing high demand</strong></p>
    <p>Our mechanics are fully dispatched on emergency calls</p>
    <p>Please book online for the next available appointment or try calling again shortly</p>
    <a href="#service-selection" class="emergency-btn" style="background: rgba(255,255,255,0.25); margin-top: 10px;">üìÖ Book Online Now</a>
  </div>
</div>

<section id="stripePaymentBlock" style="display: none; background-color: #ffffff; padding: 20px; text-align: center; color: #333; border-bottom: 2px solid #ff5500;">
  <div style="background-color: #f5f5f5; padding: 30px; border-radius: 12px; max-width: 700px; margin: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.05);">
    <h1 style="font-size: 2.2em; margin-bottom: 0.5em;">Secure Roadside Payment</h1>
    <p style="font-size: 1.2em; margin-bottom: 1.5em;">Confirm your payment to get help on the way ‚Äî fast, safe, and secure.</p>
    <label style="font-size: 1.1em; display: inline-flex; align-items: center; gap: 10px; color: #333;">
      <input type="checkbox" id="termsCheckbox" style="transform: scale(1.5);" />
      <span>I agree to the Eek Mobile Mechanical terms of service 
        <a href="https://www.eek.nz/terms" target="_blank" style="color: #ff5500; text-decoration: underline;">
          View terms of use
        </a>
      </span>
    </label>
    <br><br>
    <button id="payNowButton" style="display: none; background-color: #ff5500; color: white; padding: 14px 32px; font-size: 1.2em; border: none; border-radius: 8px; cursor: pointer;">
      Pay Now
    </button>
  </div>
</section>

<header>
  <img src="brand-image.png" alt="Eek Mobile Mechanical - Mobile Mechanic Services" />
  <div class="business-name">Eek Mobile Mechanical</div>
  <h1>Mobile Mechanics NZ - 30-60 Minute Response</h1>
  <p class="tagline">Mobile Mechanic ‚Ä¢ Pre Purchase Inspections ‚Ä¢ Wrong Fuel Removal ‚Ä¢ Emergency Roadside Repairs ‚Ä¢ 30‚Äì60 Min Response</p>
  <a class="cta-button" href="tel:0800769000" onclick="trackConversion('header_call', 'Contact')">üìû Call 0800 769 000</a>
  
  <!-- DEBUG: Test button to verify Power Automate connection -->
  <button onclick="testWebhook()" style="background: red; color: white; padding: 10px; margin: 10px;">TEST WEBHOOK</button>
</header>

<div class="keywords-highlight" id="service-selection">
  <h2>üîß Professional Mobile Mechanic Services</h2>
  <p>Eek Mobile Mechanical providing comprehensive mobile mechanic services across New Zealand</p>
  <div class="service-keywords">
    <a href="#mobile-mechanic-breakdown" style="text-decoration: none; color: inherit;">
      <div class="keyword-item">
        <h4>Emergency Breakdown</h4>
        <p>Professional mechanics arrive in 30-60 minutes anywhere in NZ</p>
      </div>
    </a>
    <a href="#battery-jump-start" style="text-decoration: none; color: inherit;">
      <div class="keyword-item">
        <h4>Battery Jump Start</h4>
        <p>Dead battery? We'll get you started in 30-60 minutes</p>
      </div>
    </a>
    <a href="#wrong-fuel-removal" style="text-decoration: none; color: inherit;">
      <div class="keyword-item">
        <h4>Wrong Fuel Removal</h4>
        <p>Emergency fuel rescue service - 30-60 minute response</p>
      </div>
    </a>
    <a href="#pre-purchase-inspections" style="text-decoration: none; color: inherit;">
      <div class="keyword-item">
        <h4>Pre Purchase Inspections</h4>
        <p>45-point certified inspection - 30-60 minute arrival</p>
      </div>
    </a>
    <a href="#winz-assistance" style="text-decoration: none; color: inherit;">
      <div class="keyword-item" style="background: rgba(255,255,255,0.25); border: 2px solid white;">
        <h4>‚≠ê WINZ Approved Quotes</h4>
        <p>Get instant quotes for Work and Income vehicle repair assistance</p>
      </div>
    </a>
  </div>
</div>

<div class="services" id="mobile-mechanic-breakdown">
  <h2>Mobile Mechanic Emergency Breakdown Service ‚Äì Target Arrival: 30‚Äì60 Minutes</h2>
  <p>Engine won't start? Warning lights? Our professional mobile mechanic team arrives fast and diagnoses the issue on-site anywhere in New Zealand.</p>
  <ul>
    <li>üõ†Ô∏è Professional mobile mechanic fault detection & diagnostic scanning</li>
    <li>üîç On-site assessment and minor repairs</li>
    <li>üìç Mobile mechanic coverage anywhere in NZ‚Äîcity or rural</li>
    <li>üß∞ Mobile mechanics arrive equipped with full professional toolkits</li>
    <li>üìû Real-time communication with mobile mechanic support staff</li>
    <li>‚è±Ô∏è Target arrival: 30‚Äì60 minutes nationwide</li>
  </ul>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px;">
    <a class="cta-button normal-hours-btn" href="tel:0800769000" onclick="trackConversion('breakdown_call', 'Contact')">üìû Call 0800 769 000</a>
    <a class="cta-button after-hours-btn" href="https://www.eek.nz/book-service?service=mechanic" style="background: #28a745; display: none;">üìÖ Book Online</a>
  </div>
</div>

<div class="services" id="battery-jump-start">
  <h2>Mobile Mechanic Battery Service ‚Äì Jump Start in 30‚Äì60 Minutes</h2>
  <p>Dead battery? Our professional mobile mechanic team comes to you and performs a safe, professional jump‚Äëstart service.</p>
  <ul>
    <li>üîã Mobile mechanic service compatible with all makes/models</li>
    <li>‚ö° Includes battery voltage & health check by qualified mechanics</li>
    <li>üß∞ Safe jump‚Äëstart equipment & professional procedures</li>
    <li>üìç Mobile mechanic service at your location‚Äîhome or roadside</li>
  </ul>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px;">
    <a class="cta-button normal-hours-btn" href="tel:0800769000" onclick="trackConversion('battery_call', 'Contact')">üìû Call 0800 769 000</a>
    <a class="cta-button after-hours-btn" href="https://www.eek.nz/book-service?service=jumpstart" style="background: #28a745; display: none;">üìÖ Book Online</a>
  </div>
</div>

<div class="services" id="wrong-fuel-removal">
  <h2>Wrong Fuel Removal ‚Äì Petrol and Diesel Removal Emergency Service ‚Äì Target Arrival: 30‚Äì60 Minutes</h2>
  <p>Filled with petrol instead of diesel? Our mobile mechanic specialists provide immediate wrong fuel removal and petrol and diesel removal services. Don't start the engine!</p>
  <ul>
    <li>‚õΩ Professional petrol and diesel removal on-site</li>
    <li>üßØ Fully insured wrong fuel removal process</li>
    <li>üõª No towing needed, saves time & money</li>
    <li>üìç Trusted mobile mechanic wrong fuel rescue NZ‚Äëwide</li>
    <li>üö® Emergency petrol and diesel removal service</li>
    <li>‚è±Ô∏è Target arrival: 30‚Äì60 minutes nationwide</li>
  </ul>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px;">
    <a class="cta-button normal-hours-btn" href="tel:0800769000" onclick="trackConversion('fuel_drain_call', 'Contact')">üìû Call 0800 769 000</a>
    <a class="cta-button after-hours-btn" href="https://www.eek.nz/book-service?service=fuel-extraction" style="background: #28a745; display: none;">üìÖ Book Online</a>
  </div>
</div>

<div class="services" id="pre-purchase-inspections">
  <h2>Pre Purchase Vehicle Inspections ‚Äì Target Arrival: 30‚Äì60 Minutes</h2>
  <p>Need peace of mind before buying a car? Our certified mobile mechanic team performs comprehensive pre purchase vehicle inspections at any location across New Zealand.</p>
  <ul>
    <li>üßæ Comprehensive 45-point certified mechanical inspection</li>
    <li>üìç Inspection at seller or dealership location</li>
    <li>üí∏ From $199 - best prices when you book ahead!</li>
    <li>‚è±Ô∏è Nationwide mobile mechanic dispatch in 30‚Äì60 minutes</li>
    <li>üìÖ Save money by booking online in advance</li>
    <li>‚úÖ Written report with price recommendation & upcoming cost estimates</li>
  </ul>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px;">
    <a class="cta-button normal-hours-btn" href="tel:0800769000" onclick="trackConversion('inspection_call', 'Contact')">üìû Call 0800 769 000</a>
    <a class="cta-button after-hours-btn" href="https://www.eek.nz/pre-purchase-vehicle-inspection/" style="background: #28a745; display: none;">üìÖ Book Online & Save</a>
  </div>
</div>

<!-- WINZ Assistance Section - Simplified service style -->
<div class="services" id="winz-assistance">
  <h2>WINZ Vehicle Repair Assistance ‚Äì Get Your Quote in Minutes</h2>
  <p>Eek Mobile Mechanical is a WINZ approved supplier. If you're receiving Work and Income support or facing financial hardship, we can help you access assistance for essential vehicle repairs.</p>
  <ul>
    <li>üí≥ WINZ approved supplier for vehicle repairs</li>
    <li>üîß Emergency repairs & WOF-related fixes covered</li>
    <li>üí∞ Assistance up to $400 for urgent repairs</li>
    <li>üìã Instant WINZ-compliant quotes online 24/7</li>
    <li>‚ö° Quick 1-2 day approval process</li>
    <li>üìç Mobile service - we come to you anywhere in NZ</li>
  </ul>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px;">
    <a class="cta-button" href="https://www.eek.nz/book-service?service=winz" onclick="trackConversion('winz_main_button', 'WINZ')" style="background: #6f42c1;">üí≥ Get WINZ Quote Now</a>
  </div>
  <p style="text-align: center; margin-top: 15px; color: #666; font-size: 0.9em;">
    Not sure if you qualify? Contact WINZ on 0800 559 009 or visit workandincome.govt.nz
  </p>
</div>

<!-- Customer Reviews Section -->
<div class="services">
  <h2>‚≠ê What Customers Say</h2>
  <p>Real, verified reviews from clients across New Zealand.</p>
  
  <!-- RevU Banner Widget -->
  <div data-bid="157676" data-url="https://app.revu.cloud" data-aid="23788">
    <script src="https://widget.reviewability.com/js/widgetAdv.min.js" async></script>
  </div>
</div>

<a id="stripePaymentSticky" class="sticky-payment" href="#">üí≥ Make Payment</a>

<footer>
  &copy; 2025 Eek Mobile Mechanical. All rights reserved. | 
  <a href="https://www.eek.nz/privacy" target="_blank" style="color: #666; text-decoration: underline;">Privacy Policy</a> | 
  <a href="https://www.eek.nz/more-options" style="color: #666; text-decoration: underline;">More Options</a>
</footer>

<a class="sticky-call" href="tel:0800769000" onclick="trackConversion('sticky_call', 'Contact')" id="stickyCallButton">üìû Call Eek Now</a>
<a class="sticky-call" href="#closedBanner" id="stickyClosedButton" style="display: none; background: #666;">üïê View Hours</a>

<script>
// Check system availability status
async function checkSystemStatus() {
  try {
    const response = await fetch("https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/17b1d2990e6f4082a2b0d9c2f1a29025/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=bPyoxJ24kuxJZOyLGAclGaEuH6BHwUTFaGmYOwHofa8", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({}),
      cache: "no-store"
    });
    
    if (response.ok) {
      const data = await response.json();
      return data.state === 'Active';
    }
  } catch (error) {
    console.error('Error checking system status:', error);
  }
  return true; // Default to active (phones visible) if check fails
}

// Function to check if current time is within business hours
function isWithinBusinessHours() {
  const now = new Date();
  const day = now.getDay(); // 0 = Sunday, 6 = Saturday
  const hour = now.getHours();
  const minutes = now.getMinutes();
  const time = hour + minutes / 60;
  
  // Monday-Friday: 7:00 AM - 5:00 PM
  if (day >= 1 && day <= 5) {
    return time >= 7 && time < 17;
  }
  
  // Saturday-Sunday: 7:00 AM - 12:00 PM
  if (day === 0 || day === 6) {
    return time >= 7 && time < 12;
  }
  
  return false;
}

// Update UI based on system status
async function updateHoursDisplay() {
  // CHECK IF PAYMENT TOKEN EXISTS - IF SO, DON'T MODIFY BUTTON VISIBILITY
  const urlParams = new URLSearchParams(window.location.search);
  const hasPaymentToken = urlParams.get('token');
  
  if (hasPaymentToken) {
    const closedBanner = document.getElementById('closedBanner');
    if (closedBanner) {
      closedBanner.style.display = 'none';
    }
    return;
  }
  
  const systemActive = await checkSystemStatus();
  const duringBusinessHours = isWithinBusinessHours();
  
  // Update closed banner (shows when passive/closed)
  const closedBanner = document.getElementById('closedBanner');
  const closedTitle = document.getElementById('closedTitle');
  const afterHoursMessage = document.getElementById('afterHoursMessage');
  const tempUnavailableMessage = document.getElementById('tempUnavailableMessage');
  
  if (closedBanner) {
    if (!systemActive) {
      closedBanner.style.display = 'block';
      
      if (duringBusinessHours) {
        closedTitle.innerHTML = 'üöß PHONE LINES BUSY';
        closedBanner.style.background = 'linear-gradient(135deg, #ff8c00, #ff6b00)';
        afterHoursMessage.style.display = 'none';
        tempUnavailableMessage.style.display = 'block';
      } else {
        closedTitle.innerHTML = 'üïê CURRENTLY CLOSED';
        closedBanner.style.background = 'linear-gradient(135deg, #666, #888)';
        afterHoursMessage.style.display = 'block';
        tempUnavailableMessage.style.display = 'none';
      }
    } else {
      closedBanner.style.display = 'none';
    }
  }
  
  // Update header call button
  const headerButton = document.querySelector('header .cta-button');
  if (headerButton) {
    headerButton.style.display = systemActive ? 'inline-block' : 'none';
  }
  
  // Update service buttons
  const normalButtons = document.querySelectorAll('.normal-hours-btn');
  const afterHoursButtons = document.querySelectorAll('.after-hours-btn');
  
  normalButtons.forEach(btn => {
    btn.style.display = systemActive ? 'inline-block' : 'none';
  });
  
  afterHoursButtons.forEach(btn => {
    btn.style.display = !systemActive ? 'inline-block' : 'none';
  });
  
  // Update sticky buttons
  const stickyCall = document.getElementById('stickyCallButton');
  const stickyClosed = document.getElementById('stickyClosedButton');
  
  if (stickyCall) {
    stickyCall.style.display = systemActive ? 'inline-block' : 'none';
  }
  
  if (stickyClosed) {
    if (!systemActive) {
      stickyClosed.style.display = 'inline-block';
      if (duringBusinessHours) {
        stickyClosed.innerHTML = 'üìÖ Book Online';
        stickyClosed.style.background = '#ff8c00';
      } else {
        stickyClosed.innerHTML = 'üïê View Hours';
        stickyClosed.style.background = '#666';
      }
    } else {
      stickyClosed.style.display = 'none';
    }
  }
}

/* === CALL-CLICK WEBHOOK === */
(function(){
  const CALL_CLICK_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/659e20267a7740aea22340e2f63e12fd/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=sa4qKODOby6WgW80SBuxvUxmRljASZfVTYTA-6vgPzo";

  // DEBUG: Test function to verify Power Automate connection
  window.testWebhook = function() {
    console.log("Testing webhook connection...");
    
    // Method 1: Try GET with URL parameters
    fetch(CALL_CLICK_URL + "&testEvent=true&timestamp=" + new Date().toISOString(), {
      method: "GET",
      mode: "no-cors"
    }).then(() => {
      console.log("GET test webhook sent (no-cors mode)");
    }).catch(err => {
      console.log("GET test webhook error:", err);
    });
    
    // Method 2: Try POST with JSON (matching your Power Automate config)
    fetch(CALL_CLICK_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        testEvent: true,
        timestamp: new Date().toISOString(),
        eventType: "test_call_click",
        sessionId: "test_session_123"
      }),
      mode: "no-cors"
    }).then(() => {
      console.log("POST test webhook sent");
    }).catch(err => {
      console.log("POST test webhook error:", err);
    });
    
    // Method 3: Image beacon test
    const img = new Image();
    img.src = CALL_CLICK_URL + "&testEvent=image&timestamp=" + new Date().toISOString();
    img.onload = img.onerror = () => {
      console.log("Image beacon test completed");
    };
  };

  function getOrCreateSessionId(){
    let sid = localStorage.getItem("eek_session_id");
    if (!sid){
      sid = "session_" + Date.now() + "_" + Math.random().toString(36).slice(2,11);
      localStorage.setItem("eek_session_id", sid);
    }
    return sid;
  }

  function getUTM(){
    const q = new URLSearchParams(location.search);
    return {
      source: q.get("utm_source") || null,
      medium: q.get("utm_medium") || null,
      campaign: q.get("utm_campaign") || null,
      term: q.get("utm_term") || null,
      content: q.get("utm_content") || null,
      gclid: q.get("gclid") || null,
      msclkid: q.get("msclkid") || null,
      fbclid: q.get("fbclid") || null,
      rdtclid: q.get("rdtclid") || null
    };
  }

  function closestPlacement(el){
    if (!el) return null;
    if (el.id) return "#" + el.id;
    const withId = el.closest("[id]");
    return withId ? ("#" + withId.id) : null;
  }

  function sendCallClick(eventAction, eventCategory, anchorEl){
    const callAttemptId = "call_" + Date.now() + "_" + Math.random().toString(36).slice(2,10);
    const payload = {
      eventType: "call_click",
      timestamp: new Date().toISOString(),
      sessionId: getOrCreateSessionId(),
      callAttemptId,
      phoneTarget: (anchorEl && anchorEl.getAttribute("href")) || "tel:0800769000",
      button: {
        eventAction: eventAction || "phone_call",
        eventCategory: eventCategory || "Contact",
        serviceType: (typeof getServiceType === "function") ? getServiceType(eventAction) : undefined,
        placement: anchorEl ? closestPlacement(anchorEl) : null,
        text: anchorEl ? (anchorEl.textContent || "").trim() : null
      },
      site: {
        domain: location.hostname,
        url: location.href,
        path: location.pathname,
        title: document.title,
        referrer: document.referrer || null
      },
      utm: getUTM(),
      device: {
        userAgent: navigator.userAgent,
        platform: navigator.platform || null,
        language: navigator.language || null,
        mobile: /Mobi|Android/i.test(navigator.userAgent),
        screen: {
          width: (window.screen && window.screen.width) || null,
          height: (window.screen && window.screen.height) || null,
          pixelRatio: window.devicePixelRatio || 1
        }
      },
      status: "pending"
    };

    // Save for PBX correlation if needed
    try {
      localStorage.setItem("eek_last_call_attempt_id", callAttemptId);
      localStorage.setItem("eek_last_call_timestamp", payload.timestamp);
    } catch (_) {}

    // Use simple GET request with URL parameters to avoid Power Automate changes
    const params = new URLSearchParams({
      eventType: 'call_click',
      timestamp: payload.timestamp,
      sessionId: payload.sessionId,
      callAttemptId: payload.callAttemptId,
      phoneTarget: payload.phoneTarget,
      eventAction: payload.button.eventAction,
      eventCategory: payload.button.eventCategory,
      serviceType: payload.button.serviceType || '',
      placement: payload.button.placement || '',
      domain: payload.site.domain,
      url: payload.site.url,
      utm_source: payload.utm.source || '',
      utm_campaign: payload.utm.campaign || '',
      mobile: payload.device.mobile
    });
    
    // Use image beacon technique (no CORS issues)
    const img = new Image();
    const fullUrl = `${CALL_CLICK_URL}&${params.toString()}`;
    img.src = fullUrl;
    img.onerror = img.onload = () => img.src = '';
  }

  // Capture which <a href="tel:..."> was clicked BEFORE inline onclick runs
  document.addEventListener("click", function(ev){
    const a = ev.target && ev.target.closest && ev.target.closest('a[href^="tel:"]');
    if (a) window.__eek_last_tel_anchor = a;
  }, true);

  // Wrap your existing trackConversion so call clicks also hit the webhook
  const _origTrack = window.trackConversion || function(){};
  window.trackConversion = function(eventAction, eventCategory){
    try {
      if (eventAction && !/winz/i.test(eventAction) && /call/i.test(eventAction)){
        sendCallClick(eventAction, eventCategory, window.__eek_last_tel_anchor || null);
      }
    } catch(_) {}
    return _origTrack.apply(this, arguments);
  };
})();

// Enhanced tracking function that includes Reddit Pixel with full event parameters
function trackConversion(eventAction, eventCategory) {
  const conversionId = 'eek_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  
  const serviceValues = {
    'inspection_call': 19900,
    'breakdown_call': 28900,
    'battery_call': 14900,
    'fuel_drain_call': 39900,
    'header_call': 25000,
    'sticky_call': 25000,
    'more_options_call': 25000,
    'after_hours_emergency': 35000,
    'breakdown_after_hours': 35000,
    'battery_after_hours': 20000,
    'fuel_drain_after_hours': 45000,
    'inspection_after_hours': 25000,
    'winz_quote_click': 15000,
    'winz_main_button': 20000
  };
  
  const eventValue = serviceValues[eventAction] || 25000;
  
  if (typeof gtag !== 'undefined') {
    gtag('event', eventAction, {
      'event_category': eventCategory,
      'event_label': eventAction.includes('winz') ? 'WINZ Quote Click' : 'Phone Call Click',
      'value': eventValue / 100
    });
    if (!eventAction.includes('winz')) {
      gtag('event', 'conversion', {
        'send_to': 'AW-17084465163/7Mh8CKFRydsaEIuAwJI_'
      });
    }
  }
  
  if (typeof rdt !== 'undefined') {
    rdt('track', 'Lead', {
      'customEventName': eventAction.includes('winz') ? 'WINZ_Quote_Request' : 'Phone_Call_Click',
      'conversionId': conversionId,
      'value': eventValue,
      'currency': 'NZD',
      'itemCount': 1,
      'eventSource': eventAction,
      'eventCategory': eventCategory,
      'serviceType': getServiceType(eventAction)
    });
  }
}

function getServiceType(eventAction) {
  const serviceMap = {
    'inspection_call': 'Pre-Purchase Inspection',
    'breakdown_call': 'Emergency Breakdown',
    'battery_call': 'Battery Jump Start',
    'fuel_drain_call': 'Wrong Fuel Rescue',
    'header_call': 'General Inquiry',
    'sticky_call': 'General Inquiry',
    'more_options_call': 'General Inquiry',
    'after_hours_emergency': 'After Hours Emergency',
    'breakdown_after_hours': 'After Hours Breakdown',
    'battery_after_hours': 'After Hours Battery',
    'fuel_drain_after_hours': 'After Hours Fuel Drain',
    'inspection_after_hours': 'After Hours Inspection',
    'winz_quote_click': 'WINZ Quote Request',
    'winz_main_button': 'WINZ Main Quote Request'
  };
  return serviceMap[eventAction] || 'General Service';
}

// Initialize on page load
window.addEventListener('load', function() {
  updateHoursDisplay();
  setInterval(updateHoursDisplay, 5 * 60 * 1000);
  
  if (typeof gtag !== 'undefined') {
    gtag('event', 'page_view', {
      'page_title': document.title,
      'page_location': window.location.href
    });
  }
});

let scrollTracked = false;
window.addEventListener('scroll', function() {
  if (!scrollTracked && window.scrollY > document.body.scrollHeight * 0.5) {
    scrollTracked = true;
    if (typeof gtag !== 'undefined') {
      gtag('event', 'scroll_50_percent', {
        'event_category': 'Engagement',
        'event_label': 'Scrolled 50% of page'
      });
    }
  }
});

// FIXED TOKEN PAYMENT FUNCTIONALITY
(function () {
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token');

  const box = document.getElementById('stripePaymentBlock');
  const checkbox = document.getElementById('termsCheckbox');
  const button = document.getElementById('payNowButton');
  const sticky = document.getElementById('stripePaymentSticky');
  const stickyCall = document.getElementById('stickyCallButton');
  const stickyClosedButton = document.getElementById('stickyClosedButton');

  if (token && box && checkbox && button && sticky && stickyCall) {
    box.style.display = 'block';
    sticky.style.display = 'inline-block';
    
    stickyCall.style.display = 'none';
    if (stickyClosedButton) {
      stickyClosedButton.style.display = 'none';
    }
    
    const normalButtons = document.querySelectorAll('.normal-hours-btn');
    normalButtons.forEach(btn => {
      btn.style.display = 'none';
    });

    sticky.href = '#stripePaymentBlock';

    checkbox.addEventListener('change', () => {
      button.style.display = checkbox.checked ? 'inline-block' : 'none';
    });

    button.addEventListener('click', () => {
      window.location.href = `https://buy.stripe.com/${token}`;
    });
  }
})();
</script>

<script>
  // === FIRST VISIT WEBHOOK ===
  (function () {
    const FIRST_VISIT_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2f31c90260554c5a9d6dcffec47bc6c2/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Ou7iqzZ1YI2PzT_9X-M6PT5iVo2QRboWnFZrO3IBOL4";

    // Create or reuse a sessionId (shared across pages/tabs for this browser)
    function getOrCreateSessionId() {
      let sid = localStorage.getItem("eek_session_id");
      if (!sid) {
        sid = "session_" + Date.now() + "_" + Math.random().toString(36).slice(2, 11);
        localStorage.setItem("eek_session_id", sid);
      }
      return sid;
    }

    function markSentOncePerTab() {
      sessionStorage.setItem("eek_first_visit_sent", "1");
    }
    function alreadySentThisTab() {
      return sessionStorage.getItem("eek_first_visit_sent") === "1";
    }

    function getUTM() {
      const q = new URLSearchParams(location.search);
      return {
        source: q.get("utm_source") || null,
        medium: q.get("utm_medium") || null,
        campaign: q.get("utm_campaign") || null,
        term: q.get("utm_term") || null,
        content: q.get("utm_content") || null,
        gclid: q.get("gclid") || null,
        msclkid: q.get("msclkid") || null,
        fbclid: q.get("fbclid") || null,
        rdtclid: q.get("rdtclid") || null
      };
    }

    function postFirstVisit() {
      if (alreadySentThisTab()) return;

      const payload = {
        eventType: "session_started",
        timestamp: new Date().toISOString(),
        sessionId: getOrCreateSessionId(),
        site: {
          domain: location.hostname,
          url: location.href,
          path: location.pathname,
          query: location.search ? location.search.slice(1) : "",
          title: document.title,
          referrer: document.referrer || null
        },
        utm: getUTM(),
        device: {
          userAgent: navigator.userAgent,
          platform: navigator.platform || null,
          language: navigator.language || null,
          mobile: /Mobi|Android/i.test(navigator.userAgent),
          screen: {
            width: window.screen && window.screen.width || null,
            height: window.screen && window.screen.height || null,
            pixelRatio: window.devicePixelRatio || 1
          }
        }
      };

      fetch(FIRST_VISIT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        keepalive: true,
        cache: "no-store"
      }).catch(() => { /* swallow errors; analytics shouldn't block UX */ });

      markSentOncePerTab();
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", postFirstVisit);
    } else {
      postFirstVisit();
    }
  })();
</script>

</body>
</html>
