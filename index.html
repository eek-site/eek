<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile Mechanics NZ - 30 Min Dispatch | Eek Mechanical</title>
  <meta name="description" content="Eek Mechanical - Call now for immediate dispatch. Mobile mechanics arrive in 30 minutes across NZ. Pre-purchase inspections from $299, wrong fuel rescue, jump starts, roadside repairs." />
  <meta name="keywords" content="mobile mechanic, mobile mechanics NZ, roadside mechanic, jump start service, fuel drain, wrong fuel, pre purchase inspection, emergency mechanic, mobile car repair, NZ mechanics" />
  <meta property="og:title" content="Mobile Mechanics NZ - 30 Min Dispatch | Eek Mechanical" />
  <meta property="og:description" content="Call now - mechanics dispatched in 30 minutes. Emergency roadside service across New Zealand." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.eek.nz" />
  <meta property="og:image" content="https://www.eek.nz/og-image.jpg" />

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self';
script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net https://static.cloudflareinsights.com;
style-src 'self' 'unsafe-inline';
img-src 'self' data: https:;
connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://conversions-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com https://www.googleadservices.com https://www.google.hn https://www.eek.nz https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com https://static.cloudflareinsights.com;
frame-src 'self' https://td.doubleclick.net https://www.googletagmanager.com;
font-src 'self' data:;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <!-- Call Modal Styles and Scripts -->
    <link rel="stylesheet" href="call-modal.css?v=20250125">

  <!-- Reddit Pixel -->
  <script>
    !function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}
    (window,document);
    
    function getEmailFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const emailParam = urlParams.get('email');
      if (emailParam) return emailParam;
      
      const emailInputs = document.querySelectorAll('input[type="email"], input[name*="email"], input[id*="email"]');
      for (let input of emailInputs) {
        if (input.value && input.value.includes('@')) {
          return input.value;
        }
      }
      return null;
    }
    
    function getPhoneFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const phoneParam = urlParams.get('phone');
      if (phoneParam) return phoneParam;
      
      const phoneInputs = document.querySelectorAll('input[type="tel"], input[name*="phone"], input[id*="phone"]');
      for (let input of phoneInputs) {
        if (input.value) {
          return input.value;
        }
      }
      return null;
    }
    
    function getUserId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('uid') || urlParams.get('user_id') || urlParams.get('customer_id');
    }
    
    function getMobileIds() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        idfa: urlParams.get('idfa'),
        aaid: urlParams.get('aaid')
      };
    }
    
    const mobileIds = getMobileIds();
    const initConfig = {};
    
    const email = getEmailFromForm();
    const phoneNumber = getPhoneFromForm();
    const externalId = getUserId();
    
    if (email) initConfig.email = email;
    if (phoneNumber) initConfig.phoneNumber = phoneNumber;
    if (externalId) initConfig.externalId = externalId;
    if (mobileIds.idfa) initConfig.idfa = mobileIds.idfa;
    if (mobileIds.aaid) initConfig.aaid = mobileIds.aaid;
    
    rdt('init', 'a2_hf16791nsdhx', Object.keys(initConfig).length > 0 ? initConfig : undefined);
    rdt('track', 'PageVisit');
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084465163"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17084465163');
    gtag('config', 'G-DQNKF1YLWR');
  </script>
  
  <!-- Centralized Phone Number Management -->
  <script src="/phone-manager.js?v=20251020.36"></script>
  
  <!-- Unified Tracking System (replaces tracking-manager.js) -->
  <script src="/unified-tracking.js?v=20251020.36"></script>
  
  <!-- Centralized Footer Management -->
  <script src="/footer-new.js?v=20251020.36"></script>
  

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Eek Mechanical",
    "description": "Mobile mechanic services across New Zealand. Pre purchase vehicle inspections, wrong fuel removal, petrol and diesel removal, emergency roadside repairs.",
    "telephone": "+64800769000",
    "url": "https://www.eek.nz",
    "image": "https://www.eek.nz/brand-image.png",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "NZ"
    },
    "areaServed": {
      "@type": "Country",
      "name": "New Zealand"
    },
    "openingHours": [
      "Mo 07:00-17:00",
      "Tu 07:00-17:00", 
      "We 07:00-17:00",
      "Th 07:00-17:00",
      "Fr 07:00-17:00",
      "Sa 07:00-12:00",
      "Su 07:00-12:00"
    ],
    "serviceType": [
      "Mobile Mechanic",
      "Pre Purchase Vehicle Inspections", 
      "Wrong Fuel Removal",
      "Petrol and Diesel Removal",
      "Emergency Roadside Repairs",
      "Battery Jump Start",
      "Trailer Repairs"
    ]
  }
  </script>

  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    :root {
      /* Brand Colors */
      --primary: #ff5500;
      --primary-light: #ff7733;
      --primary-dark: #e04400;
      --secondary: #28a745;
      --secondary-light: #20c997;
      --accent: #17a2b8;
      --danger: #dc3545;
      --warning: #ffc107;
      --success: #28a745;
      
      /* Neutral Colors */
      --white: #ffffff;
      --gray-50: #f8f9fa;
      --gray-100: #f5f5f5;
      --gray-200: #e9ecef;
      --gray-300: #dee2e6;
      --gray-400: #ced4da;
      --gray-500: #adb5bd;
      --gray-600: #6c757d;
      --gray-700: #495057;
      --gray-800: #343a40;
      --gray-900: #212529;
      
      /* Typography */
      --font-primary: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
      --font-heading: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      /* Transitions */
      --transition-fast: 150ms ease-in-out;
      --transition-normal: 300ms ease-in-out;
      --transition-slow: 500ms ease-in-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-primary);
      background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
      margin: 0;
      padding: 0 0 80px 0;
      color: var(--gray-800);
      text-align: center;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Payment mode overrides */
    body.payment-mode .sticky-call {
      display: none !important;
      visibility: hidden !important;
    }
    
    body.payment-mode .normal-hours-only,
    body.payment-mode .normal-hours-btn,
    body.payment-mode .phone-link,
    body.payment-mode .phone-display,
    body.payment-mode header,
    body.payment-mode .social-proof-box,
    body.payment-mode #service-selection,
    body.payment-mode #phonesBusyBanner {
      display: none !important;
    }
    
    /* Header Styles */
    header {
      background: var(--white);
      padding: var(--space-2xl) var(--space-xl);
      max-width: 1200px;
      margin: 0 auto var(--space-xl);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
    }
    
    .business-name {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800;
      color: var(--primary);
      margin: var(--space-lg) 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      letter-spacing: -0.02em;
    }
    
    header img {
      max-width: min(300px, 80vw);
      height: auto;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-normal);
    }
    
    header img:hover {
      transform: translateY(-2px);
    }
    
    h1 {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      margin: var(--space-lg) 0 var(--space-md);
      color: var(--gray-800);
      font-weight: 700;
      line-height: 1.2;
    }
    
    p.tagline {
      font-size: clamp(1rem, 3vw, 1.3rem);
      color: var(--gray-600);
      margin: 0;
      font-weight: 500;
    }

    .after-hours-banner {
      background: linear-gradient(135deg, #ff3333, #ff5500);
      color: white;
      padding: 20px;
      margin: 0 auto 20px;
      max-width: 800px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(255,51,51,0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 4px 12px rgba(255,51,51,0.3); }
      50% { box-shadow: 0 4px 20px rgba(255,51,51,0.5); }
    }

    @keyframes pulse-green {
      0%, 100% { box-shadow: 0 8px 24px rgba(40,167,69,0.4); }
      50% { box-shadow: 0 8px 32px rgba(40,167,69,0.6); }
    }

    .after-hours-banner h2 {
      margin: 0 0 10px 0;
      font-size: 1.6em;
    }

    .after-hours-banner p {
      margin: 10px 0;
      font-size: 1.1em;
    }

    .emergency-btn {
      display: inline-block;
      background: rgba(255,255,255,0.25);
      color: white;
      padding: 15px 30px;
      margin: 10px;
      font-size: 1.3em;
      border-radius: 8px;
      text-decoration: none;
      border: 2px solid white;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .emergency-btn:hover {
      background: white;
      color: #ff3333;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }


    /* Call-to-Action Buttons */
    .cta-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      padding: var(--space-lg) var(--space-2xl);
      margin: var(--space-lg) auto;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      border-radius: var(--radius-xl);
      text-decoration: none;
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-normal);
      font-weight: 700;
      border: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      min-width: 200px;
    }
    
    .cta-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left var(--transition-slow);
    }
    
    .cta-button:hover::before {
      left: 100%;
    }
    
    .cta-button:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: var(--shadow-xl);
      background: linear-gradient(135deg, var(--primary-light), var(--primary));
    }
    
    .cta-button:active {
      transform: translateY(-2px) scale(1.02);
    }
    
    /* Service Sections */
    .services {
      background: var(--white);
      margin: var(--space-xl) auto;
      padding: var(--space-2xl);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-lg);
      max-width: 1200px;
      position: relative;
      overflow: hidden;
    }
    
    .services::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    .services h2 {
      color: var(--gray-800);
      font-size: clamp(1.6rem, 4vw, 2.2rem);
      font-weight: 800;
      margin: 0 0 var(--space-lg) 0;
      line-height: 1.2;
    }
    
    .services ul {
      list-style: none;
      padding: 0;
      font-size: clamp(1rem, 2.5vw, 1.1rem);
      margin: var(--space-lg) 0;
    }
    
    .services li {
      padding: var(--space-sm) 0;
      color: var(--gray-700);
      line-height: 1.6;
      position: relative;
      padding-left: var(--space-lg);
    }
    
    .services li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: var(--secondary);
      font-weight: bold;
      font-size: 1.2em;
    }
    /* Service Selection Section */
    .keywords-highlight {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      padding: var(--space-2xl);
      margin: var(--space-xl) auto;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      max-width: 1200px;
      position: relative;
      overflow: hidden;
    }
    
    .keywords-highlight::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .keywords-highlight h2 {
      margin: 0 0 var(--space-lg) 0;
      color: var(--white);
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      font-weight: 800;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }
    
    .keywords-highlight p {
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      margin: 0 0 var(--space-xl) 0;
      opacity: 0.95;
      position: relative;
      z-index: 1;
    }
    
    .service-keywords {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-lg);
      margin-top: var(--space-xl);
      position: relative;
      z-index: 1;
    }
    
    .keyword-item {
      background: rgba(255,255,255,0.15);
      padding: var(--space-xl);
      border-radius: var(--radius-xl);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255,255,255,0.2);
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }
    
    .keyword-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left var(--transition-slow);
    }
    
    .keyword-item:hover::before {
      left: 100%;
    }
    
    .keyword-item:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      border-color: rgba(255,255,255,0.4);
    }
    
    .keyword-item h4 {
      margin: 0 0 var(--space-md) 0;
      font-size: clamp(1.1rem, 2.5vw, 1.3rem);
      font-weight: 700;
      color: var(--white);
    }
    
    .keyword-item p {
      margin: 0;
      font-size: clamp(0.9rem, 2vw, 1rem);
      opacity: 0.9;
      color: var(--white);
      line-height: 1.5;
    }

    .services [data-bid] {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
      margin-top: 15px;
    }

    .services [data-bid] * {
      max-width: 100% !important;
      box-sizing: border-box;
    }

    footer {
      font-size: 0.9em;
      color: #999;
      padding: 20px 0;
    }
    /* Sticky Payment Button */
    .sticky-payment {
      position: fixed;
      bottom: var(--space-lg);
      right: var(--space-lg);
      background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
      color: var(--white);
      font-size: clamp(1rem, 2.5vw, 1.1rem);
      padding: var(--space-lg) var(--space-xl);
      border-radius: 50px;
      box-shadow: var(--shadow-xl);
      text-decoration: none;
      z-index: 999;
      font-weight: 700;
      transition: all var(--transition-normal);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .sticky-payment:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, var(--secondary-light), var(--secondary));
    }

    /* Book Now Urgent Styling */
    .book-now-urgent {
      background: linear-gradient(135deg, #28a745, #20c997) !important;
      color: white !important;
      padding: 18px 35px !important;
      font-size: 1.3em !important;
      border-radius: 12px !important;
      text-decoration: none !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 12px !important;
      box-shadow: 0 8px 24px rgba(40,167,69,0.4) !important;
      font-weight: 800 !important;
      animation: pulse-green 2s infinite !important;
      border: 3px solid #fff !important;
    }

    .book-now-urgent:hover {
      transform: translateY(-3px) !important;
      box-shadow: 0 12px 32px rgba(40,167,69,0.5) !important;
    }

    /* Social Proof Section */
    .social-proof-box {
      background: linear-gradient(135deg, #fff8e1, #fff3cd);
      border: 2px solid var(--warning);
      padding: var(--space-2xl);
      margin: var(--space-xl) auto;
      max-width: 1200px;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }
    
    .social-proof-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--warning), var(--primary));
    }

    .social-proof-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-lg);
      margin-top: var(--space-lg);
    }

    .stat-big {
      font-size: clamp(2rem, 5vw, 3rem);
      color: var(--primary);
      font-weight: 900;
      display: block;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      line-height: 1;
    }
    
    .social-proof-box h3 {
      margin: 0 0 var(--space-lg) 0;
      color: var(--gray-800);
      font-size: clamp(1.3rem, 3vw, 1.6rem);
      font-weight: 700;
    }
    
    .social-proof-box .stat-item {
      text-align: center;
      padding: var(--space-lg);
      background: rgba(255,255,255,0.7);
      border-radius: var(--radius-lg);
      transition: transform var(--transition-normal);
    }
    
    .social-proof-box .stat-item:hover {
      transform: translateY(-4px);
    }
    
    .social-proof-box .stat-item span:last-child {
      color: var(--gray-600);
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      font-weight: 600;
      display: block;
      margin-top: var(--space-sm);
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 0 0 100px 0;
      }
      
      header {
        margin: var(--space-md) var(--space-md) var(--space-lg);
        padding: var(--space-xl) var(--space-lg);
      }
      
      .service-keywords {
        grid-template-columns: 1fr;
        gap: var(--space-md);
      }
      
      .services, .keywords-highlight, .social-proof-box {
        margin: var(--space-lg) var(--space-md);
        padding: var(--space-xl);
      }
      
      .sticky-payment {
        bottom: var(--space-md);
        right: var(--space-md);
        left: var(--space-md);
        text-align: center;
        border-radius: var(--radius-xl);
      }
      
      .social-proof-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-md);
      }
    }
    
    @media (max-width: 480px) {
      .social-proof-grid {
        grid-template-columns: 1fr;
      }
      
      .sticky-payment {
        font-size: 0.9rem;
        padding: var(--space-md) var(--space-lg);
      }
    }


    /* More Info Button Styles */
    .more-info-btn {
      background: #6c757d !important;
      color: white !important;
      border: none !important;
      padding: 12px 24px !important;
      border-radius: 8px !important;
      font-size: 1.1em !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      font-weight: 600 !important;
    }
    
    .more-info-btn:hover {
      background: #5a6268 !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
    }
    
    /* More Info Modal Styles */
    .more-info-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .more-info-content {
      background: white;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    .more-info-header {
      background: linear-gradient(135deg, var(--primary, #ff5500), var(--primary-light, #ff7733));
      color: white;
      padding: 24px;
      border-radius: 16px 16px 0 0;
      position: relative;
    }
    
    .more-info-header h3 {
      margin: 0 0 8px 0;
      font-size: 1.5em;
      font-weight: 700;
    }
    
    .more-info-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      font-size: 24px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
    }
    
    .more-info-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .more-info-body {
      padding: 24px;
    }
    
    .more-info-section {
      margin-bottom: 24px;
    }
    
    .more-info-section h4 {
      color: var(--primary, #ff5500);
      font-size: 1.2em;
      margin: 0 0 12px 0;
      font-weight: 700;
    }
    
    .more-info-section ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .more-info-section li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    
    .pricing-box {
      background: #f8f9fa;
      border: 2px solid var(--primary, #ff5500);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin: 20px 0;
    }
    
    .pricing-box h4 {
      color: var(--primary, #ff5500);
      margin: 0 0 10px 0;
      font-size: 1.3em;
    }
    
    .pricing-box .price {
      font-size: 2em;
      font-weight: 900;
      color: var(--primary, #ff5500);
      margin: 10px 0;
    }
    
    .cta-section {
      text-align: center;
      margin-top: 24px;
    }
    
    .cta-section .cta-button {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary, #ff5500), var(--primary-light, #ff7733));
      color: white;
      padding: 15px 30px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 700;
      font-size: 1.2em;
      margin: 0 10px;
      transition: all 0.3s ease;
    }
    
    .cta-section .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 85, 0, 0.3);
    }

    /* Service Selection Modal styles moved to call-modal.css */

    .debug-info {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      font-size: 12px;
      border-radius: 5px;
      z-index: 9999;
      display: none;
    }
  </style>
</head>
<body>

<!-- Debug Info Panel -->
<div class="debug-info" id="debugInfo">
  <div>System Status: <span id="debugSystemStatus">Checking...</span></div>
  <div>Business Hours: <span id="debugBusinessHours">Checking...</span></div>
  <div>Current Time: <span id="debugCurrentTime"></span></div>
  <div>Payment Token: <span id="debugPaymentToken">No</span></div>
</div>

<!-- Business Closed Banner -->
<div id="closedBanner" class="after-hours-banner" style="display: none; background: linear-gradient(135deg, #666, #888);">
  <h2 id="closedTitle">üïê CURRENTLY CLOSED</h2>
  <div id="afterHoursMessage">
    <p><strong>Business Hours:</strong></p>
    <p>Monday - Friday: 7:00 AM - 5:00 PM</p>
    <p>Saturday - Sunday: 7:00 AM - 12:00 PM</p>
    <p>Book online now for next available service</p>
  </div>
  <div id="tempUnavailableMessage" style="display: none;">
    <div style="background:rgba(255,255,255,0.2);padding:20px;border-radius:12px;margin:15px 0;">
      <h3 style="margin:0 0 15px 0;font-size:1.5em;">üì± Lines Busy - Book Online Instead</h3>
      <p style="font-size:1.2em;margin:12px 0;"><strong>All mechanics currently on emergency calls</strong></p>
      <p style="font-size:1.15em;margin:10px 0;">‚úÖ Book online now - next mechanic dispatched to you</p>
      <p style="font-size:1.15em;margin:10px 0;">‚úÖ Skip the phone queue completely</p>
      <p style="font-size:1.15em;margin:10px 0;">‚úÖ <strong>Lock in your time slot before they fill up</strong></p>
    </div>
    <a href="#service-selection" class="emergency-btn" style="background:#28a745;font-size:1.5em;padding:20px 40px;margin-top:15px;border:3px solid white;animation:pulse-green 2s infinite;">
      üìÖ BOOK YOUR SLOT NOW
    </a>
    <p style="margin-top:20px;font-size:1.1em;opacity:0.95;"><strong>Most bookings completed in under 2 minutes</strong></p>
  </div>
</div>

<section id="stripePaymentBlock" style="display: none; background-color: #ffffff; padding: 20px; text-align: center; color: #333; border-bottom: 2px solid #ff5500;">
  <div style="background-color: #f5f5f5; padding: 30px; border-radius: 12px; max-width: 700px; margin: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.05);">
    <h1 style="font-size: 2.2em; margin-bottom: 0.5em;">Secure Roadside Payment</h1>
    <p style="font-size: 1.2em; margin-bottom: 1.5em;">Confirm your payment to get help on the way ‚Äî fast, safe, and secure.</p>
    <label style="font-size: 1.1em; display: inline-flex; align-items: center; gap: 10px; color: #333;">
      <input type="checkbox" id="termsCheckbox" style="transform: scale(1.5);" />
      <span>I agree to the Eek Mechanical terms of service 
        <a href="https://www.eek.nz/terms" target="_blank" style="color: #ff5500; text-decoration: underline;">
          View terms of use
        </a>
      </span>
    </label>
    <br><br>
    <button id="payNowButton" style="display: none; background-color: #ff5500; color: white; padding: 14px 32px; font-size: 1.2em; border: none; border-radius: 8px; cursor: pointer;">
      Pay Now
    </button>
  </div>
</section>

<header>
  <img src="brand-image.png" alt="Eek Mechanical - Emergency Roadside Services" />
  <div class="business-name">Eek Mechanical</div>
  <h1>Eek Mechanical - Most Jobs Dispatched in Under 30 Minutes</h1>
  <p class="tagline">Jump Starts - Mobile Mechanical Repairs - Pre-Purchase Inspections - Wrong Fuel Rescue</p>
</header>


<!-- Phones Busy Banner -->
<div id="phonesBusyBanner" style="display:none;position:sticky;top:0;background:linear-gradient(135deg,#28a745,#20c997);color:#fff;padding:18px;text-align:center;z-index:998;box-shadow:0 4px 12px rgba(40,167,69,0.3);">
  <strong style="font-size:1.3em;">üì± All lines busy - All mechanics currently dispatched</strong>
  <span style="margin:0 15px;">‚Üí</span>
  <a href="#service-selection" style="background:rgba(255,255,255,0.3);color:#fff;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:800;border:2px solid white;font-size:1.1em;">
    üìÖ Book Online Now - Skip the Queue
  </a>
</div>



<!-- Jump Starts Service -->
<div class="services" id="jump-starts">
  <h2>üîã Jump Starts - Get Back on the Road Fast</h2>
  <p style="color:#ff5500;font-weight:800;margin:15px 0;font-size:1.25em;">‚ö° Professional jump start service - typically within 10 minutes</p>
  <p style="font-size:1.15em;line-height:1.6;">Stranded with a flat battery? Our mobile mechanics arrive with professional-grade equipment to get you started and back on the road safely.</p>
  <ul style="text-align:left;max-width:600px;margin:20px auto;">
    <li>üîã Works with all vehicle makes and models</li>
    <li>‚ö° Professional-grade jump start equipment</li>
    <li>üîç FREE battery voltage and health check</li>
    <li>üìç Come to you - home, work, or roadside</li>
    <li>‚è±Ô∏è <strong>Most jobs dispatched in under 30 minutes</strong></li>
  </ul>
  
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px;">
    <a id="jumpstart-call-btn" class="cta-button normal-hours-btn" href="javascript:void(0)" onclick="openServiceModal(); trackConversion('jumpstart_call', 'Contact')" style="font-size:1.4em;padding:18px 35px;">
      üìû CALL NOW
    </a>
    <button class="more-info-btn" onclick="openMoreModal('jumpstarts')" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-left: 10px;">
      ‚ÑπÔ∏è More Info
    </button>
  </div>
</div>

<!-- Mobile Mechanical Repairs Service -->
<div class="services" id="mobile-mechanical-repairs">
  <h2>üõ†Ô∏è Mobile Mechanical Repairs - Professional Service On-Site</h2>
  <p style="color:#dc3545;font-weight:800;margin:15px 0;font-size:1.3em;">‚ö° Most jobs dispatched in under 30 minutes</p>
  <p style="font-size:1.15em;line-height:1.6;">Stranded? Engine won't start? Our mobile mechanics arrive equipped with professional diagnostic tools and can fix most problems on-site.</p>
  <ul style="text-align:left;max-width:600px;margin:20px auto;">
    <li>üõ†Ô∏è Professional diagnostic scanning & fault detection</li>
    <li>üîç On-site repairs for most common issues</li>
    <li>üìç Mobile mechanics across all NZ - city and rural</li>
    <li>üß∞ Fully equipped mobile workshop</li>
    <li>üìû Real-time updates from dispatch team</li>
    <li>‚ö° <strong>Most jobs dispatched in under 30 minutes</strong></li>
  </ul>
  
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px;">
    <a id="repairs-call-btn" class="cta-button normal-hours-btn" href="javascript:void(0)" onclick="openServiceModal(); trackConversion('repairs_call', 'Contact')" style="font-size:1.4em;padding:18px 35px;">
      üìû CALL NOW
    </a>
    <button class="more-info-btn" onclick="openMoreModal('repairs')" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-left: 10px;">
      ‚ÑπÔ∏è More Info
    </button>
  </div>
</div>

<!-- Pre-Purchase Inspections Service -->
<div class="services" id="pre-purchase-inspections">
  <h2>üîç Pre-Purchase Inspections - Don't Buy a Lemon</h2>
  <p style="color:#28a745;font-weight:800;margin:15px 0;font-size:1.25em;">üèÜ Same-day service - inspections completed today, not next week</p>
  <p style="font-size:1.15em;line-height:1.6;">Buying a used car? Get peace of mind with our certified 45-point mechanical inspection. We come to the seller's location anywhere in NZ.</p>
  <ul style="text-align:left;max-width:600px;margin:20px auto;">
    <li>üßæ Comprehensive 45-point certified inspection</li>
    <li>üèÜ <strong>Same-day service available nationwide</strong></li>
    <li>‚è±Ô∏è <strong>Inspections completed today - not 2-3 days like competitors</strong></li>
    <li>‚úÖ Detailed written report with price recommendation</li>
    <li>üîß Estimates for upcoming maintenance costs</li>
  </ul>
  
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px;">
    <a id="inspection-call-btn" class="cta-button normal-hours-btn" href="javascript:void(0)" onclick="openServiceModal(); trackConversion('inspection_call', 'Contact')" style="font-size:1.4em;padding:18px 35px;">
      üìû CALL NOW
    </a>
    <button class="more-info-btn" onclick="openMoreModal('inspections')" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-left: 10px;">
      ‚ÑπÔ∏è More Info
    </button>
  </div>
</div>

<!-- Wrong Fuel Rescue Service -->
<div class="services" id="wrong-fuel-rescue">
  <h2>‚õΩ Wrong Fuel Rescue - STOP - Don't Start the Engine</h2>
  <p style="color:#dc3545;font-weight:800;margin:15px 0;font-size:1.3em;">‚ö†Ô∏è DON'T START YOUR CAR - Call us immediately</p>
  <p style="font-size:1.15em;line-height:1.6;">Put the wrong fuel in? Don't panic. Our wrong fuel specialists can drain and flush your system on-site - no expensive tow truck needed.</p>
  <ul style="text-align:left;max-width:600px;margin:20px auto;">
    <li>‚õΩ Professional petrol/diesel removal service</li>
    <li>üßØ Fully insured fuel contamination service</li>
    <li>üìç Emergency fuel rescue anywhere in NZ</li>
    <li>‚ö° <strong>Priority dispatch for wrong fuel emergencies</strong></li>
    <li>üí∞ <strong>Professional service - cheaper than engine damage</strong></li>
  </ul>
  
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px;">
    <a id="fuel-drain-call-btn" class="cta-button normal-hours-btn" href="javascript:void(0)" onclick="openServiceModal(); trackConversion('fuel_drain_call', 'Contact')" style="font-size:1.4em;padding:18px 35px;">
      üìû CALL NOW
    </a>
    <button class="more-info-btn" onclick="openMoreModal('fuel')" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-left: 10px;">
      ‚ÑπÔ∏è More Info
    </button>
  </div>
</div>


<a id="stripePaymentSticky" class="sticky-payment" href="#" style="display: none;">üí≥ Make Payment</a>

<!-- Footer will be added by footer.js -->


<!-- More Info Modal -->
<div id="moreInfoModal" class="more-info-modal">
  <div class="more-info-content">
    <div class="more-info-header">
      <h3 id="moreInfoTitle">Service Information</h3>
      <button class="more-info-close" onclick="closeMoreModal()">&times;</button>
    </div>
    <div class="more-info-body" id="moreInfoBody">
      <!-- Content will be populated by JavaScript -->
    </div>
  </div>
</div>

<!-- Service Selection Modal - loaded from call-modal.html -->

<script>
// CENTRALIZED GCLID EXTRACTION UTILITY
function extractGCLID(urlParams) {
  return urlParams.get('gclid') || urlParams.get('gbraid') || urlParams.get('wbraid') || null;
}

// FIRST VISIT TRACKING - Now handled by unified-tracking.js
// unified-tracking.js automatically tracks page_view on initialization
// This block is kept only for state fetching (GCLID/Callflow state) which is needed for other functionality
(function() {
  const GCLID_STATE_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/5f20c5153e8a4de0be50a17e2dab4254/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Zw5-_6YSCNPb2cfjjfa0Oj_Fpc7N9rhHfc6fPZZhX7g";
  const CALLFLOW_STATE_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/17b1d2990e6f4082a2b0d9c2f1a29025/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=bPyoxJ24kuxJZOyLGAclGaEuH6BHwUTFaGmYOwHofa8";
  
  // GCLID and Callflow state fetching - these are NOT tracking data, just state checks
  // Tracking data is now handled entirely by unified-tracking.js
  async function getStateData() {
    const states = {
      gclidState: null,
      callflowState: null
    };
    
    try {
      console.log('üîÑ Fetching GCLID state...');
      const gclidResponse = await fetch(GCLID_STATE_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({}),
        cache: "no-store"
      });
      
      if (gclidResponse.ok) {
        const gclidData = await gclidResponse.json();
        states.gclidState = gclidData.state || gclidData;
        console.log('‚úÖ GCLID state received:', states.gclidState);
      } else {
        console.warn('‚ö†Ô∏è GCLID state API error:', gclidResponse.status);
      }
    } catch (error) {
      console.error('‚ùå GCLID state fetch error:', error);
    }
    
    try {
      console.log('üîÑ Fetching Callflow state...');
      const callflowResponse = await fetch(CALLFLOW_STATE_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({}),
        cache: "no-store"
      });
      
      if (callflowResponse.ok) {
        const callflowData = await callflowResponse.json();
        states.callflowState = callflowData.state || callflowData;
        console.log('‚úÖ Callflow state received:', states.callflowState);
      } else {
        console.warn('‚ö†Ô∏è Callflow state API error:', callflowResponse.status);
      }
    } catch (error) {
      console.error('‚ùå Callflow state fetch error:', error);
    }
    
    return states;
  }
  
  // Store states globally for other scripts that need them
  getStateData().then(states => {
    window.eek_states = window.eek_states || {};
    window.eek_states.gclidState = states.gclidState;
    window.eek_states.callflowState = states.callflowState;
    console.log('‚úÖ States stored for other scripts');
  });
})();

/* ------------ STATE CACHE + POLLER (single source of truth) ------------ */
window.eek_states = { gclidState: null, callflowState: null, lastFetched: 0 };
let eekStatesFetchPromise = null;

// Define URLs (top-level for reuse)
const EEK_GCLID_STATE_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/5f20c5153e8a4de0be50a17e2dab4254/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Zw5-_6YSCNPb2cfjjfa0Oj_Fpc7N9rhHfc6fPZZhX7g";
const EEK_CALLFLOW_STATE_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/17b1d2990e6f4082a2b0d9c2f1a29025/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=bPyoxJ24kuxJZOyLGAclGaEuH6BHwUTFaGmYOwHofa8";

async function fetchStatesOnce(force = false) {
  const now = Date.now();
  if (!force && eekStatesFetchPromise) return eekStatesFetchPromise;
  if (!force && now - (window.eek_states.lastFetched || 0) < 30_000) {
    return window.eek_states;
  }

  eekStatesFetchPromise = (async () => {
    let gclidState = window.eek_states.gclidState;
    let callflowState = window.eek_states.callflowState;

    try {
      const [gclidResp, callflowResp] = await Promise.all([
        fetch(EEK_GCLID_STATE_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({}), cache: "no-store" }),
        fetch(EEK_CALLFLOW_STATE_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({}), cache: "no-store" })
      ]);

      if (gclidResp.ok) {
        const j = await gclidResp.json();
        gclidState = (j && (j.state ?? j)) || null;
      }
      if (callflowResp.ok) {
        const j = await callflowResp.json();
        callflowState = (j && (j.state ?? j)) || null;
      }
    } catch (_) { /* keep previous values on failure */ }

    window.eek_states = { gclidState, callflowState, lastFetched: Date.now() };
    eekStatesFetchPromise = null;
    return window.eek_states;
  })();

  return eekStatesFetchPromise;
}

function startStatePoller(intervalMs = 300_000) {
  fetchStatesOnce(true).then(() => {
    document.dispatchEvent(new CustomEvent("eek:state:update", { detail: window.eek_states }));
  });
  setInterval(async () => {
    await fetchStatesOnce(true);
    document.dispatchEvent(new CustomEvent("eek:state:update", { detail: window.eek_states }));
  }, intervalMs);
}

// Dynamic phone number based on traffic source
function getDisplayPhoneNumber() {
  const urlParams = new URLSearchParams(window.location.search);
  const gclid = extractGCLID(urlParams);
  
  if (gclid) {
  localStorage.setItem('eek_phone_preference', 'tracking');
  return {
    tel: 'tel:0800447153',
    display: 'Call Now'
  };
}

localStorage.setItem('eek_phone_preference', 'default');
return {
  tel: 'tel:0800769000', 
  display: 'Call Now'
};
}

// Build tracking parameters for service URLs
function buildTrackingParams() {
  const params = new URLSearchParams();
  const urlParams = new URLSearchParams(window.location.search);
  
  const token = urlParams.get('token');
  if (token) params.set('token', token);
  
  const gclid = extractGCLID(urlParams);
  if (gclid) params.set('gclid', gclid);
  
  ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content'].forEach(param => {
    const value = urlParams.get(param);
    if (value) params.set(param, value);
  });
  
  const sessionId = localStorage.getItem("eek_session_id");
  if (sessionId) params.set('session_id', sessionId);
  
  // Add return visit tracking
  const lastCallAttemptId = localStorage.getItem("eek_last_call_attempt_id");
  if (lastCallAttemptId) params.set('call_attempt_id', lastCallAttemptId);
  
  const lastCallTimestamp = localStorage.getItem("eek_last_call_timestamp");
  if (lastCallTimestamp) params.set('call_timestamp', lastCallTimestamp);
  
  return params.toString();
}

// Update service links with tracking parameters
function updateServiceLinks() {
  const trackingParams = buildTrackingParams();
  
  document.querySelectorAll('.service-link').forEach(link => {
    const service = link.dataset.service;
    if (service) {
      const baseUrl = `/book-service?service=${service}`;
      const fullUrl = trackingParams ? `${baseUrl}&${trackingParams}` : baseUrl;
      
      if (link.classList.contains('after-hours-btn') || link.closest('#winz-assistance') || link.getAttribute('href') === '#service-selection') {
        link.href = fullUrl;
      } else {
        link.dataset.bookingUrl = fullUrl;
      }
    }
  });
  
  const moreOptionsLink = document.querySelector('.more-options-link, a[href*="more-options"]');
  if (moreOptionsLink) {
    const baseUrl = '/more-options';
    const fullUrl = trackingParams ? `${baseUrl}?${trackingParams}` : baseUrl;
    moreOptionsLink.href = fullUrl;
    console.log('üîó More Options link updated:', fullUrl);
  }
  
  console.log('üîó Service links updated with tracking parameters:', trackingParams);
}

// Handle service selection card clicks
function handleServiceSelection() {
  document.querySelectorAll('.service-link').forEach(link => {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        console.log('üîó Scrolling to anchor:', href);
        return;
      }
      const bookingUrl = this.dataset.bookingUrl;
      if (bookingUrl) {
        e.preventDefault();
        console.log('üéØ Redirecting to booking page:', bookingUrl);
        
        // Track the booking click
        if (typeof gtag !== 'undefined') {
          gtag('event', 'book_now_click', {
            'event_category': 'Booking',
            'event_label': this.dataset.service || 'unknown',
            'value': 1
          });
        }
        
        if (typeof rdt !== 'undefined') {
          rdt('track', 'Custom', {
            'customEventName': 'Book_Now_Click',
            'serviceType': this.dataset.service || 'unknown'
          });
        }
        
        window.location.href = bookingUrl;
      }
    });
  });
}

// Track orange box service selection clicks - Now uses unified-tracking.js
function trackServiceSelection() {
  document.querySelectorAll('.keyword-item').forEach(item => {
    item.addEventListener('click', function(e) {
      const service = this.dataset.service;
      const serviceName = this.querySelector('h4')?.textContent || 'Unknown';
      
      console.log('üéØ SERVICE SELECTION TRACKED:', serviceName);
      
      // Use unified-tracking.js instead of direct API call
      if (window.unifiedTracking && typeof window.unifiedTracking.sendTrackingData === 'function') {
        window.unifiedTracking.sendTrackingData('service_selection', {
          service: service,
          serviceCode: service,
          serviceTitle: serviceName,
          serviceName: serviceName,
          placement: 'orange_service_card'
        });
      } else {
        console.warn('‚ö†Ô∏è unified-tracking.js not available, skipping service selection tracking');
      }
      
      if (typeof gtag !== 'undefined') {
        gtag('event', 'service_card_click', {
          'event_category': 'Service Selection',
          'event_label': serviceName,
          'service_code': service
        });
      }
      
      if (typeof rdt !== 'undefined') {
        rdt('track', 'Custom', {
          'customEventName': 'Service_Card_Click',
          'serviceType': serviceName,
          'serviceCode': service
        });
      }
    });
  });
  
  console.log('‚úÖ Service selection tracking v2.1 initialized for', document.querySelectorAll('.keyword-item').length, 'cards');
}

// Legacy function - now handled by centralized phone manager
function updatePhoneNumbers() {
  // Phone numbers are now handled by phone-manager.js
  // This function is kept for backward compatibility
}

// checkSystemStatus now reads from cached callflow state
async function checkSystemStatus() {
  const states = await fetchStatesOnce(false);
  const isActive = states.callflowState === 'Active' || states.callflowState === true;
  const debugSystemStatus = document.getElementById('debugSystemStatus');
  if (debugSystemStatus) {
    debugSystemStatus.textContent = isActive ? 'ACTIVE' : 'INACTIVE';
    debugSystemStatus.style.color = isActive ? '#0f0' : '#f00';
  }
  if (states.callflowState == null) {
    console.log('üîÑ Defaulting to ACTIVE due to missing callflow state');
    return true;
  }
  return isActive;
}

// Function to check if current time is within business hours (NZ time)
function isWithinBusinessHours() {
  const nzTime = new Date().toLocaleString("en-US", {timeZone: "Pacific/Auckland"});
  const now = new Date(nzTime);
  const day = now.getDay();
  const hour = now.getHours();
  const minutes = now.getMinutes();
  const time = hour + minutes / 60;
  
  let isOpen = false;
  if (day >= 1 && day <= 5) isOpen = time >= 7 && time < 17;
  if (day === 0 || day === 6) isOpen = time >= 7 && time < 12;
  
  const debugBusinessHours = document.getElementById('debugBusinessHours');
  const debugCurrentTime = document.getElementById('debugCurrentTime');
  
  if (debugBusinessHours) {
    debugBusinessHours.textContent = isOpen ? 'OPEN' : 'CLOSED';
    debugBusinessHours.style.color = isOpen ? '#0f0' : '#f00';
  }
  
  if (debugCurrentTime) {
    debugCurrentTime.textContent = now.toLocaleString() + ' (NZ Time)';
  }
  
  console.log('üïí Business hours check:', isOpen ? 'OPEN' : 'CLOSED', `(${now.toLocaleString()} NZ Time)`);
  return isOpen;
}

// Update UI based on system status
async function updateHoursDisplay() {
  console.log('üîÑ Starting updateHoursDisplay...');
  
  const urlParams = new URLSearchParams(window.location.search);
  const hasPaymentToken = urlParams.get('token');
  const hasGclid = extractGCLID(urlParams);
  
  const debugPaymentToken = document.getElementById('debugPaymentToken');
  if (debugPaymentToken) debugPaymentToken.textContent = hasPaymentToken ? 'YES' : 'NO';
  
  const states = await fetchStatesOnce(false);
  
  let systemActive;
  if ((hasGclid && states.gclidState === 'Active') || hasPaymentToken) {
    systemActive = true;
    console.log('üéØ GCLID+Active or token detected ‚Äî force ACTIVE');
  } else {
    systemActive = await checkSystemStatus();
  }
  
  const duringBusinessHours = isWithinBusinessHours();
  
  console.log('üìä Status Summary:', {
    systemActive,
    duringBusinessHours,
    hasPaymentToken: !!hasPaymentToken,
    hasGclid: !!hasGclid,
    gclidState: states.gclidState,
    callflowState: states.callflowState
  });
  
  // Show/hide based on system state
  const normalElements = document.querySelectorAll('.normal-hours-btn, .normal-hours-only');
  const afterHoursElements = document.querySelectorAll('.after-hours-btn');
  
  if (systemActive) {
    // PHONES ARE ON - Show call buttons, hide booking
    normalElements.forEach(el => {
      if (el.style) el.style.display = '';
    });
    afterHoursElements.forEach(el => {
      if (el.style) el.style.display = 'none';
    });
    
    // Update modal buttons to show "Call Now"
    updateModalButtons();
    
    const closedBanner = document.getElementById('closedBanner');
    const phonesBusyBanner = document.getElementById('phonesBusyBanner');
    if (closedBanner) closedBanner.style.display = 'none';
    if (phonesBusyBanner) phonesBusyBanner.style.display = 'none';
    
    const stickyCall = document.getElementById('stickyCallButton');
    const stickyClosed = document.getElementById('stickyClosedButton');
    if (stickyCall) stickyCall.style.display = 'inline-block';
    if (stickyClosed) stickyClosed.style.display = 'none';
    
    console.log('‚úÖ PHONES ON - Showing call buttons');
  } else {
    // PHONES ARE OFF - Show booking buttons, hide call
    normalElements.forEach(el => {
      if (el.style) el.style.display = 'none';
    });
    afterHoursElements.forEach(el => {
      if (el.style) el.style.display = 'block';
    });
    
    // Update modal buttons to show "Book Online"
    updateModalButtons();
    
    const closedBanner = document.getElementById('closedBanner');
    const closedTitle = document.getElementById('closedTitle');
    const afterHoursMessage = document.getElementById('afterHoursMessage');
    const tempUnavailableMessage = document.getElementById('tempUnavailableMessage');
    const phonesBusyBanner = document.getElementById('phonesBusyBanner');
    
    // Show appropriate banner
    if (duringBusinessHours) {
      if (phonesBusyBanner) phonesBusyBanner.style.display = 'block';
      if (closedBanner) {
        closedBanner.style.display = 'block';
        if (closedTitle) closedTitle.innerHTML = 'üöß PHONE LINES BUSY';
        if (afterHoursMessage) afterHoursMessage.style.display = 'none';
        if (tempUnavailableMessage) tempUnavailableMessage.style.display = 'block';
      }
    } else {
      if (phonesBusyBanner) phonesBusyBanner.style.display = 'none';
      if (closedBanner) {
        closedBanner.style.display = 'block';
        if (closedTitle) closedTitle.innerHTML = 'üïê CURRENTLY CLOSED';
        if (afterHoursMessage) afterHoursMessage.style.display = 'block';
        if (tempUnavailableMessage) tempUnavailableMessage.style.display = 'none';
      }
    }
    
    // Update sticky button
    const stickyCall = document.getElementById('stickyCallButton');
    const stickyClosed = document.getElementById('stickyClosedButton');
    if (stickyCall) stickyCall.style.display = 'none';
    if (stickyClosed) {
      stickyClosed.style.display = 'inline-block';
      stickyClosed.innerHTML = 'üìÖ Book Now';
    }
    
    // Add urgency badges to service cards
    document.querySelectorAll('.keyword-item').forEach(item => {
      if (!item.querySelector('.urgency-badge')) {
        const badge = document.createElement('div');
        badge.className = 'urgency-badge';
        badge.innerHTML = '<span style="background:#dc3545;color:#fff;padding:6px 12px;border-radius:20px;font-size:0.85em;font-weight:700;display:inline-block;margin-top:10px;">‚ö° BOOK NOW - LIMITED SLOTS</span>';
        item.appendChild(badge);
      }
    });
    
    console.log('üìÖ PHONES OFF - Showing booking buttons');
  }
  
  console.log('‚úÖ updateHoursDisplay v2.1 completed - System is', systemActive ? 'ACTIVE' : 'INACTIVE');
}

/* === INCOMING CALL CORRELATION WEBHOOK === */
// Now uses unified-tracking.js instead of direct API calls
(function(){
  window.correlateIncomingCall = function(callerID, internalNumber) {
    const sessionId = localStorage.getItem("eek_session_id");
    const lastCallAttemptId = localStorage.getItem("eek_last_call_attempt_id");
    const lastCallTimestamp = localStorage.getItem("eek_last_call_timestamp");
    const gclid = localStorage.getItem("eek_gclid");
    
    if (!sessionId) return;
    
    const payload = {
      eventType: "incoming_call_correlation",
      timestamp: new Date().toISOString(),
      sessionId: sessionId,
      callerID: callerID,
      internalNumber: internalNumber,
      lastCallAttemptId: lastCallAttemptId,
      lastCallTimestamp: lastCallTimestamp,
      gclid: gclid,
      correlationSuccess: true
    };
    
    // Use unified-tracking.js instead of direct API call
    if (window.unifiedTracking && typeof window.unifiedTracking.sendTrackingData === 'function') {
      window.unifiedTracking.sendTrackingData('incoming_call_correlation', {
        callerID: callerID,
        internalNumber: internalNumber,
        lastCallAttemptId: lastCallAttemptId,
        lastCallTimestamp: lastCallTimestamp,
        correlationSuccess: true
      }).then(() => {
        console.log('‚úÖ Call correlated with GCLID:', gclid);
      }).catch(() => {});
    } else {
      console.warn('‚ö†Ô∏è unified-tracking.js not available, skipping call correlation');
    }
  };
})();

/* === ENHANCED CALL-CLICK WEBHOOK WITH GCLID/GBRAID/WBRAID === */
// Now uses unified-tracking.js instead of direct API calls
(function(){
  function getOrCreateSessionId(){
    let sid = localStorage.getItem("eek_session_id");
    if (!sid){
      sid = "session_" + Date.now() + "_" + Math.random().toString(36).slice(2,11);
      localStorage.setItem("eek_session_id", sid);
    }
    return sid;
  }

  function getUTM(){
    const q = new URLSearchParams(location.search);
    const gclid = extractGCLID(q);
    return {
      source: q.get("utm_source") || null,
      medium: q.get("utm_medium") || null,
      campaign: q.get("utm_campaign") || null,
      term: q.get("utm_term") || null,
      content: q.get("utm_content") || null,
      gclid: gclid,
      msclkid: q.get("msclkid") || null,
      fbclid: q.get("fbclid") || null,
      rdtclid: q.get("rdtclid") || null
    };
  }

  function getAndStoreGCLID(){
    const urlParams = new URLSearchParams(location.search);
    let gclid = extractGCLID(urlParams);
    if (gclid) {
      localStorage.setItem("eek_gclid", gclid);
      localStorage.setItem("eek_gclid_timestamp", new Date().toISOString());
      return gclid;
    }
    const storedGclid = localStorage.getItem("eek_gclid");
    const storedTimestamp = localStorage.getItem("eek_gclid_timestamp");
    if (storedGclid && storedTimestamp) {
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      if (new Date(storedTimestamp) > thirtyDaysAgo) {
        return storedGclid;
      } else {
        localStorage.removeItem("eek_gclid");
        localStorage.removeItem("eek_gclid_timestamp");
      }
    }
    return null;
  }

  // Enhanced visitor data persistence
  function storeVisitorData(data) {
    const visitorData = JSON.parse(localStorage.getItem('eek_visitor_data') || '{}');
    
    // Merge new data with existing data
    Object.assign(visitorData, data);
    
    // Add timestamp for data freshness
    visitorData.lastUpdated = new Date().toISOString();
    
    localStorage.setItem('eek_visitor_data', JSON.stringify(visitorData));
    
    console.log('‚úÖ Visitor data stored:', data);
    return visitorData;
  }

  function getVisitorData() {
    return JSON.parse(localStorage.getItem('eek_visitor_data') || '{}');
  }

  function clearVisitorData() {
    localStorage.removeItem('eek_visitor_data');
    console.log('üóëÔ∏è Visitor data cleared');
  }

  // Enhanced visitor journey tracking
  function trackVisitorJourney(action, data = {}) {
    const journey = JSON.parse(localStorage.getItem('eek_visitor_journey') || '[]');
    const sessionId = localStorage.getItem("eek_session_id");
    const gclid = localStorage.getItem("eek_gclid");
    const visitorData = getVisitorData();
    
    const journeyEntry = {
      timestamp: new Date().toISOString(),
      sessionId: sessionId,
      gclid: gclid,
      action: action,
      page: {
        url: window.location.href,
        path: window.location.pathname,
        title: document.title,
        referrer: document.referrer
      },
      data: data,
      visitorData: visitorData // Include current visitor data
    };
    
    journey.push(journeyEntry);
    
    // Keep last 20 journey entries
    if (journey.length > 20) {
      journey.splice(0, journey.length - 20);
    }
    
    localStorage.setItem('eek_visitor_journey', JSON.stringify(journey));
    
    // Send to tracking API
    sendJourneyTracking(journeyEntry);
    
    return journeyEntry;
  }

  async function sendJourneyTracking(journeyEntry) {
    try {
      // Use unified-tracking.js instead of direct API call
      if (window.unifiedTracking && typeof window.unifiedTracking.sendTrackingData === 'function') {
        await window.unifiedTracking.sendTrackingData('visitor_journey', {
          eventAction: journeyEntry.action,
          journeyData: journeyEntry.data,
          page: journeyEntry.page,
          source: 'journey_tracking'
        });
        console.log('‚úÖ Journey tracking sent:', journeyEntry.action);
      } else {
        console.warn('‚ö†Ô∏è unified-tracking.js not available, skipping journey tracking');
      }
    } catch (error) {
      console.error('‚ùå Journey tracking failed:', error);
    }
  }

  function closestPlacement(el){
    if (!el) return null;
    if (el.id) return "#" + el.id;
    const withId = el.closest("[id]");
    if (withId) return "#" + withId.id;
    
    // Try to identify the button by its classes and context
    if (el.classList && el.classList.contains('cta-button')) {
      return '.cta-button';
    }
    if (el.classList && el.classList.contains('normal-hours-btn')) {
      return '.normal-hours-btn';
    }
    
    return null;
  }

  function getServiceType(eventAction) {
    const serviceMap = {
      'jumpstart_call': 'Jump Start Service',
      'repairs_call': 'Mobile Mechanical Repairs',
      'inspection_call': 'Pre-Purchase Inspection',
      'fuel_drain_call': 'Wrong Fuel Rescue',
      'emergency_breakdown': 'Emergency Breakdown',
      'battery_jumpstart': 'Battery Jump Start',
      'wrong_fuel': 'Wrong Fuel Emergency',
      'pre_purchase': 'Pre-Purchase Inspection',
      'post_job': 'Post-Job Support'
    };
    return serviceMap[eventAction] || 'General Service';
  }

  window.sendCallClick = async function(eventAction, eventCategory, anchorEl){
    const callAttemptId = "call_" + Date.now() + "_" + Math.random().toString(36).slice(2,10);
    const sessionId = getOrCreateSessionId();
    const gclid = getAndStoreGCLID();
    
    // Get current GCLID state from cached states, with fallback
    let gclidState = window.eek_states?.gclidState || null;
    
    console.log('üîç GCLID State Debug:', {
      gclid: gclid,
      cachedGclidState: window.eek_states?.gclidState,
      gclidState: gclidState,
      eekStates: window.eek_states
    });
    
    // If no GCLID state is available, try to fetch it
    if (gclidState === null && gclid) {
      console.log('üîÑ GCLID state not available, attempting to fetch...');
      try {
        const states = await fetchStatesOnce(false);
        gclidState = states.gclidState;
        console.log('‚úÖ Fetched GCLID state:', gclidState);
      } catch (error) {
        console.warn('‚ö†Ô∏è Could not fetch GCLID state:', error);
        gclidState = 'Unknown';
      }
    } else if (!gclid) {
      console.log('‚ÑπÔ∏è No GCLID present, setting state to null');
      gclidState = null;
    }
    
    const payload = {
      eventType: "call_click",
      timestamp: new Date().toISOString(),
      sessionId: sessionId,
      callAttemptId: callAttemptId,
      gclid: gclid,
      gclidState: gclidState,
      phoneTarget: (anchorEl && anchorEl.getAttribute("href") && anchorEl.getAttribute("href").startsWith("tel:")) 
        ? anchorEl.getAttribute("href") 
        : "tel:0800769000",
      button: {
        eventAction: eventAction || "phone_call",
        eventCategory: eventCategory || "Contact",
        serviceType: (typeof getServiceType === "function") ? getServiceType(eventAction) : undefined,
        placement: anchorEl ? closestPlacement(anchorEl) : null,
        text: anchorEl ? (anchorEl.textContent || "").trim() : null,
        buttonId: anchorEl ? (anchorEl.id || null) : null,
        buttonClass: anchorEl ? (anchorEl.className || null) : null,
        buttonType: anchorEl ? (anchorEl.tagName || null) : null,
        href: anchorEl ? (anchorEl.getAttribute("href") || null) : null,
        onclick: anchorEl ? (anchorEl.getAttribute("onclick") || null) : null
      },
      site: {
        domain: location.hostname,
        url: location.href,
        path: location.pathname,
        title: document.title,
        referrer: document.referrer || null
      },
      utm: getUTM(),
      device: {
        userAgent: navigator.userAgent,
        platform: navigator.platform || null,
        language: navigator.language || null,
        mobile: /Mobi|Android/i.test(navigator.userAgent),
        screen: {
          width: (window.screen && window.screen.width) || null,
          height: (window.screen && window.screen.height) || null,
          pixelRatio: window.devicePixelRatio || 1
        }
      },
      status: "pending"
    };

    try {
      localStorage.setItem("eek_last_call_attempt_id", callAttemptId);
      localStorage.setItem("eek_last_call_timestamp", payload.timestamp);
      if (gclid) localStorage.setItem("eek_last_gclid", gclid);
      
      // Track call in visitor journey
      trackVisitorJourney('phone_call_clicked', {
        callAttemptId: callAttemptId,
        phoneTarget: payload.phoneTarget,
        serviceType: payload.button.serviceType,
        placement: payload.button.placement,
        buttonText: payload.button.text
      });
    } catch (_) {}

    // Use unified-tracking.js instead of direct API call
    if (window.unifiedTracking && typeof window.unifiedTracking.sendTrackingData === 'function') {
      window.unifiedTracking.sendTrackingData('call_click', {
        callAttemptId: callAttemptId,
        gclidState: gclidState,
        phoneTarget: payload.phoneTarget,
        button: payload.button,
        status: payload.status
      }).then(() => {
        console.log('‚úÖ Call click tracked with GCLID/GBRAID/WBRAID:', gclid);
      }).catch(error => {
        console.error('‚ùå Call click failed:', error);
      });
    } else {
      console.warn('‚ö†Ô∏è unified-tracking.js not available, skipping call click tracking');
    }
  }

  document.addEventListener("click", function(ev){
    const a = ev.target && ev.target.closest && ev.target.closest('a[href^="tel:"]');
    if (a) window.__eek_last_tel_anchor = a;
  }, true);

  const _origTrack = window.trackConversion || function(){};
  window.trackConversion = async function(eventAction, eventCategory){
    try {
      if (eventAction && /call/i.test(eventAction)){
        // Find the button that was clicked by looking for the eventAction in the onclick attribute
        const clickedButton = document.querySelector(`[onclick*="${eventAction}"]`);
        await sendCallClick(eventAction, eventCategory, clickedButton || window.__eek_last_tel_anchor || null);
      }
    } catch(_) {}
    return _origTrack.apply(this, arguments);
  };

  window.addEventListener('load', function() {
    const gclid = getAndStoreGCLID();
    if (gclid) console.log('GCLID/GBRAID/WBRAID detected and stored for persistent tracking:', gclid);
  });
})();

// Legacy tracking function - now handled by centralized tracking manager
// Kept for backward compatibility
function trackConversion(eventAction, eventCategory) {
  if (window.trackingManager && typeof window.trackingManager.trackConversion === 'function') {
    window.trackingManager.trackConversion(eventAction, eventCategory);
  } else {
    // Fallback to unified tracking if available
    if (window.unifiedTracking && typeof window.unifiedTracking.trackEvent === 'function') {
      window.unifiedTracking.trackEvent('conversion', {
        eventAction: eventAction,
        eventCategory: eventCategory,
        source: 'legacy_trackConversion'
      });
    }
    console.warn('trackConversion called but trackingManager not ready:', eventAction, eventCategory);
  }
}

// Check for return visit from booking link
function checkReturnVisit() {
  const urlParams = new URLSearchParams(window.location.search);
  const callAttemptId = urlParams.get('call_attempt_id');
  const callTimestamp = urlParams.get('call_timestamp');
  const sessionId = urlParams.get('session_id');
  
  if (callAttemptId && callTimestamp) {
    // This is a return visit from a booking link
    const returnVisitData = {
      callAttemptId: callAttemptId,
      callTimestamp: callTimestamp,
      returnTimestamp: new Date().toISOString(),
      timeBetweenCallAndReturn: new Date() - new Date(callTimestamp),
      source: 'booking_link_return'
    };
    
    // Track the return visit
    trackVisitorJourney('booking_link_return_visit', returnVisitData);
    
    // Store return visit data
    localStorage.setItem('eek_return_visit_data', JSON.stringify(returnVisitData));
    
    // Send return visit tracking event to Power Automate API
    if (window.unifiedTracking && typeof window.unifiedTracking.sendTrackingData === 'function') {
      window.unifiedTracking.sendTrackingData('return_visit', {
        eventAction: 'return_visit',
        callAttemptId: callAttemptId,
        callTimestamp: callTimestamp,
        returnTimestamp: returnVisitData.returnTimestamp,
        timeBetweenCallAndReturn: returnVisitData.timeBetweenCallAndReturn,
        returnSource: 'booking_link'
      });
    }
    
    console.log('‚úÖ Return visit detected from booking link:', returnVisitData);
  }
  
  // Check if this is a return visit with session continuity
  const storedSessionId = localStorage.getItem("eek_session_id");
  if (sessionId && storedSessionId && sessionId === storedSessionId) {
    trackVisitorJourney('session_continuity_return', {
      sessionId: sessionId,
      returnSource: 'session_continuity'
    });
  }
}

// Initialize on page load
window.addEventListener('load', function() {
  console.log('üöÄ Page loaded - initializing...');
  
  // Check for return visit from booking link
  checkReturnVisit();
  
  startStatePoller(5 * 60 * 1000);
  updatePhoneNumbers();
  updateServiceLinks();
  handleServiceSelection();
  trackServiceSelection();
  updateHoursDisplay();
  
  setInterval(updateHoursDisplay, 5 * 60 * 1000);
  
  console.log('‚úÖ Initialization v2.1 complete');
});

// TOKEN PAYMENT FUNCTIONALITY
(function () {
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token');

  const box = document.getElementById('stripePaymentBlock');
  const checkbox = document.getElementById('termsCheckbox');
  const button = document.getElementById('payNowButton');
  const sticky = document.getElementById('stripePaymentSticky');

  // Hide payment button by default
  if (sticky) {
    sticky.style.display = 'none';
  }
  
  if (token && box && checkbox && button && sticky) {
    console.log('üí≥ Payment token detected, setting up payment UI');
    
    // Add payment mode class to body for CSS targeting
    document.body.classList.add('payment-mode');
    
    box.style.display = 'block';
    sticky.style.display = 'inline-block';
    
    // Hide ALL sticky buttons with force
    document.querySelectorAll('.sticky-call, #stickyCallButton, #stickyClosedButton').forEach(el => {
      if (el) {
        el.style.display = 'none';
        el.style.visibility = 'hidden';
      }
    });
    
    // Hide ALL call buttons
    const normalButtons = document.querySelectorAll('.normal-hours-btn');
    normalButtons.forEach(btn => { if (btn.style) btn.style.display = 'none'; });
    
    // Hide header
    const header = document.querySelector('header');
    if (header) header.style.display = 'none';
    
    // Hide normal hours elements
    document.querySelectorAll('.normal-hours-only').forEach(el => {
      if (el.style) el.style.display = 'none';
    });
    
    // Hide social proof box
    const socialProof = document.querySelector('.social-proof-box');
    if (socialProof) socialProof.style.display = 'none';
    
    // Hide phones busy banner
    const phonesBusyBanner = document.getElementById('phonesBusyBanner');
    if (phonesBusyBanner) phonesBusyBanner.style.display = 'none';
    
    // Hide all phone links and displays
    document.querySelectorAll('.phone-link, .phone-display').forEach(el => {
      if (el.style) el.style.display = 'none';
    });
    
    // Hide service selection orange boxes
    const serviceSelection = document.getElementById('service-selection');
    if (serviceSelection) serviceSelection.style.display = 'none';
    
    // Hide all service sections (breakdown, battery, fuel, inspection) except reviews
    document.querySelectorAll('.services').forEach(section => {
      if (section.id && section.id !== 'customer-reviews') {
        section.style.display = 'none';
      }
    });

    sticky.href = '#stripePaymentBlock';

    checkbox.addEventListener('change', () => {
      button.style.display = checkbox.checked ? 'inline-block' : 'none';
    });

    button.addEventListener('click', () => {
      window.location.href = `https://buy.stripe.com/${token}`;
    });
    
    console.log('üí≥ Payment UI setup complete - all distractions hidden');
  }
})();

// More Info Modal Functions
function openMoreModal(serviceType) {
  const modal = document.getElementById('moreInfoModal');
  const title = document.getElementById('moreInfoTitle');
  const body = document.getElementById('moreInfoBody');
  
  if (!modal || !title || !body) return;
  
  // Set title and content based on service type
  const serviceData = getServiceData(serviceType);
  title.textContent = serviceData.title;
  body.innerHTML = serviceData.content;
  
  // Update button text based on phone system status
  updateModalButtons();
  
  // Send unified tracking event for modal open
  if (window.unifiedTracking && typeof window.unifiedTracking.sendTrackingData === 'function') {
    const serviceMap = {
      'jumpstarts': { service: 'jump_start', serviceCode: 'JUMP', serviceTitle: 'Jump Start', price: 149 },
      'repairs': { service: 'mechanical_repair', serviceCode: 'REPAIR', serviceTitle: 'Mobile Mechanical Repair', price: 249 },
      'inspections': { service: 'inspection', serviceCode: 'INSP', serviceTitle: 'Pre-Purchase Inspection', price: 299 },
      'fuel': { service: 'fuel_extraction', serviceCode: 'FUEL', serviceTitle: 'Wrong Fuel Rescue', price: 399 }
    };
    const svc = serviceMap[serviceType] || { service: serviceType, serviceCode: serviceType, serviceTitle: serviceData.title || 'Service', price: undefined };
    window.unifiedTracking.sendTrackingData('more_info_open', {
      service: svc.service,
      serviceCode: svc.serviceCode,
      serviceTitle: svc.serviceTitle,
      price: svc.price,
      basePrice: svc.price,
      source: 'more_info_modal'
    });
  }
  
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

// Update modal buttons based on phone system status
function updateModalButtons() {
  const modalButtons = document.querySelectorAll('#moreInfoModal .cta-button');
  
  // Check if normal hours buttons are visible (indicates phones are on)
  const normalButtons = document.querySelectorAll('.normal-hours-btn');
  const isSystemActive = normalButtons.length > 0 && normalButtons[0].style.display !== 'none';
  
  modalButtons.forEach(button => {
    if (isSystemActive) {
      // Phones are on - show Call Now
      button.textContent = 'üìû Call Now';
      button.style.display = 'inline-block';
    } else {
      // Phones are off - show Book Online
      button.textContent = 'üìÖ Book Online';
      button.style.display = 'inline-block';
    }
  });
}

// Handle More Info modal action - either call or book based on phone status
async function handleMoreInfoAction(serviceType) {
  // Check if normal hours buttons are visible (indicates phones are on)
  const normalButtons = document.querySelectorAll('.normal-hours-btn');
  const isSystemActive = normalButtons.length > 0 && normalButtons[0].style.display !== 'none';
  
  // Close the modal first
  closeMoreModal();
  
  // Prepare unified tracking payload details
  const serviceMap = {
    'jumpstarts': { service: 'jump_start', serviceCode: 'JUMP', serviceTitle: 'Jump Start', price: 149 },
    'repairs': { service: 'mechanical_repair', serviceCode: 'REPAIR', serviceTitle: 'Mobile Mechanical Repair', price: 249 },
    'inspections': { service: 'inspection', serviceCode: 'INSP', serviceTitle: 'Pre-Purchase Inspection', price: 299 },
    'fuel': { service: 'fuel_extraction', serviceCode: 'FUEL', serviceTitle: 'Wrong Fuel Rescue', price: 399 }
  };
  const svc = serviceMap[serviceType] || { service: serviceType, serviceCode: serviceType, serviceTitle: serviceType, price: undefined };

  if (isSystemActive) {
    // Phones are on - open service modal for calling
    openServiceModal();
    
    // Track the action
    if (typeof gtag !== 'undefined') {
      gtag('event', 'more_info_call_click', {
        service_type: serviceType,
        action: 'call',
        source: 'more_info_modal',
        event_category: 'engagement'
      });
    }
    
    // Track with unified tracking (event + API payload)
    if (window.unifiedTracking) {
      window.unifiedTracking.trackEvent('more_info_call_click', 'Service', serviceType, { action: 'call', source: 'more_info_modal' });
      if (typeof window.unifiedTracking.sendTrackingData === 'function') {
        window.unifiedTracking.sendTrackingData('more_info_call_click', {
          service: svc.service,
          serviceCode: svc.serviceCode,
          serviceTitle: svc.serviceTitle,
          price: svc.price,
          basePrice: svc.price,
          bookingStatus: 'NEW',
          action: 'call',
          source: 'more_info_modal'
        });
      }
    }
    
    // Store call attempt data for return visit tracking
    await sendCallClick('more_info_call_click', 'Service', null);
  } else {
    // Phones are off - redirect to booking page
    const serviceSlugMap = {
      'jumpstarts': 'jumpstart',
      'repairs': 'mechanic', 
      'inspections': 'inspection',
      'fuel': 'fuel-extraction'
    };
    const bookingService = serviceSlugMap[serviceType] || 'jumpstart';
    const trackingParams = (typeof buildTrackingParams === 'function') ? buildTrackingParams() : '';
    const bookingUrl = trackingParams ? `/book-service/?service=${bookingService}&${trackingParams}` : `/book-service/?service=${bookingService}`;
    
    // Track the action
    if (typeof gtag !== 'undefined') {
      gtag('event', 'more_info_book_click', {
        service_type: serviceType,
        action: 'book',
        source: 'more_info_modal',
        event_category: 'conversion'
      });
    }
    
    // Track with unified tracking (event + API payload)
    if (window.unifiedTracking) {
      window.unifiedTracking.trackEvent('more_info_book_click', 'Service', serviceType, { action: 'book', source: 'more_info_modal' });
      if (typeof window.unifiedTracking.sendTrackingData === 'function') {
        window.unifiedTracking.sendTrackingData('more_info_book_click', {
          service: svc.service,
          serviceCode: svc.serviceCode,
          serviceTitle: svc.serviceTitle,
          price: svc.price,
          basePrice: svc.price,
          bookingStatus: 'NEW',
          action: 'book',
          source: 'more_info_modal'
        });
      }
    }
    
    // Redirect to booking
    window.location.href = bookingUrl;
  }
}

function closeMoreModal() {
  const modal = document.getElementById('moreInfoModal');
  if (modal) {
    modal.style.display = 'none';
    document.body.style.overflow = '';
  }
}

function getServiceData(serviceType) {
  const serviceData = {
    jumpstarts: {
      title: 'üîã Jump Start Service - Complete Information',
      content: `
        <div class="more-info-section">
          <h4>üöÄ Why Choose Our Jump Start Service?</h4>
          <ul>
            <li><strong>Professional Equipment:</strong> We use commercial-grade jump start packs that work with all vehicle types</li>
            <li><strong>Battery Health Check:</strong> FREE battery voltage and condition assessment included</li>
            <li><strong>All Vehicle Types:</strong> Cars, SUVs, utes, motorcycles, boats, and more</li>
            <li><strong>Safe & Reliable:</strong> Our mechanics are trained in proper jump start procedures</li>
            <li><strong>No Damage Risk:</strong> We know how to safely connect to modern vehicles with sensitive electronics</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>‚ö° What Happens When You Call?</h4>
          <ul>
            <li><strong>Immediate Dispatch:</strong> We typically arrive within 10-30 minutes</li>
            <li><strong>Professional Assessment:</strong> We check your battery condition and charging system</li>
            <li><strong>Safe Jump Start:</strong> Proper connection and jump start procedure</li>
            <li><strong>Battery Advice:</strong> We'll tell you if your battery needs replacement</li>
            <li><strong>Follow-up:</strong> We ensure your vehicle starts reliably before leaving</li>
          </ul>
        </div>
        
        <div class="pricing-box">
          <h4>üí∞ Transparent Pricing</h4>
          <div class="price">From $149</div>
          <p>Includes jump start, battery check, and 30-day warranty on service</p>
        </div>
        
        <div class="more-info-section">
          <h4>üõ°Ô∏è Why This Service Matters</h4>
          <ul>
            <li><strong>Prevent Engine Damage:</strong> Improper jump starting can damage your vehicle's electronics</li>
            <li><strong>Battery Replacement Guidance:</strong> We'll tell you if you need a new battery and why</li>
            <li><strong>Peace of Mind:</strong> Professional service means no guesswork</li>
            <li><strong>Time Saving:</strong> Get back on the road quickly and safely</li>
          </ul>
        </div>
        
        <div class="cta-section">
          <a href="javascript:void(0)" onclick="handleMoreInfoAction('jumpstarts')" class="cta-button normal-hours-btn">üìû Call Now</a>
        </div>
      `
    },
    repairs: {
      title: 'üõ†Ô∏è Mobile Mechanical Repairs - Complete Information',
      content: `
        <div class="more-info-section">
          <h4>üöÄ Why Choose Our Mobile Repair Service?</h4>
          <ul>
            <li><strong>Fully Equipped Workshop:</strong> Our mobile mechanics carry professional diagnostic tools and parts</li>
            <li><strong>On-Site Repairs:</strong> Most common issues fixed where you are - no towing needed</li>
            <li><strong>Professional Diagnostics:</strong> Computer scanning and fault detection capabilities</li>
            <li><strong>Quality Parts:</strong> We use quality replacement parts with warranties</li>
            <li><strong>Transparent Pricing:</strong> No hidden fees - you know the cost before we start</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>üîß What We Can Fix On-Site</h4>
          <ul>
            <li><strong>Engine Issues:</strong> Starting problems, rough idle, stalling</li>
            <li><strong>Electrical Problems:</strong> Battery, alternator, starter motor issues</li>
            <li><strong>Brake Repairs:</strong> Pad replacement, brake fluid service</li>
            <li><strong>Fluid Services:</strong> Oil changes, coolant, transmission fluid</li>
            <li><strong>Minor Repairs:</strong> Belts, hoses, filters, and more</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>‚ö° Our Process</h4>
          <ul>
            <li><strong>Diagnostic Scan:</strong> Computer diagnosis to identify the exact problem</li>
            <li><strong>Clear Explanation:</strong> We explain what's wrong and what needs fixing</li>
            <li><strong>Upfront Pricing:</strong> You approve the work before we start</li>
            <li><strong>Quality Repair:</strong> Professional repair using quality parts</li>
            <li><strong>Testing & Verification:</strong> We test the repair to ensure it works properly</li>
          </ul>
        </div>
        
        <div class="pricing-box">
          <h4>üí∞ Transparent Pricing</h4>
          <div class="price">From $249</div>
          <p>Includes diagnostic, repair, and 90-day warranty on parts and labor</p>
        </div>
        
        <div class="cta-section">
          <a href="javascript:void(0)" onclick="handleMoreInfoAction('repairs')" class="cta-button normal-hours-btn">üìû Call Now</a>
        </div>
      `
    },
    inspections: {
      title: 'üîç Pre-Purchase Inspections - Complete Information',
      content: `
        <div class="more-info-section">
          <h4>üöÄ Why Our Inspection Service is Different</h4>
          <ul>
            <li><strong>Same-Day Service:</strong> Most competitors take 2-3 days - we inspect today</li>
            <li><strong>Workshop Hoist Inspection:</strong> Not driveway mobile - we use proper workshop facilities</li>
            <li><strong>45-Point Certified Check:</strong> Comprehensive inspection covering all major systems</li>
            <li><strong>Professional Valuation:</strong> We tell you what the car is actually worth</li>
            <li><strong>Detailed Report:</strong> Written report with photos and maintenance recommendations</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>üîç What We Inspect</h4>
          <ul>
            <li><strong>Engine & Transmission:</strong> Performance, leaks, wear indicators</li>
            <li><strong>Braking System:</strong> Pads, discs, fluid, ABS functionality</li>
            <li><strong>Electrical Systems:</strong> Battery, alternator, lights, electronics</li>
            <li><strong>Body & Chassis:</strong> Rust, accident damage, structural integrity</li>
            <li><strong>Safety Systems:</strong> Airbags, seatbelts, safety recalls</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>üí∞ What You Get</h4>
          <ul>
            <li><strong>Detailed Written Report:</strong> Complete assessment with photos</li>
            <li><strong>Price Recommendation:</strong> Fair market value assessment</li>
            <li><strong>Maintenance Schedule:</strong> What needs fixing now vs later</li>
            <li><strong>Safety Assessment:</strong> Is this car safe to drive?</li>
            <li><strong>Negotiation Power:</strong> Use our report to negotiate a better price</li>
          </ul>
        </div>
        
        <div class="pricing-box">
          <h4>üí∞ Transparent Pricing</h4>
          <div class="price">From $299</div>
          <p>Standard vehicles - includes full inspection and detailed report</p>
          <p><strong>Specialty vehicles:</strong> +$129 (classics, modified, rare imports)</p>
        </div>
        
        <div class="more-info-section">
          <h4>üõ°Ô∏è Why This Inspection Matters</h4>
          <ul>
            <li><strong>1 in 5 Cars Rejected:</strong> 20% of vehicles we inspect have major hidden problems</li>
            <li><strong>Save Thousands:</strong> Avoid buying a car that needs expensive repairs</li>
            <li><strong>Peace of Mind:</strong> Know exactly what you're buying</li>
            <li><strong>Better Negotiation:</strong> Use our report to get a fair price</li>
          </ul>
        </div>
        
        <div class="cta-section">
          <a href="javascript:void(0)" onclick="handleMoreInfoAction('inspections')" class="cta-button normal-hours-btn">üìû Call Now</a>
        </div>
      `
    },
    fuel: {
      title: '‚õΩ Wrong Fuel Rescue - Complete Information',
      content: `
        <div class="more-info-section">
          <h4>üö® Why This is an Emergency</h4>
          <ul>
            <li><strong>Engine Damage Risk:</strong> Starting the engine can cause thousands in damage</li>
            <li><strong>Fuel System Contamination:</strong> Wrong fuel can damage injectors, pumps, and filters</li>
            <li><strong>Immediate Action Required:</strong> The longer you wait, the more damage occurs</li>
            <li><strong>Professional Equipment:</strong> We have specialized fuel removal equipment</li>
            <li><strong>Fully Insured Service:</strong> We're covered for any accidental damage</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>‚ö° What We Do</h4>
          <ul>
            <li><strong>Immediate Response:</strong> Priority dispatch for wrong fuel emergencies</li>
            <li><strong>Professional Assessment:</strong> We determine the extent of contamination</li>
            <li><strong>Complete Fuel Removal:</strong> Drain and flush the entire fuel system</li>
            <li><strong>System Cleaning:</strong> Clean fuel lines, injectors, and filters</li>
            <li><strong>Fresh Fuel Addition:</strong> Add the correct fuel and test the system</li>
          </ul>
        </div>
        
        <div class="more-info-section">
          <h4>üõ°Ô∏è Why Choose Our Service</h4>
          <ul>
            <li><strong>Specialized Equipment:</strong> Professional fuel removal and flushing equipment</li>
            <li><strong>Experienced Technicians:</strong> We've handled hundreds of wrong fuel cases</li>
            <li><strong>No Towing Required:</strong> We fix it on-site - no expensive tow truck needed</li>
            <li><strong>Warranty on Work:</strong> 30-day warranty on our fuel system cleaning</li>
            <li><strong>Insurance Coverage:</strong> Fully insured service for your peace of mind</li>
          </ul>
        </div>
        
        <div class="pricing-box">
          <h4>üí∞ Transparent Pricing</h4>
          <div class="price">From $399</div>
          <p>Mobile extraction service - includes complete fuel removal, system cleaning, and fresh fuel</p>
          <p><strong>Workshop service: $849 (complete system service)</strong></p>
          <p><strong>Much cheaper than engine damage repair!</strong></p>
        </div>
        
        <div class="more-info-section">
          <h4>‚ö†Ô∏è What NOT to Do</h4>
          <ul>
            <li><strong>DON'T START THE ENGINE:</strong> This will circulate contaminated fuel through the system</li>
            <li><strong>DON'T DRIVE THE CAR:</strong> Even if it starts, you risk serious damage</li>
            <li><strong>DON'T WAIT:</strong> Call us immediately for the best outcome</li>
            <li><strong>DON'T TRY DIY:</strong> This requires professional equipment and expertise</li>
          </ul>
        </div>
        
        <div class="cta-section">
          <a href="javascript:void(0)" onclick="handleMoreInfoAction('fuel')" class="cta-button normal-hours-btn">üìû Call Now</a>
        </div>
      `
    }
  };
  
  return serviceData[serviceType] || { title: 'Service Information', content: 'No information available.' };
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
  const modal = document.getElementById('moreInfoModal');
  if (event.target === modal) {
    closeMoreModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeMoreModal();
  }
});

// Service Selection Modal functions moved to call-modal.js
</script>

<!-- Call Modal Scripts -->
        <script src="call-modal.js?v=20251020.36"></script>

<!-- Include Modal HTML -->
<script>
  // Load modal HTML dynamically
        fetch('call-modal.html?v=20250125')
    .then(response => response.text())
    .then(html => {
      document.body.insertAdjacentHTML('beforeend', html);
    })
    .catch(error => console.error('Error loading modal:', error));
</script>

</body>