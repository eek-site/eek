<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defamation Policy & Legal Action | Eek Mechanical Ltd</title>
  <meta name="description" content="Official defamation policy and legal action protocol for Eek Mechanical Ltd. Zero tolerance for false reviews." />
  
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://conversions-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com https://www.googleadservices.com https://www.google.hn https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com https://static.cloudflareinsights.com; frame-src 'self' https://td.doubleclick.net https://www.googletagmanager.com;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

  <!-- Reddit Pixel -->
  <script>
    !function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}
    (window,document);
    
    function getEmailFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const emailParam = urlParams.get('email');
      if (emailParam) return emailParam;
      
      const emailInputs = document.querySelectorAll('input[type="email"], input[name*="email"], input[id*="email"]');
      for (let input of emailInputs) {
        if (input.value && input.value.includes('@')) {
          return input.value;
        }
      }
      return null;
    }
    
    function getPhoneFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const phoneParam = urlParams.get('phone');
      if (phoneParam) return phoneParam;
      
      const phoneInputs = document.querySelectorAll('input[type="tel"], input[name*="phone"], input[id*="phone"]');
      for (let input of phoneInputs) {
        if (input.value) {
          return input.value;
        }
      }
      return null;
    }
    
    function getUserId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('uid') || urlParams.get('user_id') || urlParams.get('customer_id');
    }
    
    function getMobileIds() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        idfa: urlParams.get('idfa'),
        aaid: urlParams.get('aaid')
      };
    }
    
    const mobileIds = getMobileIds();
    const initConfig = {};
    
    const email = getEmailFromForm();
    const phoneNumber = getPhoneFromForm();
    const externalId = getUserId();
    
    if (email) initConfig.email = email;
    if (phoneNumber) initConfig.phoneNumber = phoneNumber;
    if (externalId) initConfig.externalId = externalId;
    if (mobileIds.idfa) initConfig.idfa = mobileIds.idfa;
    if (mobileIds.aaid) initConfig.aaid = mobileIds.aaid;
    
    rdt('init', 'a2_hf16791nsdhx', Object.keys(initConfig).length > 0 ? initConfig : undefined);
    rdt('track', 'PageVisit');
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084465163"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17084465163');
    gtag('config', 'G-DQNKF1YLWR');
  </script>
  
  <!-- Centralized Phone Number Management -->
  <script src="/phone-manager.js?v={{ site.version }}"></script>
  
  <!-- Unified Tracking System -->
  <script src="/unified-tracking.js?v={{ site.version }}"></script>
  
  <!-- Centralized Footer Management -->
  <script src="/footer-new.js?v={{ site.version }}"></script>

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <style>
    :root {
      --primary: #ff5500;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
      --success: #28a745;
      --dark: #343a40;
      --light: #f8f9fa;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #343a40;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, #ff7733 100%);
      color: white;
      padding: 60px 0;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .personalized-greeting {
      background: linear-gradient(135deg, #fff5f5, #ffe0e0);
      border: 2px solid #dc3545;
      border-radius: 12px;
      padding: 30px;
      margin: 30px auto;
      max-width: 1000px;
    }
    .personalized-greeting h2 {
      color: #dc3545;
      font-size: 1.8em;
      margin-bottom: 15px;
    }
    .personalized-greeting p {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #495057;
    }
    .section {
      background: white;
      margin: 30px auto;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-width: 1000px;
    }
    .section-title {
      font-size: 2em;
      margin-bottom: 25px;
      color: #dc3545;
      font-weight: 600;
    }
    .warning-box {
      background: #dc3545;
      color: white;
      padding: 25px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .warning-box h3 {
      color: white;
      margin-bottom: 15px;
    }
    .process-steps {
      margin: 25px 0;
    }
    .process-step {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      padding-bottom: 30px;
      border-bottom: 1px solid #e9ecef;
    }
    .process-step:last-child {
      border-bottom: none;
    }
    .step-number {
      background: #dc3545;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
      flex-shrink: 0;
    }
    .step-content h4 {
      color: #dc3545;
      margin-bottom: 10px;
      font-size: 1.2em;
    }
    .step-content p {
      color: #495057;
      line-height: 1.8;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .info-item {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .info-item strong {
      color: #dc3545;
      display: block;
      margin-bottom: 10px;
      font-size: 1.1em;
    }
    .legal-notice {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 25px;
      margin: 30px 0;
    }
    .legal-notice h4 {
      color: #856404;
      margin-bottom: 15px;
    }
    .financial-box {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
      padding: 30px;
      border-radius: 8px;
      margin: 30px 0;
    }
    .evidence-box {
      background: #e8f4fd;
      border-left: 4px solid #17a2b8;
      padding: 25px;
      border-radius: 4px;
      margin: 30px 0;
    }
    .success-box {
      background: #28a745;
      color: white;
      padding: 25px;
      border-radius: 8px;
      margin-top: 30px;
      text-align: center;
    }
    .dispute-options {
      background: #e8f4fd;
      border-left: 4px solid #17a2b8;
      padding: 25px;
      border-radius: 4px;
      margin: 30px 0;
    }
    .dispute-options h3 {
      color: #17a2b8;
      margin-bottom: 20px;
    }
    .dispute-option-card {
      background: white;
      border: 2px solid #17a2b8;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }
    .dispute-option-card:hover {
      box-shadow: 0 4px 12px rgba(23,162,184,0.3);
      transform: translateY(-2px);
    }
    .dispute-option-card h4 {
      color: #17a2b8;
      margin-bottom: 10px;
    }
    .acknowledgment-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    .acknowledgment-modal.active {
      display: flex;
    }
    .acknowledgment-modal.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: -1;
    }
    .acknowledgment-content {
      background: white;
      padding: 40px;
      border-radius: 12px;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    .acknowledgment-content h2 {
      color: #dc3545;
      margin-bottom: 20px;
    }
    .acknowledgment-checkbox {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .acknowledgment-checkbox label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-size: 1.1em;
    }
    .acknowledgment-checkbox input[type="checkbox"] {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    .acknowledgment-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
    }
    .acknowledgment-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .acknowledgment-btn:not(:disabled):hover {
      background: #c82333;
    }
    ul, ol {
      margin: 15px 0;
      padding-left: 25px;
    }
    li {
      margin-bottom: 10px;
    }
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }
      .section {
        padding: 25px;
        margin: 20px 10px;
      }
      .info-grid {
        grid-template-columns: 1fr;
      }
      .process-step {
        flex-direction: column;
      }
      .personalized-greeting {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Mandatory Acknowledgment Modal -->
  <div class="acknowledgment-modal active" id="acknowledgmentModal">
    <div class="acknowledgment-content">
      <h2>‚ö†Ô∏è Important Legal Notice - Please Read Carefully</h2>
      <p style="margin-bottom: 15px; font-size: 1.1em; font-weight: bold;">
        Dear <span id="modalCustomerNameGreeting">[Customer Name]</span>.
      </p>
      <p style="margin-bottom: 15px; font-size: 1.1em;">
        Eek Mechanical has identified that <span id="modalCustomerNameIdentified">you</span> have posted information online about the company that may be false, defamatory, or malicious. From here we are going to take the matter further through our legal response protocol. <span id="modalCustomerName">You</span> are about to view Eek Mechanical Limited's official defamation policy and legal action protocol. This document contains important information about <span id="modalCustomerName2">your</span> legal obligations under New Zealand law.
      </p>
      <p style="margin-bottom: 15px; font-size: 1.1em;">
        <strong>By proceeding, <span id="modalCustomerName3">you</span> acknowledge that:</strong>
      </p>
      <ul style="margin-bottom: 20px; padding-left: 20px;">
        <li><span id="modalCustomerName4">You</span> have read and understood the legal consequences of posting false, defamatory, or malicious reviews</li>
        <li><span id="modalCustomerName5">You</span> understand that Eek Mechanical Limited takes immediate legal action against false reviews</li>
        <li><span id="modalCustomerName6">You</span> are aware of the financial and legal consequences outlined in this policy</li>
        <li><span id="modalCustomerName7">You</span> understand that all customer interactions are recorded and documented</li>
        <li><span id="modalCustomerName8">You</span> acknowledge that this policy is legally binding under New Zealand law</li>
      </ul>
      <div style="background: #e8f4fd; border-left: 4px solid #17a2b8; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p style="margin-bottom: 10px; font-size: 0.95em; color: #0c5460;">
          <strong>Electronic Signature Notice:</strong> Under the Electronic Transactions Act 2002 (New Zealand), this acknowledgment constitutes a valid electronic signature. By checking the box below, <span id="modalCustomerName9">you</span> are providing <span id="modalCustomerName10">your</span> electronic signature, which has the same legal effect as a handwritten signature under New Zealand law.
        </p>
      </div>
      <div class="acknowledgment-checkbox">
        <label>
          <input type="checkbox" id="acknowledgeCheckbox" required>
          <span>I, <strong id="modalCustomerNameSignature">[Your Name]</strong>, acknowledge that I have read and understood the above notice and wish to proceed. This acknowledgment serves as my electronic signature.</span>
        </label>
      </div>
      <button class="acknowledgment-btn" id="acknowledgeBtn" disabled>I Acknowledge and Proceed</button>
    </div>
  </div>

  <header class="header">
    <div class="container">
      <h1>‚öñÔ∏è Defamation Policy & Legal Action Protocol</h1>
      <p style="font-size: 1.2em; margin-top: 10px;">Eek Mechanical Ltd | Zero Tolerance for False Reviews</p>
    </div>
  </header>

  <!-- Personalized Greeting Section -->
  <div class="personalized-greeting" id="personalizedGreeting">
    <h2>Important Legal Notice for <span id="customerNameDisplay">You</span></h2>
    <p id="personalizedMessage">
      This page contains critical information about your legal obligations regarding any public statements, reviews, or online commentary you may be considering about Eek Mechanical Limited.
    </p>
    <div id="serviceDetails" style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.7); border-radius: 8px; display: none;">
      <p style="margin-bottom: 10px;"><strong>Service Reference:</strong> <span id="serviceReference"></span></p>
      <p style="margin-bottom: 10px;"><strong>Service Date:</strong> <span id="serviceDate"></span></p>
      <p><strong>Vehicle:</strong> <span id="vehicleDetails"></span></p>
    </div>
    <p style="font-weight: bold; color: #dc3545; margin-top: 15px;">
      ‚ö†Ô∏è Please read this entire document carefully. Your understanding of these legal requirements is essential.
    </p>
  </div>

  <!-- Personal Message to Defendant -->
  <section class="section" style="background: linear-gradient(135deg, #fff9e6, #ffe6cc); border: 2px solid #ff9800;">
    <h2 class="section-title" style="color: #e65100;">üìß Personal Message to <span id="personalMessageName">You</span></h2>
    <div style="background: white; padding: 30px; border-radius: 8px; margin: 20px 0;">
      <p style="font-size: 1.2em; margin-bottom: 20px; line-height: 1.8;">
        <span id="personalMessageName2">We</span> want to be clear with <span id="personalMessageName3">you</span>, <strong id="personalMessageName4">[Customer Name]</strong>: Eek Mechanical Limited does not want to pursue legal action against <span id="personalMessageName5">you</span>. However, <span id="personalMessageName6">we</span> have a duty to protect our reputation and the livelihoods of our team members and network of mechanics.
      </p>
      <p style="font-size: 1.1em; margin-bottom: 20px; line-height: 1.8;">
        <span id="personalMessageName7">You</span> already know about the issue. <span id="personalMessageName8">We</span> have already tried low-level, informal ways to get <span id="personalMessageName9">you</span> to address the offending material. <span id="personalMessageName10">We</span> have reached out, <span id="personalMessageName11">we</span> have asked politely, and <span id="personalMessageName12">we</span> have given <span id="personalMessageName13">you</span> opportunities to resolve this without legal action.
      </p>
      <p style="font-size: 1.1em; margin-bottom: 20px; line-height: 1.8; color: #dc3545; font-weight: bold;">
        The company does not tolerate false, defamatory, or malicious reviews. This will be prosecuted. But <span id="personalMessageName14">you</span> have a simple choice: <strong>Why not take the easy option and remove the offending material now?</strong>
      </p>
      <p style="font-size: 1.1em; margin-bottom: 20px; line-height: 1.8;">
        Removing the false review immediately is the fastest, easiest, and least costly resolution for <span id="personalMessageName15">you</span>. Once removed, <span id="personalMessageName16">we</span> can discuss any legitimate concerns <span id="personalMessageName17">you</span> may have through proper channels. But if <span id="personalMessageName18">you</span> choose to leave the false material online, <span id="personalMessageName19">we</span> have no choice but to proceed with the full legal response protocol outlined below.
      </p>
      <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 8px; margin-top: 25px;">
        <p style="font-size: 1.1em; color: #856404; margin-bottom: 10px;">
          <strong>‚ö†Ô∏è This is <span id="personalMessageName20">your</span> final opportunity to resolve this matter without legal action.</strong>
        </p>
        <p style="color: #856404;">
          Remove the false review now, and <span id="personalMessageName21">we</span> can move forward. Leave it online, and <span id="personalMessageName22">we</span> will proceed with prosecution.
        </p>
      </div>
    </div>
  </section>

  <!-- Address for Service Section - MOVED TO TOP -->
  <section class="section" id="address-for-service" style="margin-top: 30px;">
    <h2 class="section-title" style="color: #dc3545;">üìÆ Address for Service - Required Information</h2>
    
    <div class="warning-box" style="background: linear-gradient(135deg, #ffc107, #ff9800);">
      <h3>‚ö†Ô∏è LEGAL REQUIREMENT: Address for Service</h3>
      <p style="font-size: 1.2em; margin-bottom: 15px;">
        <strong><span id="customerNameAddress">You</span> are legally required under New Zealand High Court Rules and District Court Rules to provide an address for service of legal documents.</strong>
      </p>
      <p style="font-size: 1.1em; margin-bottom: 15px;">
        Failure to provide a valid address for service may constitute:
      </p>
      <ul style="margin: 15px 0; padding-left: 30px; font-size: 1.1em;">
        <li><strong>Contempt of Court</strong> - Under High Court Rules 2016, Rule 6.2 and District Court Rules 2014, Rule 4.2</li>
        <li><strong>Obstruction of Justice</strong> - Under Crimes Act 1961 Section 117</li>
        <li><strong>Failure to Comply with Court Orders</strong> - May result in additional costs and penalties</li>
      </ul>
      <p style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 1.1em;">
        <strong>‚ö†Ô∏è IMPORTANT:</strong> If <span id="customerNameAddress2">you</span> fail to provide <span id="customerNameAddress3">your</span> address for service, Eek Mechanical Limited will obtain <span id="customerNameAddress4">your</span> details from the New Zealand Transport Agency Motor Vehicle Register under the Land Transport Act 1998. All costs associated with obtaining this information (currently $25-$50 per search) will be added to any legal costs awarded against <span id="customerNameAddress5">you</span>.
      </p>
      <p style="margin-top: 15px; padding: 15px; background: rgba(220,53,69,0.3); border-radius: 5px; font-size: 1.2em; font-weight: bold;">
        <strong>üí° Best to provide it now and save <span id="customerNameAddress6">yourself</span> the additional costs.</strong>
      </p>
    </div>

    <div style="background: white; border: 2px solid #dc3545; border-radius: 8px; padding: 30px; margin: 30px 0;">
      <h3 style="color: #dc3545; margin-bottom: 20px;">üìã Provide Your Address for Service</h3>
      <p style="margin-bottom: 20px; font-size: 1.1em;">
        <span id="customerNameAddressForm">You</span> must provide <span id="customerNameAddressForm2">your</span> complete address where legal documents can be served. This address will be used for all legal proceedings related to <span id="customerNameAddressForm3">your</span> case, including service of court documents, legal notices, and tribunal applications.
      </p>
      
      <form id="addressForServiceForm" style="margin-top: 20px;">
        <div style="margin-bottom: 20px;">
          <label for="serviceAddress" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
            Street Address <span style="color: #dc3545;">*</span>
          </label>
          <input type="text" id="serviceAddress" name="serviceAddress" required 
                 placeholder="e.g., 123 Main Street" 
                 style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
          <small style="color: #6c757d; display: block; margin-top: 5px;">
            The physical address where legal documents can be delivered
          </small>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
          <div>
            <label for="serviceCity" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
              City/Suburb <span style="color: #dc3545;">*</span>
            </label>
            <input type="text" id="serviceCity" name="serviceCity" required 
                   placeholder="e.g., Auckland" 
                   style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
          </div>
          
          <div>
            <label for="servicePostcode" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
              Postcode <span style="color: #dc3545;">*</span>
            </label>
            <input type="text" id="servicePostcode" name="servicePostcode" required 
                   placeholder="e.g., 1010" 
                   pattern="[0-9]{4}" 
                   maxlength="4"
                   style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
          </div>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label for="serviceRegion" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
            Region
          </label>
          <select id="serviceRegion" name="serviceRegion" 
                  style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
            <option value="">Select Region</option>
            <option value="Auckland">Auckland</option>
            <option value="Bay of Plenty">Bay of Plenty</option>
            <option value="Canterbury">Canterbury</option>
            <option value="Gisborne">Gisborne</option>
            <option value="Hawke's Bay">Hawke's Bay</option>
            <option value="Manawatu-Wanganui">Manawatu-Wanganui</option>
            <option value="Marlborough">Marlborough</option>
            <option value="Nelson">Nelson</option>
            <option value="Northland">Northland</option>
            <option value="Otago">Otago</option>
            <option value="Southland">Southland</option>
            <option value="Taranaki">Taranaki</option>
            <option value="Tasman">Tasman</option>
            <option value="Waikato">Waikato</option>
            <option value="Wellington">Wellington</option>
            <option value="West Coast">West Coast</option>
          </select>
        </div>
        
        <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;">
          <h4 style="color: #856404; margin-bottom: 15px;">üìã Legal Requirements for Address for Service</h4>
          <ul style="color: #856404; margin-left: 20px;">
            <li style="margin-bottom: 10px;">The address must be a physical location where you can receive legal documents</li>
            <li style="margin-bottom: 10px;">The address must be in New Zealand (or you must provide an agent's address in New Zealand)</li>
            <li style="margin-bottom: 10px;">You must notify Eek Mechanical Limited of any change of address within 7 days</li>
            <li style="margin-bottom: 10px;">Failure to maintain a valid address for service may result in service by alternative means and additional costs</li>
          </ul>
        </div>
        
        <button type="submit" id="submitAddressBtn" 
                style="background: #dc3545; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;">
          Submit Address for Service
        </button>
        
        <div id="addressSubmissionStatus" style="margin-top: 15px; display: none; padding: 15px; border-radius: 8px;"></div>
      </form>
    </div>
    
    <div style="background: #e8f4fd; border-left: 4px solid #17a2b8; padding: 25px; border-radius: 4px; margin: 30px 0;">
      <h3 style="color: #17a2b8; margin-bottom: 15px;">‚ÑπÔ∏è What Happens If <span id="customerNameAddressConsequence">You</span> Don't Provide <span id="customerNameAddressConsequence2">Your</span> Address?</h3>
      <p style="margin-bottom: 15px;">
        If <span id="customerNameAddressConsequence3">you</span> fail to provide a valid address for service, Eek Mechanical Limited will:
      </p>
      <ol style="margin-left: 20px;">
        <li style="margin-bottom: 10px;"><strong>Obtain your address from the Motor Vehicle Register</strong> - Under the Land Transport Act 1998, we are entitled to access vehicle registration information for legal proceedings</li>
        <li style="margin-bottom: 10px;"><strong>Add search costs to your legal bill</strong> - Motor Vehicle Register searches cost $25-$50 per search, plus processing fees</li>
        <li style="margin-bottom: 10px;"><strong>Proceed with service at that address</strong> - Documents will be served to the address on file with NZTA</li>
        <li style="margin-bottom: 10px;"><strong>Add all costs to any damages award</strong> - These costs will be included in any costs order made against you</li>
      </ol>
      <p style="margin-top: 15px; font-weight: bold; color: #0c5460;">
        Providing <span id="customerNameAddressFinal">your</span> address now saves <span id="customerNameAddressFinal2">you</span> money and ensures <span id="customerNameAddressFinal3">you</span> receive all legal documents related to <span id="customerNameAddressFinal4">your</span> case promptly.
      </p>
    </div>
  </section>

  <!-- MAIN DEFAMATION POLICY SECTION -->
  <section class="section" id="defamation-policy" style="background: linear-gradient(135deg, #fff5f5, #ffe0e0); border: 2px solid #dc3545;">
    <h2 class="section-title">‚ö†Ô∏è IMPORTANT: Defamatory Review Policy & Legal Action Protocol</h2>
    
    <div class="warning-box">
      <h3>üö® ZERO TOLERANCE FOR FALSE REVIEWS</h3>
      <p style="font-size: 1.2em; margin-bottom: 15px;">
        <strong><span id="customerNameWarning">You</span>, Eek Mechanical Limited takes immediate and decisive legal action against all false, defamatory, or malicious reviews.</strong>
      </p>
      <p style="font-size: 1.1em;">All customer interactions are recorded. All service records are documented. <span id="customerNameWarning2">Your</span> false claims WILL be prosecuted to the full extent of New Zealand law.</p>
      <p id="personalizedEvidence" style="font-size: 1.1em; margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 5px; display: none;">
        <strong>Regarding <span id="customerNameEvidence2">your</span> specific service:</strong> We have complete documentation of <span id="customerNameEvidence">your</span> interaction with Eek Mechanical, including call recordings, service records, payment history, and all communications. Any false statements about <span id="customerNameEvidence3">your</span> service will be immediately disproven with this evidence.
      </p>
      <p style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 5px;">
        <strong>‚ö†Ô∏è FINAL WARNING:</strong> If you are considering posting a false review, be aware that you will face both civil and criminal prosecution. The financial and legal consequences will be severe.
      </p>
    </div>

    <div style="background: white; padding: 30px; border-radius: 8px; margin-bottom: 30px;">
      <h3 style="color: #dc3545; margin-bottom: 25px; font-size: 1.5em;">üìã Our Legal Response Protocol for Defamatory Reviews</h3>
      <p style="margin-bottom: 20px; font-size: 1.1em; color: #495057;">
        <strong>This protocol applies specifically to <span id="customerNameProtocol">you</span>.</strong> If you post a false or defamatory review about your service with Eek Mechanical, the following process will be initiated immediately:
      </p>
      
      <div class="process-steps">
        <div class="process-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>Immediate Documentation & Evidence Preservation</h4>
            <p><strong>Within 1 Hour:</strong> Screenshots captured, review archived, call recordings retrieved, service records compiled, witness statements collected. All evidence preserved per Evidence Act 2006 standards for court proceedings. Digital forensics initiated to identify reviewer through IP tracking and metadata analysis.</p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h4>Formal Legal Warning Issued</h4>
            <p><strong>Within 24 Hours:</strong> Legal notice sent to reviewer demanding immediate removal. Warning clearly states: "Remove your false review or face defamation proceedings under the Defamation Act 1992." This constitutes your ONLY opportunity to avoid legal action. Non-compliance triggers automatic prosecution.</p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h4>Netsafe Complaint Filed (HDCA Process)</h4>
            <p><strong>Within 48 Hours if not removed:</strong> Formal complaint lodged with Netsafe under Harmful Digital Communications Act 2015. We cite breach of communication principles for false, harmful content causing commercial damage. Netsafe has authority to mediate and escalate to District Court.</p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <h4>District Court Application for Orders</h4>
            <p><strong>Within 72 Hours:</strong> If Netsafe mediation fails, immediate District Court application under HDCA Section 19 for:
            <ul style="margin-top: 10px;">
              <li>Takedown orders (mandatory removal)</li>
              <li>Cease and desist orders</li>
              <li>Mandatory correction and public apology</li>
              <li>Identity disclosure orders for anonymous reviewers</li>
            </ul>
            </p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">5</div>
          <div class="step-content">
            <h4>High Court Defamation Proceedings</h4>
            <p><strong>Simultaneously with HDCA process:</strong> High Court defamation claim filed seeking:
            <ul style="margin-top: 10px;">
              <li>General damages for reputational harm ($50,000-$270,000 typical range)</li>
              <li>Special damages for proven financial losses</li>
              <li>Aggravated damages for malicious intent</li>
              <li>Permanent injunction against further publications</li>
              <li>Full indemnity costs (your legal bills)</li>
            </ul>
            </p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">6</div>
          <div class="step-content">
            <h4>Criminal Prosecution (Where Applicable)</h4>
            <p><strong>If malicious intent or pattern of harassment proven:</strong> Criminal charges filed under:
            <ul style="margin-top: 10px;">
              <li>HDCA Section 22 - Causing harm by posting digital communication (2 years prison / $50,000 fine)</li>
              <li>Crimes Act 1961 Section 240 - Obtaining by deception (7 years prison)</li>
              <li>Harassment Act 1997 - Criminal harassment (2 years prison)</li>
            </ul>
            Criminal convictions result in permanent criminal record affecting employment, travel, and credit.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="legal-notice">
      <h4>‚öñÔ∏è APPLICABLE NEW ZEALAND LEGISLATION - YOUR LEGAL LIABILITY</h4>
      
      <div class="info-grid">
        <div class="info-item">
          <strong>Defamation Act 1992</strong>
          <p>False statements damaging reputation are actionable. Truth is a complete defence - we have recordings and documentation of ALL interactions. Damages awards regularly exceed $100,000 plus costs.</p>
        </div>
        
        <div class="info-item">
          <strong>Harmful Digital Communications Act 2015</strong>
          <p>Online content causing harm to individuals or businesses. District Court orders are MANDATORY and breach results in criminal prosecution. Fines up to $200,000 for companies.</p>
        </div>
        
        <div class="info-item">
          <strong>Fair Trading Act 1986</strong>
          <p>False or misleading representations in trade. Commerce Commission can investigate and prosecute false reviews as misleading conduct with fines up to $600,000.</p>
        </div>
        
        <div class="info-item">
          <strong>Crimes Act 1961 (Section 240)</strong>
          <p>Obtaining advantage by deception or causing loss by deception. False reviews aimed at commercial harm constitute criminal fraud - maximum 7 years imprisonment.</p>
        </div>
        
        <div class="info-item">
          <strong>Privacy Act 2020</strong>
          <p>We lawfully collect and retain all customer interaction data under legitimate business interests. This data becomes admissible evidence in ALL legal proceedings.</p>
        </div>
        
        <div class="info-item">
          <strong>Evidence Act 2006</strong>
          <p>Digital recordings and business records are prima facie evidence. Our chain of custody protocols exceed court requirements. Your false claims WILL be disproven.</p>
        </div>
      </div>
    </div>

    <div class="financial-box">
      <h3 style="color: white; margin-bottom: 20px;">üí∞ FINANCIAL CONSEQUENCES - RECENT NZ COURT AWARDS</h3>
      
      <p style="font-size: 1.2em; margin-bottom: 20px;"><strong>Recent Defamation Damages Awards in New Zealand:</strong></p>
      
      <ul style="margin: 20px 0; padding-left: 30px; font-size: 1.1em;">
        <li style="margin-bottom: 15px;"><strong>$270,000</strong> - Auckland businessman vs false Google review (2024)</li>
        <li style="margin-bottom: 15px;"><strong>$168,000</strong> - Retail business vs competitor's false claims (2023)</li>
        <li style="margin-bottom: 15px;"><strong>$150,000</strong> - Service company vs malicious customer (2023)</li>
        <li style="margin-bottom: 15px;"><strong>$98,000</strong> - Small business vs false online review (2022)</li>
        <li style="margin-bottom: 15px;"><strong>PLUS:</strong> Legal costs typically $20,000-$75,000 awarded against defendant</li>
      </ul>
      
      <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; margin-top: 25px;">
        <p style="font-size: 1.3em; margin-bottom: 15px;">
          <strong>‚ö†Ô∏è YOU WILL BE PERSONALLY LIABLE FOR:</strong>
        </p>
        <ul style="font-size: 1.1em;">
          <li>Damages awarded by the court</li>
          <li>Our full legal costs (solicitor-client basis)</li>
          <li>Court filing and hearing fees</li>
          <li>Cost of publishing corrections/apologies</li>
          <li>Enforcement costs if you don't pay</li>
          <li>Potential criminal fines up to $200,000</li>
          <li>Bankruptcy proceedings if unable to pay</li>
        </ul>
      </div>
      
      <p style="font-size: 1.3em; margin-top: 25px; text-align: center; font-weight: bold;">
        AVERAGE TOTAL COST TO DEFAMER: $120,000 - $345,000
      </p>
    </div>

    <div style="background: white; border: 2px solid #dc3545; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
      <h3 style="color: #dc3545; margin-bottom: 20px;">üìù WHAT CONSTITUTES ACTIONABLE DEFAMATION</h3>
      
      <div class="info-grid">
        <div class="info-item" style="background: #fff5f5;">
          <strong>FALSE STATEMENTS WE PROSECUTE:</strong>
          <ul style="margin-top: 15px;">
            <li>Claims of fraud, scamming, or theft</li>
            <li>False allegations of criminal activity</li>
            <li>Fabricated service failures or damage</li>
            <li>Invented conversations or misquotes</li>
            <li>False claims about business practices</li>
            <li>Misrepresentation of actual events</li>
            <li>Claims contradicted by recordings</li>
            <li>Allegations of unprofessional conduct when recordings prove otherwise</li>
          </ul>
        </div>
        
        <div class="info-item" style="background: #fff5f5;">
          <strong>NOT PROTECTED AS "OPINION":</strong>
          <ul style="margin-top: 15px;">
            <li>False statements presented as facts</li>
            <li>Claims directly contradicted by evidence</li>
            <li>Malicious intent to harm business</li>
            <li>Competitor sabotage attempts</li>
            <li>Retaliatory false reviews</li>
            <li>Reviews by non-customers</li>
            <li>Coordinated attack campaigns</li>
            <li>Reviews containing provable lies</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="evidence-box">
      <h3 style="color: #17a2b8; margin-bottom: 20px;">üîç OUR COMPREHENSIVE EVIDENCE COLLECTION SYSTEM</h3>
      
      <p style="margin-bottom: 20px; font-size: 1.1em;"><strong>Every Eek Mechanical interaction is permanently documented:</strong></p>
      
      <ul style="margin: 20px 0; padding-left: 30px;">
        <li style="margin-bottom: 12px;"><strong>Call Recordings:</strong> All phone conversations recorded with consent per terms of service. Stored for 7 years per legal requirements.</li>
        <li style="margin-bottom: 12px;"><strong>GPS Tracking:</strong> All service vehicles GPS tracked with timestamps, speed, and location data. Proves attendance and time on site.</li>
        <li style="margin-bottom: 12px;"><strong>Job Documentation:</strong> Before/after photos, videos, detailed service reports, parts used, work completed.</li>
        <li style="margin-bottom: 12px;"><strong>Payment Records:</strong> Complete transaction history with banking verification, receipts, invoices.</li>
        <li style="margin-bottom: 12px;"><strong>Communication Logs:</strong> All SMS, emails, WhatsApp, and app messages archived with timestamps.</li>
        <li style="margin-bottom: 12px;"><strong>Witness Statements:</strong> From mechanics, dispatchers, other customers present, neighbouring businesses.</li>
        <li style="margin-bottom: 12px;"><strong>Digital Forensics:</strong> IP addresses, device IDs, browser fingerprints, metadata, geolocation data.</li>
        <li style="margin-bottom: 12px;"><strong>Third-Party Verification:</strong> CCTV from nearby businesses, traffic cameras, cell tower data.</li>
      </ul>
      
      <p style="color: #0c5460; font-weight: bold; font-size: 1.1em; margin-top: 20px;">
        ‚öñÔ∏è This evidence exceeds NZ court evidentiary standards and WILL result in your conviction.
      </p>
    </div>

    <!-- Conduct, Threats, and Online Statements Section -->
    <div style="background: white; border: 2px solid #dc3545; border-radius: 8px; padding: 25px; margin-bottom: 30px;">
      <h3 style="color: #dc3545; margin-bottom: 20px;">üìß Conduct, Threats, and Online Statements (NZ Law‚ÄìAligned)</h3>
      
      <p style="margin-bottom: 15px; font-size: 1.1em;">
        <strong>Regarding any correspondence or online commentary:</strong>
      </p>
      
      <p style="margin-bottom: 15px;">
        Any correspondence that includes comments predicting how Eek Mechanical would "respond next" or suggestions of "meeting in person if necessary" has been recorded. Eek Mechanical deals with all concerns through documented channels only. All calls and emails form part of the official evidential record.
      </p>
      
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h4 style="color: #dc3545; margin-bottom: 15px;">Regarding online commentary:</h4>
        <ul style="margin-left: 20px;">
          <li style="margin-bottom: 10px;">Eek Mechanical holds a verified public record of over 95% 5-star reviews on Google across its service categories.</li>
          <li style="margin-bottom: 10px;">The very small number of negative comments online originate from individuals who never used the service, including known trolling activity during early startup.</li>
          <li style="margin-bottom: 10px;">None of these relate to your booking or reflect the service actually provided.</li>
        </ul>
      </div>
      
      <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h4 style="color: #856404; margin-bottom: 15px;">Your obligations under New Zealand law:</h4>
        <p style="margin-bottom: 15px; color: #856404;">
          Under New Zealand legislation, any statements made publicly must be truthful, fair, and based on verifiable facts:
        </p>
        <ul style="margin-left: 20px; color: #856404;">
          <li style="margin-bottom: 10px;"><strong>Defamation Act 1992:</strong> Publishing statements that damage a business's reputation and are not true exposes the publisher to liability, whether the statements are posted online, shared on forums, or sent to third parties.</li>
          <li style="margin-bottom: 10px;"><strong>Harmful Digital Communications Act 2015:</strong> Online posts or messages that are harmful, misleading, threatening, or untrue may fall within the scope of harmful digital communications. Platforms may be required to remove them, and legal remedies may be sought.</li>
          <li style="margin-bottom: 10px;"><strong>Fair Trading Act 1986:</strong> Any public statements made "in trade" about a business must not be misleading or deceptive. A consumer publicly asserting false claims about a trader's performance can breach the Act if the statements mislead others.</li>
        </ul>
      </div>
      
      <div style="background: #e8f4fd; border-left: 4px solid #17a2b8; padding: 20px; border-radius: 4px; margin: 20px 0;">
        <h4 style="color: #17a2b8; margin-bottom: 15px;">What this means for commentary relating to your case:</h4>
        <ul style="margin-left: 20px;">
          <li style="margin-bottom: 10px;">Any statements you choose to publish must accurately reflect the documented events, the call recordings, the payment history, the contractor allocation, and the Terms of Service you accepted on payment.</li>
          <li style="margin-bottom: 10px;">Publishing inaccurate or misleading information may result in action under one or more of the above Acts, depending on the nature and impact of the statements.</li>
          <li style="margin-bottom: 10px;">If required, Eek Mechanical will rely on the full evidential record‚Äîincluding all call recordings, booking metadata, text messages, supplier logs, and this final letter‚Äîin any legal or Tribunal process.</li>
        </ul>
        <p style="margin-top: 15px; font-weight: bold; color: #0c5460;">
          Eek Mechanical simply asks that any public commentary you choose to make is fair, factual, and accurate, so that no party is placed in a position where formal legal action or statutory remedies need to be considered.
        </p>
      </div>
    </div>

    <div class="legal-notice" style="background: #ffe0e0; border: 3px solid #dc3545;">
      <h4 style="color: #dc3545; font-size: 1.4em;">‚ö†Ô∏è FINAL WARNING - READ BEFORE POSTING</h4>
      
      <p style="color: #721c24; font-size: 1.2em; margin-bottom: 20px;">
        <strong>BEFORE YOU POST A FALSE REVIEW, UNDERSTAND THESE FACTS:</strong>
      </p>
      
      <ol style="margin: 20px 0; padding-left: 30px; color: #721c24; font-size: 1.1em;">
        <li style="margin-bottom: 15px;"><strong>You WILL be identified</strong> - Even "anonymous" reviews are traced through digital forensics</li>
        <li style="margin-bottom: 15px;"><strong>Your review is permanent evidence</strong> - Screenshots and archives will be used in court</li>
        <li style="margin-bottom: 15px;"><strong>You face personal bankruptcy</strong> - Average damages exceed most people's annual income</li>
        <li style="margin-bottom: 15px;"><strong>Criminal record is permanent</strong> - Affects employment, travel, loans, rentals</li>
        <li style="margin-bottom: 15px;"><strong>Court proceedings are public</strong> - Your name appears in searchable court records forever</li>
        <li style="margin-bottom: 15px;"><strong>No insurance covers defamation</strong> - You pay personally, not your insurer</li>
        <li style="margin-bottom: 15px;"><strong>Bankruptcy doesn't discharge damages</strong> - Court orders survive bankruptcy proceedings</li>
        <li style="margin-bottom: 15px;"><strong>Assets can be seized</strong> - Houses, cars, wages garnished to pay damages</li>
      </ol>
      
      <p style="color: #721c24; font-size: 1.4em; font-weight: bold; text-align: center; margin-top: 30px; padding: 20px; background: white; border-radius: 8px;">
        IS YOUR FALSE REVIEW WORTH LOSING YOUR HOME, SAVINGS, AND FUTURE?
      </p>
    </div>

    <div class="success-box">
      <h3 style="color: white; margin-bottom: 20px;">‚úÖ LEGITIMATE COMPLAINTS ARE ALWAYS WELCOME</h3>
      <p style="font-size: 1.2em; margin-bottom: 15px;">
        We value genuine feedback and work hard to resolve legitimate concerns.
      </p>
      <p style="font-size: 1.1em; margin-bottom: 20px;">
        If you have a real issue, contact us directly: <strong>0800 447 153</strong><br>
        We offer mediation, refunds where appropriate, and genuine resolution.
      </p>
      <p style="margin-top: 20px; font-size: 1em; opacity: 0.9;">
        <em>This policy applies ONLY to FALSE, DEFAMATORY, or MALICIOUS reviews.<br>
        Honest opinions based on actual experiences are protected by law and welcomed by us.</em>
      </p>
    </div>
  </section>

  <!-- Address for Service Section -->
  <section class="section" id="address-for-service">
    <h2 class="section-title" style="color: #dc3545;">üìÆ Address for Service - Required Information</h2>
    
    <div class="warning-box" style="background: linear-gradient(135deg, #ffc107, #ff9800);">
      <h3>‚ö†Ô∏è LEGAL REQUIREMENT: Address for Service</h3>
      <p style="font-size: 1.2em; margin-bottom: 15px;">
        <strong><span id="customerNameAddress">You</span> are legally required under New Zealand High Court Rules and District Court Rules to provide an address for service of legal documents.</strong>
      </p>
      <p style="font-size: 1.1em; margin-bottom: 15px;">
        Failure to provide a valid address for service may constitute:
      </p>
      <ul style="margin: 15px 0; padding-left: 30px; font-size: 1.1em;">
        <li><strong>Contempt of Court</strong> - Under High Court Rules 2016, Rule 6.2 and District Court Rules 2014, Rule 4.2</li>
        <li><strong>Obstruction of Justice</strong> - Under Crimes Act 1961 Section 117</li>
        <li><strong>Failure to Comply with Court Orders</strong> - May result in additional costs and penalties</li>
      </ul>
      <p style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 1.1em;">
        <strong>‚ö†Ô∏è IMPORTANT:</strong> If you fail to provide your address for service, Eek Mechanical Limited will obtain your details from the New Zealand Transport Agency Motor Vehicle Register under the Land Transport Act 1998. All costs associated with obtaining this information (currently $25-$50 per search) will be added to any legal costs awarded against you.
      </p>
    </div>

    <div style="background: white; border: 2px solid #dc3545; border-radius: 8px; padding: 30px; margin: 30px 0;">
      <h3 style="color: #dc3545; margin-bottom: 20px;">üìã Provide Your Address for Service</h3>
      <p style="margin-bottom: 20px; font-size: 1.1em;">
        <span id="customerNameAddressForm">You</span> must provide <span id="customerNameAddressForm2">your</span> complete address where legal documents can be served. This address will be used for all legal proceedings related to <span id="customerNameAddressForm3">your</span> case, including service of court documents, legal notices, and tribunal applications.
      </p>
      
      <form id="addressForServiceForm" style="margin-top: 20px;">
        <div style="margin-bottom: 20px;">
          <label for="serviceAddress" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
            Street Address <span style="color: #dc3545;">*</span>
          </label>
          <input type="text" id="serviceAddress" name="serviceAddress" required 
                 placeholder="e.g., 123 Main Street" 
                 style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
          <small style="color: #6c757d; display: block; margin-top: 5px;">
            The physical address where legal documents can be delivered
          </small>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
          <div>
            <label for="serviceCity" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
              City/Suburb <span style="color: #dc3545;">*</span>
            </label>
            <input type="text" id="serviceCity" name="serviceCity" required 
                   placeholder="e.g., Auckland" 
                   style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
          </div>
          
          <div>
            <label for="servicePostcode" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
              Postcode <span style="color: #dc3545;">*</span>
            </label>
            <input type="text" id="servicePostcode" name="servicePostcode" required 
                   placeholder="e.g., 1010" 
                   pattern="[0-9]{4}" 
                   maxlength="4"
                   style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
          </div>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label for="serviceRegion" style="display: block; margin-bottom: 8px; font-weight: bold; color: #dc3545;">
            Region
          </label>
          <select id="serviceRegion" name="serviceRegion" 
                  style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1em;">
            <option value="">Select Region</option>
            <option value="Auckland">Auckland</option>
            <option value="Bay of Plenty">Bay of Plenty</option>
            <option value="Canterbury">Canterbury</option>
            <option value="Gisborne">Gisborne</option>
            <option value="Hawke's Bay">Hawke's Bay</option>
            <option value="Manawatu-Wanganui">Manawatu-Wanganui</option>
            <option value="Marlborough">Marlborough</option>
            <option value="Nelson">Nelson</option>
            <option value="Northland">Northland</option>
            <option value="Otago">Otago</option>
            <option value="Southland">Southland</option>
            <option value="Taranaki">Taranaki</option>
            <option value="Tasman">Tasman</option>
            <option value="Waikato">Waikato</option>
            <option value="Wellington">Wellington</option>
            <option value="West Coast">West Coast</option>
          </select>
        </div>
        
        <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;">
          <h4 style="color: #856404; margin-bottom: 15px;">üìã Legal Requirements for Address for Service</h4>
          <ul style="color: #856404; margin-left: 20px;">
            <li style="margin-bottom: 10px;">The address must be a physical location where you can receive legal documents</li>
            <li style="margin-bottom: 10px;">The address must be in New Zealand (or you must provide an agent's address in New Zealand)</li>
            <li style="margin-bottom: 10px;">You must notify Eek Mechanical Limited of any change of address within 7 days</li>
            <li style="margin-bottom: 10px;">Failure to maintain a valid address for service may result in service by alternative means and additional costs</li>
          </ul>
        </div>
        
        <button type="submit" id="submitAddressBtn" 
                style="background: #dc3545; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;">
          Submit Address for Service
        </button>
        
        <div id="addressSubmissionStatus" style="margin-top: 15px; display: none; padding: 15px; border-radius: 8px;"></div>
      </form>
    </div>
    
    <div style="background: #e8f4fd; border-left: 4px solid #17a2b8; padding: 25px; border-radius: 4px; margin: 30px 0;">
      <h3 style="color: #17a2b8; margin-bottom: 15px;">‚ÑπÔ∏è What Happens If <span id="customerNameAddressConsequence">You</span> Don't Provide <span id="customerNameAddressConsequence2">Your</span> Address?</h3>
      <p style="margin-bottom: 15px;">
        If <span id="customerNameAddressConsequence3">you</span> fail to provide a valid address for service, Eek Mechanical Limited will:
      </p>
      <ol style="margin-left: 20px;">
        <li style="margin-bottom: 10px;"><strong>Obtain your address from the Motor Vehicle Register</strong> - Under the Land Transport Act 1998, we are entitled to access vehicle registration information for legal proceedings</li>
        <li style="margin-bottom: 10px;"><strong>Add search costs to your legal bill</strong> - Motor Vehicle Register searches cost $25-$50 per search, plus processing fees</li>
        <li style="margin-bottom: 10px;"><strong>Proceed with service at that address</strong> - Documents will be served to the address on file with NZTA</li>
        <li style="margin-bottom: 10px;"><strong>Add all costs to any damages award</strong> - These costs will be included in any costs order made against you</li>
      </ol>
        <p style="margin-top: 15px; font-weight: bold; color: #0c5460;">
        Providing <span id="customerNameAddressFinal">your</span> address now saves <span id="customerNameAddressFinal2">you</span> money and ensures <span id="customerNameAddressFinal3">you</span> receive all legal documents related to <span id="customerNameAddressFinal4">your</span> case promptly.
      </p>
    </div>
  </section>

  <!-- Alternative Dispute Resolution Options -->
  <section class="section">
    <h2 class="section-title" style="color: #17a2b8;">‚öñÔ∏è Alternative Dispute Resolution Options</h2>
    
    <div class="dispute-options">
      <h3>Before Considering Legal Action - Explore These Options</h3>
      <p style="margin-bottom: 20px; font-size: 1.1em;">
        If you have a genuine concern about your service, we encourage you to explore these alternative dispute resolution options:
      </p>
      
      <div class="dispute-option-card">
        <h4>1. Direct Contact & Mediation</h4>
        <p>Contact us directly at <strong>0800 447 153</strong> or <strong>legal@eek.nz</strong> to discuss your concerns. We provide free mediation services for any disputes between customers and mechanics. As an intermediary service, we cannot be sued directly, but we will mediate fairly and professionally.</p>
      </div>
      
      <div class="dispute-option-card">
        <h4>2. Disputes Tribunal</h4>
        <p>We provide free mediation services and will pay the tribunal fees. You just need to complete the form. The Disputes Tribunal is a free, fast, and informal way to resolve disputes up to $30,000. <a href="/disputes-tribunal" style="color: #17a2b8; font-weight: bold;">Complete Tribunal Form</a></p>
      </div>
      
      <div class="dispute-option-card">
        <h4>3. Privacy Act Authorization</h4>
        <p>If you need someone to act on your behalf in legal matters, you can authorize a third party. <a href="/authorize" style="color: #17a2b8; font-weight: bold;">Privacy Act Authorization Form</a></p>
      </div>
      
      <div class="dispute-option-card">
        <h4>4. Customer Service Resolution</h4>
        <p>For non-legal issues, our customer service team is available to help with emergency services, booking support, and general inquiries. <a href="/more-options" style="color: #17a2b8; font-weight: bold;">Complete Service Directory</a></p>
      </div>
      
      <div class="dispute-option-card">
        <h4>5. Commerce Commission Complaint</h4>
        <p>If you believe there has been a breach of the Fair Trading Act 1986, you can file a complaint with the Commerce Commission. This is appropriate for genuine consumer protection issues, not false reviews.</p>
      </div>
    </div>
    
    <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(23,162,184,0.3);">
      <h4 style="color: white; margin-bottom: 15px;">üõ°Ô∏è Our Legal Position</h4>
      <p style="margin-bottom: 10px; color: rgba(255,255,255,0.9);">
        <strong>We are an intermediary service</strong> - we connect customers with vetted mechanics but do not directly provide mechanical services. This means:
      </p>
      <ul style="margin: 10px 0; padding-left: 20px; color: rgba(255,255,255,0.9);">
        <li>We cannot be sued for mechanical work performed by our network mechanics</li>
        <li>We provide mediation services to resolve any disputes fairly</li>
        <li>We will represent you at the Disputes Tribunal if needed</li>
        <li>All our mechanics are fully insured and vetted</li>
      </ul>
    </div>
  </section>

  <section class="section">
    <h2 style="color: #17a2b8; margin-bottom: 20px;">üìû Contact Legal Department</h2>
    <div style="text-align: center; padding: 20px;">
      <p style="font-size: 1.2em; margin-bottom: 20px;">
        For removal of false reviews before legal action:<br>
        <strong style="font-size: 1.3em; color: #dc3545;">legal@eek.nz</strong>
      </p>
      <p style="color: #6c757d;">
        <span id="contactCustomerName">You</span> have 24 hours from posting to remove false content voluntarily.<br>
        After this period, legal proceedings commence automatically.
      </p>
    </div>
  </section>

  <!-- Final Acknowledgment Section -->
  <section class="section" style="background: linear-gradient(135deg, #fff5f5, #ffe0e0); border: 3px solid #dc3545;">
    <h2 class="section-title" style="color: #dc3545;">üìã Final Acknowledgment & Terms of Service</h2>
    
    <div style="background: white; padding: 30px; border-radius: 8px; margin: 30px 0;">
      <p style="font-size: 1.2em; margin-bottom: 20px; line-height: 1.8;">
        <strong><span id="finalAckName">You</span>, <span id="finalAckName2">[Customer Name]</span>,</strong> acknowledge that <span id="finalAckName3">you</span> have read and understood:
      </p>
      
      <ul style="margin: 20px 0; padding-left: 30px; font-size: 1.1em; line-height: 2;">
        <li style="margin-bottom: 15px;">This defamation policy and legal action protocol in its entirety</li>
        <li style="margin-bottom: 15px;">The legal consequences of posting false, defamatory, or malicious reviews</li>
        <li style="margin-bottom: 15px;">The financial and legal consequences outlined in this policy</li>
        <li style="margin-bottom: 15px;">That all customer interactions are recorded and documented</li>
        <li style="margin-bottom: 15px;">The Terms of Service that <span id="finalAckName4">you</span> agreed to when <span id="finalAckName5">you</span> used Eek Mechanical's services</li>
        <li style="margin-bottom: 15px;">That this policy is legally binding under New Zealand law</li>
        <li style="margin-bottom: 15px;">That <span id="finalAckName6">your</span> address for service is required and will be obtained from the Motor Vehicle Register if not provided</li>
      </ul>
      
      <div style="background: #e8f4fd; border-left: 4px solid #17a2b8; padding: 25px; border-radius: 4px; margin: 30px 0;">
        <h3 style="color: #17a2b8; margin-bottom: 15px;">üìÑ Terms of Service Reference</h3>
        <p style="margin-bottom: 15px;">
          By using Eek Mechanical's services, <span id="finalAckName7">you</span> agreed to our <a href="/terms" target="_blank" style="color: #17a2b8; font-weight: bold; text-decoration: underline;">Terms of Service</a>, which include:
        </p>
        <ul style="margin-left: 20px; color: #0c5460;">
          <li style="margin-bottom: 10px;"><strong>Section 2.2:</strong> By registering or making payment, <span id="finalAckName8">you</span> accept these Terms in full</li>
          <li style="margin-bottom: 10px;"><strong>Section 3.2:</strong> <span id="finalAckName9">You</span> indemnify and hold Eek Mechanical harmless from claims, damages, or liabilities</li>
          <li style="margin-bottom: 10px;"><strong>Section 13.2:</strong> Any disputes with Eek Mechanical must be resolved in the courts of Northern Ireland</li>
          <li style="margin-bottom: 10px;"><strong>Section 13.3:</strong> <span id="finalAckName10">You</span> are responsible for all legal costs associated with disputes</li>
          <li style="margin-bottom: 10px;"><strong>Section 20:</strong> Address for Service - All legal notices must be sent to Eek Mechanical's designated address in New Zealand</li>
        </ul>
        <p style="margin-top: 15px; font-weight: bold; color: #0c5460;">
          <a href="/terms" target="_blank" style="color: #17a2b8; text-decoration: underline;">View Full Terms of Service</a>
        </p>
      </div>
      
      <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 25px; margin: 30px 0;">
        <h3 style="color: #856404; margin-bottom: 15px;">‚öñÔ∏è Electronic Signature Acknowledgment</h3>
        <p style="color: #856404; margin-bottom: 15px; font-size: 1.1em;">
          Under the Electronic Transactions Act 2002 (New Zealand), <span id="finalAckName11">your</span> acknowledgment below constitutes a valid electronic signature with the same legal effect as a handwritten signature.
        </p>
        <div class="acknowledgment-checkbox" style="background: white; padding: 20px; border-radius: 8px; margin-top: 20px;">
          <label style="display: flex; align-items: flex-start; gap: 15px; cursor: pointer;">
            <input type="checkbox" id="finalAcknowledgeCheckbox" required style="width: 24px; height: 24px; margin-top: 3px; cursor: pointer;">
            <span style="font-size: 1.1em; line-height: 1.6;">
              I, <strong id="finalAckSignature">[Customer Name]</strong>, acknowledge that I have read and understood this entire defamation policy and legal action protocol, including all legal consequences, financial implications, and references to the Terms of Service. I understand that this acknowledgment serves as my electronic signature under the Electronic Transactions Act 2002 (New Zealand) and has the same legal effect as a handwritten signature.
            </span>
          </label>
        </div>
        <button type="button" id="finalAcknowledgeBtn" disabled
                style="background: #dc3545; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;">
          I Acknowledge Reading These Terms
        </button>
        <div id="finalAckStatus" style="margin-top: 15px; display: none; padding: 15px; border-radius: 8px;"></div>
      </div>
    </div>
  </section>

  <footer style="background: #343a40; color: white; padding: 30px 0; text-align: center;">
    <div class="container">
      <p>¬© 2024 Eek Mechanical Ltd | Company No. 9365185 | NZBN 9429053064165</p>
      <p style="margin-top: 10px;">This policy is legally binding and enforceable under New Zealand law</p>
    </div>
  </footer>

  <script>
    // SharePoint Lookup API URL
    const SHAREPOINT_LOOKUP_URL = 'https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/c35b9414a0be42f88182ae7e6e409f1d/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=2ztt24wScLuAfifD0pjzovseRDKXBAEtCQtScGMgPqQ';

    // Fetch booking data from SharePoint
    async function fetchBookingDataFromSharePoint(bookingId) {
      console.log('üîç Fetching booking from SharePoint‚Ä¶', bookingId);
      
      if (!bookingId) {
        console.warn('‚ö†Ô∏è No bookingId provided');
        return null;
      }
      
      try {
        const res = await fetch(SHAREPOINT_LOOKUP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ bookingId })
        });
        
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        
        const result = await res.json();
        if (result.success && result.bookingData) {
          const json = atob(result.bookingData);
          const decoded = JSON.parse(json);
          decoded.sharepointId = bookingId;
          decoded.sharepointStatus = result.status;
          decoded.retrievedAt = new Date().toISOString();
          console.log('‚úÖ SharePoint data retrieved successfully');
          return decoded;
        }
        console.log('‚ö†Ô∏è SharePoint returned success=false or no bookingData');
        return null;
      } catch (err) {
        console.error('‚ùå SharePoint fetch error:', err);
        return null;
      }
    }

    // Get comprehensive booking data from all sources
    function getComprehensiveBookingData() {
      console.log('üìä Building comprehensive booking data from all sources...');
      const data = {};
      
      const params = new URLSearchParams(window.location.search);
      console.log('üîó URL parameters found:', params.toString());
      
      const encoded = params.get('d');
      if (encoded) {
        try { 
          const decoded = JSON.parse(atob(encoded));
          Object.assign(data, decoded);
          console.log('‚úÖ Decoded URL data blob');
        } catch (e) { 
          console.warn('‚ö†Ô∏è Legacy blob decode failed', e); 
        }
      }
      
      for (const [k,v] of params) {
        if (k !== 'd' && k !== 'bookingId') { 
          const mappedKey = k === 'session_id' ? 'sessionId' : k;
          data[mappedKey] = decodeURIComponent(v);
        }
      }
      
      try { 
        const ss = sessionStorage.getItem('eekBookingData'); 
        if (ss) {
          const sessionData = JSON.parse(ss);
          Object.assign(data, sessionData);
          console.log('‚úÖ Session storage data merged');
        }
      } catch (e) {
        console.warn('‚ö†Ô∏è Session storage read failed', e);
      }
      
      try { 
        const ls = localStorage.getItem('eekBookingData'); 
        if (ls) {
          const localData = JSON.parse(ls);
          Object.assign(data, localData);
          console.log('‚úÖ Local storage data merged');
        }
      } catch (e) {
        console.warn('‚ö†Ô∏è Local storage read failed', e);
      }
      
      return data;
    }

    // Normalize field values
    function normalizeValue(value) {
      if (value === null || value === undefined) return '';
      return String(value).trim();
    }

    // Get customer name from booking data
    function getCustomerName(bookingData) {
      if (!bookingData) return null;
      
      const customerData = bookingData.customerData || {};
      
      const getValue = (...keys) => {
        for (const key of keys) {
          if (bookingData[key] !== undefined && bookingData[key] !== null && bookingData[key] !== '') {
            return bookingData[key];
          }
          if (customerData[key] !== undefined && customerData[key] !== null && customerData[key] !== '') {
            return customerData[key];
          }
        }
        return null;
      };
      
      return getValue('name', 'customerName') || null;
    }

    // Get address from booking data
    function getAddressFromBookingData(bookingData) {
      if (!bookingData) return null;
      
      const customerData = bookingData.customerData || {};
      
      // Check location.address first (this is the standard field)
      if (bookingData.location?.address) {
        return bookingData.location.address;
      }
      
      // Check root level location (string or object)
      if (typeof bookingData.location === 'string') {
        return bookingData.location;
      }
      
      // Check customerData.location
      if (customerData.location) {
        if (typeof customerData.location === 'string') {
          return customerData.location;
        }
        if (customerData.location.address) {
          return customerData.location.address;
        }
      }
      
      // Check serviceLocation field
      if (bookingData.serviceLocation) {
        return bookingData.serviceLocation;
      }
      
      return null;
    }

    // Populate address form from booking data
    function populateAddressForm(bookingData) {
      const address = getAddressFromBookingData(bookingData);
      
      if (address) {
        // Try to parse address into components
        const addressInput = document.getElementById('serviceAddress');
        if (addressInput) {
          addressInput.value = normalizeValue(address);
        }
        
        // Try to extract city from location object
        if (bookingData.location?.city) {
          const cityInput = document.getElementById('serviceCity');
          if (cityInput) {
            cityInput.value = normalizeValue(bookingData.location.city);
          }
        }
        
        // Try to extract postcode
        if (bookingData.location?.postalCode) {
          const postcodeInput = document.getElementById('servicePostcode');
          if (postcodeInput) {
            postcodeInput.value = normalizeValue(bookingData.location.postalCode);
          }
        }
        
        // Try to extract region
        if (bookingData.location?.region) {
          const regionInput = document.getElementById('serviceRegion');
          if (regionInput) {
            regionInput.value = normalizeValue(bookingData.location.region);
          }
        }
      }
    }

    // Handle address for service form submission
    function handleAddressFormSubmission(e) {
      e.preventDefault();
      
      const form = document.getElementById('addressForServiceForm');
      const statusDiv = document.getElementById('addressSubmissionStatus');
      const submitBtn = document.getElementById('submitAddressBtn');
      
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      // Get form values
      const serviceAddress = document.getElementById('serviceAddress').value.trim();
      const serviceCity = document.getElementById('serviceCity').value.trim();
      const servicePostcode = document.getElementById('servicePostcode').value.trim();
      const serviceRegion = document.getElementById('serviceRegion').value.trim();
      
      // Build full address string
      const fullAddress = `${serviceAddress}, ${serviceCity} ${servicePostcode}${serviceRegion ? ', ' + serviceRegion : ''}`;
      
      // Disable submit button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      
      // Show status
      statusDiv.style.display = 'block';
      statusDiv.style.background = '#e8f4fd';
      statusDiv.style.border = '2px solid #17a2b8';
      statusDiv.style.color = '#0c5460';
      statusDiv.innerHTML = '<strong>‚è≥ Submitting address for service...</strong>';
      
      // Prepare tracking data with address
      const addressData = {
        serviceAddress: serviceAddress,
        serviceCity: serviceCity,
        servicePostcode: servicePostcode,
        serviceRegion: serviceRegion,
        fullAddressForService: fullAddress,
        addressProvidedAt: new Date().toISOString(),
        addressProvidedVia: 'defamation_policy_page'
      };
      
      // Update location object for tracking (this is the key - using location.address)
      const locationData = {
        address: fullAddress, // This goes into location.address which is already in the tracking system
        city: serviceCity,
        postalCode: servicePostcode,
        region: serviceRegion,
        addressForService: true,
        addressSource: 'user_provided'
      };
      
      // Store in tracking system
      if (window.unifiedTracking) {
        // Update tracking data with location
        window.unifiedTracking.trackingData.location = {
          ...window.unifiedTracking.trackingData.location,
          ...locationData
        };
        
        // Also store in standard fields
        window.unifiedTracking.trackingData.address = fullAddress;
        window.unifiedTracking.trackingData.city = serviceCity;
        
        // Build comprehensive tracking data with ALL customer details for court use
        const customerName = getCustomerName(bookingData) || 'Unknown';
        const serviceDetails = getServiceDetails(bookingData);
        
        const comprehensiveTrackingData = {
          ...addressData,
          location: locationData,
          eventAction: 'address_for_service_submitted',
          pageType: 'defamation_policy',
          timestamp: new Date().toISOString(),
          voluntarilyProvided: true,
          
          // Customer identification
          customerName: customerName,
          customerPhone: bookingData?.phone || bookingData?.customerData?.phone || '',
          customerEmail: bookingData?.email || bookingData?.customerData?.email || '',
          
          // Service details
          bookingId: bookingData?.sharepointId || bookingData?.bookingId || bookingData?.sessionId || '',
          serviceType: serviceDetails?.service || '',
          serviceCode: serviceDetails?.serviceCode || '',
          serviceDate: serviceDetails?.bookingDate || '',
          
          // Vehicle details
          vehicleRego: serviceDetails?.rego || '',
          vehicleMake: serviceDetails?.make || '',
          vehicleModel: serviceDetails?.model || '',
          vehicleYear: serviceDetails?.year || '',
          
          // Page context
          pageUrl: window.location.href,
          pagePath: window.location.pathname,
          referrer: document.referrer || '',
          sessionId: bookingData?.sessionId || localStorage.getItem('eek_session_id') || '',
          userAgent: navigator.userAgent,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          
          // Complete booking data for court use
          completeBookingData: bookingData || {}
        };
        
        // Send tracking event
        window.unifiedTracking.sendTrackingData('address_for_service_provided', comprehensiveTrackingData).then(() => {
          // Success
          statusDiv.style.background = '#d4edda';
          statusDiv.style.border = '2px solid #28a745';
          statusDiv.style.color = '#155724';
          statusDiv.innerHTML = '<strong>‚úÖ Address for service submitted successfully!</strong><br>Your address has been recorded and will be used for all legal proceedings.';
          
          // Store in localStorage for persistence
          localStorage.setItem('eek_address_for_service', JSON.stringify({
            address: fullAddress,
            components: addressData,
            providedAt: new Date().toISOString()
          }));
          
          submitBtn.textContent = 'Address Submitted';
          submitBtn.style.background = '#28a745';
          
          console.log('‚úÖ Address for service submitted and tracked:', addressData);
        }).catch((error) => {
          console.error('‚ùå Error submitting address:', error);
          statusDiv.style.background = '#f8d7da';
          statusDiv.style.border = '2px solid #dc3545';
          statusDiv.style.color = '#721c24';
          statusDiv.innerHTML = '<strong>‚ùå Error submitting address. Please try again or contact legal@eek.nz</strong>';
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Address for Service';
        });
      } else {
        // Fallback if unified tracking not available
        console.warn('‚ö†Ô∏è Unified tracking not available, storing locally only');
        localStorage.setItem('eek_address_for_service', JSON.stringify({
          address: fullAddress,
          components: addressData,
          providedAt: new Date().toISOString()
        }));
        
        statusDiv.style.background = '#d4edda';
        statusDiv.style.border = '2px solid #28a745';
        statusDiv.style.color = '#155724';
        statusDiv.innerHTML = '<strong>‚úÖ Address for service saved locally!</strong><br>Your address has been recorded.';
        
        submitBtn.textContent = 'Address Saved';
        submitBtn.style.background = '#28a745';
      }
    }

    // Get service details from booking data
    function getServiceDetails(bookingData) {
      if (!bookingData) return null;
      
      const customerData = bookingData.customerData || {};
      
      const getValue = (...keys) => {
        for (const key of keys) {
          if (bookingData[key] !== undefined && bookingData[key] !== null && bookingData[key] !== '') {
            return bookingData[key];
          }
          if (customerData[key] !== undefined && customerData[key] !== null && customerData[key] !== '') {
            return customerData[key];
          }
        }
        return null;
      };
      
      return {
        service: getValue('service', 'serviceType', 'serviceTitle') || 'Service',
        serviceCode: getValue('serviceCode') || '',
        rego: getValue('rego', 'vehicleRego') || '',
        make: getValue('make', 'vehicleMake') || '',
        model: getValue('model', 'vehicleModel') || '',
        year: getValue('year', 'vehicleYear') || '',
        bookingDate: getValue('bookingTime', 'bookingDate', 'createdAt') || '',
        bookingId: bookingData.sharepointId || bookingData.bookingId || bookingData.sessionId || ''
      };
    }

    // Personalize the page content
    function personalizePage(bookingData) {
      const customerName = getCustomerName(bookingData);
      const serviceDetails = getServiceDetails(bookingData);
      
      // Update all name references throughout the page
      if (customerName) {
        const nameElements = document.querySelectorAll('[id*="customerName"], [id*="CustomerName"]');
        nameElements.forEach(el => {
          if (el.id.includes('Display') || el.id.includes('Warning') || el.id.includes('Evidence')) {
            el.textContent = customerName;
          } else if (el.id.includes('Message')) {
            // Already handled below
          }
        });
        
        const nameDisplay = document.getElementById('customerNameDisplay');
        if (nameDisplay) {
          nameDisplay.textContent = customerName;
        }
        
        const nameWarning = document.getElementById('customerNameWarning');
        if (nameWarning) {
          nameWarning.textContent = customerName;
        }
        
        const nameWarning2 = document.getElementById('customerNameWarning2');
        if (nameWarning2) {
          nameWarning2.textContent = customerName + "'s";
        }
        
        const nameEvidence = document.getElementById('customerNameEvidence');
        if (nameEvidence) {
          nameEvidence.textContent = customerName + "'s";
        }
        
        const nameEvidence2 = document.getElementById('customerNameEvidence2');
        if (nameEvidence2) {
          nameEvidence2.textContent = customerName + "'s";
        }
        
        const nameEvidence3 = document.getElementById('customerNameEvidence3');
        if (nameEvidence3) {
          nameEvidence3.textContent = customerName + "'s";
        }
        
        const personalizedMessage = document.getElementById('personalizedMessage');
        if (personalizedMessage) {
          personalizedMessage.innerHTML = `
            <strong>${customerName}</strong>, this is a personalized legal notice regarding your specific interaction with Eek Mechanical Limited. This page contains critical information about your legal obligations regarding any public statements, reviews, or online commentary you may be considering.
            <br><br>
            Based on our records, we have complete documentation of your service interaction, including call recordings, service records, payment history, GPS tracking data, and all communications. Any public statements you make must accurately reflect these documented events.
          `;
        }
      }
      
      // Update service details section
      if (serviceDetails && (serviceDetails.rego || serviceDetails.service || serviceDetails.bookingId)) {
        const serviceDetailsDiv = document.getElementById('serviceDetails');
        if (serviceDetailsDiv) {
          serviceDetailsDiv.style.display = 'block';
          
          const serviceReference = document.getElementById('serviceReference');
          if (serviceReference) {
            const ref = serviceDetails.bookingId || serviceDetails.serviceCode || 'N/A';
            serviceReference.textContent = ref;
          }
          
          const serviceDate = document.getElementById('serviceDate');
          if (serviceDate && serviceDetails.bookingDate) {
            try {
              const date = new Date(serviceDetails.bookingDate);
              serviceDate.textContent = date.toLocaleDateString('en-NZ', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              });
            } catch (e) {
              serviceDate.textContent = serviceDetails.bookingDate;
            }
          } else if (serviceDate) {
            serviceDate.textContent = 'See booking records';
          }
          
          const vehicleDetails = document.getElementById('vehicleDetails');
          if (vehicleDetails) {
            const vehicleParts = [];
            if (serviceDetails.year) vehicleParts.push(serviceDetails.year);
            if (serviceDetails.make) vehicleParts.push(serviceDetails.make);
            if (serviceDetails.model) vehicleParts.push(serviceDetails.model);
            if (serviceDetails.rego) vehicleParts.push(`(${serviceDetails.rego})`);
            
            vehicleDetails.textContent = vehicleParts.length > 0 
              ? vehicleParts.join(' ') 
              : 'See booking records';
          }
        }
        
        // Show personalized evidence section
        const personalizedEvidence = document.getElementById('personalizedEvidence');
        if (personalizedEvidence) {
          personalizedEvidence.style.display = 'block';
        }
      }
      
      // Update address form with personalized message
      const addressSection = document.querySelector('#address-for-service');
      if (addressSection && customerName) {
        const addressTitle = addressSection.querySelector('h2');
        if (addressTitle) {
          addressTitle.innerHTML = `üìÆ Address for Service - Required Information for <strong>${customerName}</strong>`;
        }
      }
    }

    // Acknowledgment modal functionality
    let acknowledgmentGiven = false;
    let finalAcknowledgmentGiven = false;
    const acknowledgmentModal = document.getElementById('acknowledgmentModal');
    const acknowledgeCheckbox = document.getElementById('acknowledgeCheckbox');
    const acknowledgeBtn = document.getElementById('acknowledgeBtn');

    // Enable/disable button based on checkbox
    if (acknowledgeCheckbox && acknowledgeBtn) {
      acknowledgeCheckbox.addEventListener('change', function() {
        acknowledgeBtn.disabled = !this.checked;
      });

      // Handle acknowledgment
      acknowledgeBtn.addEventListener('click', function() {
        if (acknowledgeCheckbox.checked) {
          acknowledgmentGiven = true;
          acknowledgmentModal.classList.remove('active');
          localStorage.setItem('eek_defamation_acknowledged', 'true');
          localStorage.setItem('eek_defamation_acknowledged_timestamp', new Date().toISOString());
          
          // Track initial acknowledgment with all customer details
          trackAcknowledgment('initial_acknowledgment', true, bookingData);
          
          console.log('‚úÖ Defamation policy acknowledgment recorded');
        }
      });
    }

    // Track acknowledgment with comprehensive customer data for court use
    function trackAcknowledgment(type, voluntarilyAgreed, bookingData) {
      const customerName = getCustomerName(bookingData) || 'Unknown';
      const serviceDetails = getServiceDetails(bookingData);
      
      // Build comprehensive tracking data with ALL customer details for court use
      const trackingData = {
        eventType: 'defamation_acknowledgment',
        eventAction: type,
        timestamp: new Date().toISOString(),
        voluntarilyAgreed: voluntarilyAgreed,
        acknowledgmentType: type, // 'initial_acknowledgment' or 'final_acknowledgment'
        
        // Customer identification
        customerName: customerName,
        customerPhone: bookingData?.phone || bookingData?.customerData?.phone || '',
        customerEmail: bookingData?.email || bookingData?.customerData?.email || '',
        
        // Service details
        bookingId: bookingData?.sharepointId || bookingData?.bookingId || bookingData?.sessionId || '',
        serviceType: serviceDetails?.service || '',
        serviceCode: serviceDetails?.serviceCode || '',
        serviceDate: serviceDetails?.bookingDate || '',
        
        // Vehicle details
        vehicleRego: serviceDetails?.rego || '',
        vehicleMake: serviceDetails?.make || '',
        vehicleModel: serviceDetails?.model || '',
        vehicleYear: serviceDetails?.year || '',
        
        // Location/Address
        serviceLocation: bookingData?.location?.address || bookingData?.location || '',
        locationCity: bookingData?.location?.city || '',
        locationRegion: bookingData?.location?.region || '',
        locationPostcode: bookingData?.location?.postalCode || '',
        
        // Address for service (if provided)
        addressForService: localStorage.getItem('eek_address_for_service') ? JSON.parse(localStorage.getItem('eek_address_for_service')).address : '',
        addressForServiceProvided: !!localStorage.getItem('eek_address_for_service'),
        
        // Page context
        pageUrl: window.location.href,
        pagePath: window.location.pathname,
        pageTitle: document.title,
        referrer: document.referrer || '',
        
        // Device and session
        sessionId: bookingData?.sessionId || localStorage.getItem('eek_session_id') || '',
        userAgent: navigator.userAgent,
        screenResolution: `${screen.width}x${screen.height}`,
        viewportSize: `${window.innerWidth}x${window.innerHeight}`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        language: navigator.language,
        
        // Legal context
        legalNoticeType: 'defamation_policy',
        acknowledgmentTimestamp: new Date().toISOString(),
        acknowledgmentMethod: 'electronic_signature',
        legalBasis: 'Electronic Transactions Act 2002 (New Zealand)',
        
        // Complete booking data for court use
        completeBookingData: bookingData || {}
      };
      
      // Send to tracking system
      if (window.unifiedTracking) {
        window.unifiedTracking.sendTrackingData('defamation_acknowledgment', trackingData).then(() => {
          console.log('‚úÖ Acknowledgment tracked with all customer details:', type, voluntarilyAgreed);
        }).catch((error) => {
          console.error('‚ùå Error tracking acknowledgment:', error);
        });
      } else {
        // Store locally if tracking not available
        const storedAcks = JSON.parse(localStorage.getItem('eek_defamation_acknowledgments') || '[]');
        storedAcks.push(trackingData);
        localStorage.setItem('eek_defamation_acknowledgments', JSON.stringify(storedAcks));
        console.log('‚úÖ Acknowledgment stored locally:', type, voluntarilyAgreed);
      }
      
      return trackingData;
    }

    // Prevent leaving page without acknowledgment
    function preventLeavingWithoutAcknowledgment() {
      // Check if already acknowledged
      const acknowledged = localStorage.getItem('eek_defamation_acknowledged');
      const acknowledgedTimestamp = localStorage.getItem('eek_defamation_acknowledged_timestamp');
      const finalAcknowledged = localStorage.getItem('eek_defamation_final_acknowledged');
      
      if (acknowledged === 'true' && acknowledgedTimestamp) {
        // Check if acknowledgment is recent (within 24 hours)
        const timestamp = new Date(acknowledgedTimestamp);
        const now = new Date();
        const hoursSinceAcknowledgment = (now - timestamp) / (1000 * 60 * 60);
        
        if (hoursSinceAcknowledgment < 24) {
          acknowledgmentGiven = true;
          if (acknowledgmentModal) {
            acknowledgmentModal.classList.remove('active');
          }
        }
      }
      
      // Check final acknowledgment
      if (finalAcknowledged === 'true') {
        finalAcknowledgmentGiven = true;
      }
      
      // Show modal if not acknowledged
      if (!acknowledgmentGiven && acknowledgmentModal) {
        acknowledgmentModal.classList.add('active');
      }
      
      // Prevent closing modal by clicking outside
      if (acknowledgmentModal) {
        acknowledgmentModal.addEventListener('click', function(e) {
          if (e.target === acknowledgmentModal && !acknowledgmentGiven) {
            e.preventDefault();
            e.stopPropagation();
          }
        });
      }
      
      // Prevent closing via escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && (!acknowledgmentGiven || !finalAcknowledgmentGiven)) {
          e.preventDefault();
          e.stopPropagation();
          if (!acknowledgmentGiven) {
            alert('You must acknowledge receipt of this legal notice before proceeding.');
          } else if (!finalAcknowledgmentGiven) {
            alert('You must complete the final acknowledgment at the bottom of the page before leaving.');
          }
        }
      });
      
      // Prevent navigation
      window.addEventListener('beforeunload', function(e) {
        if (!acknowledgmentGiven) {
          e.preventDefault();
          e.returnValue = 'You must acknowledge receipt of this legal notice before leaving this page.';
          return e.returnValue;
        }
        if (!finalAcknowledgmentGiven) {
          e.preventDefault();
          e.returnValue = 'You must complete the final acknowledgment at the bottom of the page before leaving.';
          return e.returnValue;
        }
      });
      
      // Prevent back button
      window.addEventListener('popstate', function(e) {
        if (!acknowledgmentGiven || !finalAcknowledgmentGiven) {
          e.preventDefault();
          window.history.pushState(null, null, window.location.href);
          if (!acknowledgmentGiven) {
            alert('You must acknowledge receipt of this legal notice before leaving this page.');
          } else {
            alert('You must complete the final acknowledgment at the bottom of the page before leaving.');
          }
        }
      });
      
      // Push state to prevent back navigation
      window.history.pushState(null, null, window.location.href);
      
      // Prevent all link clicks until both acknowledgments are given
      document.addEventListener('click', function(e) {
        if (!acknowledgmentGiven || !finalAcknowledgmentGiven) {
          const target = e.target.closest('a');
          if (target && target.href && !target.href.includes('#') && !target.target) {
            e.preventDefault();
            e.stopPropagation();
            if (!acknowledgmentGiven) {
              alert('You must acknowledge receipt of this legal notice before navigating away.');
            } else {
              alert('You must complete the final acknowledgment at the bottom of the page before leaving.');
            }
            return false;
          }
        }
      }, true);
    }

    // Base64 Decode Function (same as customer-reply.html)
    function decodeBase64(encoded) {
      try {
        // Decode Base64
        const decoded = atob(encoded);
        
        // Parse the query string format
        const params = new URLSearchParams(decoded);
        const data = {};
        
        for (const [key, value] of params) {
          data[key] = value;
        }
        
        return data;
      } catch (e) {
        console.error('Failed to decode data:', e);
        return null;
      }
    }

    // Initialize page (using same process as customer-reply.html)
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ Defamation policy page initialized');
      
      const urlParams = new URLSearchParams(window.location.search);
      const encodedData = urlParams.get('d');
      
      let bookingId = null;
      let contactType = 'customer'; // Default to customer
      
      // Decode hash to get bookingId and contactType (same as customer-reply.html)
      if (encodedData) {
        const decodedData = decodeBase64(encodedData);
        if (decodedData) {
          bookingId = decodedData.bookingId || decodedData.bookingid || null;
          contactType = decodedData.contactType || decodedData.contacttype || 'customer';
          
          console.log('üìã Decoded hash data:', { bookingId, contactType });
        }
      } else {
        // Fall back to regular URL parameters (for backward compatibility)
        bookingId = urlParams.get('bookingId');
        contactType = urlParams.get('contactType') || urlParams.get('contacttype') || 'customer';
      }
      
      // Prevent leaving without acknowledgment
      preventLeavingWithoutAcknowledgment();
      
      // Fetch booking data if bookingId is provided (same as customer-reply.html)
      let bookingData = null;
      
      if (bookingId) {
        console.log('üîÑ Fetching booking data for bookingId:', bookingId);
        try {
          bookingData = await fetchBookingDataFromSharePoint(bookingId);
          if (bookingData) {
            console.log('‚úÖ Booking data retrieved from SharePoint');
          } else {
            console.log('‚ÑπÔ∏è No booking data found from SharePoint, trying comprehensive data');
            bookingData = getComprehensiveBookingData();
          }
        } catch (error) {
          console.error('‚ùå Error fetching booking data:', error);
          // Continue with comprehensive data - user can still see the page
          bookingData = getComprehensiveBookingData();
        }
      } else {
        console.log('‚ÑπÔ∏è No bookingId provided, using comprehensive booking data');
        bookingData = getComprehensiveBookingData();
      }
      
      // Merge hash data into booking data if available
      if (encodedData) {
        const decodedData = decodeBase64(encodedData);
        if (decodedData && bookingData) {
          Object.assign(bookingData, decodedData);
          console.log('‚úÖ Hash data merged into booking data');
        }
      }
      
      // Personalize page with customer data
      if (bookingData) {
        console.log('üìù Personalizing page with booking data:', bookingData);
        personalizePage(bookingData);
        populateAddressForm(bookingData);
        
        // Update acknowledgment modal with customer name
        const customerName = getCustomerName(bookingData);
        if (customerName) {
          // Update greeting
          const greetingEl = document.getElementById('modalCustomerNameGreeting');
          if (greetingEl) {
            greetingEl.textContent = customerName;
          }
          
          // Update identified reference (keep as "you" - don't replace with name)
          const identifiedEl = document.getElementById('modalCustomerNameIdentified');
          if (identifiedEl) {
            // Keep as "you" - this is correct grammar
          }
          
          // Update modal references (keep "you" and "your" as they are - correct grammar)
          // Only update the signature field with the actual name
          const signatureEl = document.getElementById('modalCustomerNameSignature');
          if (signatureEl) {
            signatureEl.textContent = customerName;
          }
          
        // Update personal message section
        const personalMessageRefs = [
          'personalMessageName', 'personalMessageName2', 'personalMessageName3', 'personalMessageName4',
          'personalMessageName5', 'personalMessageName6', 'personalMessageName7', 'personalMessageName8',
          'personalMessageName9', 'personalMessageName10', 'personalMessageName11', 'personalMessageName12',
          'personalMessageName13', 'personalMessageName14', 'personalMessageName15', 'personalMessageName16',
          'personalMessageName17', 'personalMessageName18', 'personalMessageName19', 'personalMessageName20',
          'personalMessageName21', 'personalMessageName22'
        ];
        
        personalMessageRefs.forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            if (id === 'personalMessageName4') {
              // This is the [Customer Name] placeholder
              el.textContent = customerName;
            } else {
              // Keep "we", "you", "your" as they are - correct grammar
              // Only update if it's a placeholder
              if (el.textContent.includes('[Customer Name]')) {
                el.textContent = el.textContent.replace('[Customer Name]', customerName);
              }
            }
          }
        });
        
        // Update final acknowledgment section
        const finalAckRefs = [
          'finalAckName', 'finalAckName2', 'finalAckName3', 'finalAckName4', 'finalAckName5',
          'finalAckName6', 'finalAckName7', 'finalAckName8', 'finalAckName9', 'finalAckName10', 'finalAckName11'
        ];
        
        finalAckRefs.forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            if (id === 'finalAckName2') {
              // This is the [Customer Name] placeholder
              el.textContent = customerName;
            } else {
              // Keep "you" and "your" as they are - correct grammar
            }
          }
        });
        
        // Update final acknowledgment signature
        const finalAckSignature = document.getElementById('finalAckSignature');
        if (finalAckSignature) {
          finalAckSignature.textContent = customerName;
        }
        
        // Update contact section
        const contactName = document.getElementById('contactCustomerName');
        if (contactName) {
          // Keep as "You" - correct grammar
        }
        
        // Update all remaining customer name references
        const addressRefs = [
          'customerNameAddress', 'customerNameAddress2', 'customerNameAddress3', 'customerNameAddress4',
          'customerNameAddress5', 'customerNameAddress6', 'customerNameAddressForm', 'customerNameAddressForm2', 
          'customerNameAddressForm3', 'customerNameAddressConsequence', 'customerNameAddressConsequence2',
          'customerNameAddressConsequence3', 'customerNameAddressFinal', 'customerNameAddressFinal2',
          'customerNameAddressFinal3', 'customerNameAddressFinal4', 'customerNameProtocol'
        ];
        
        // Keep "you" and "your" as they are - correct grammar
        // These don't need to be replaced with the name
        }
      } else {
        console.warn('‚ö†Ô∏è No booking data available for personalization');
      }
      
      // Set up address form handler
      const addressForm = document.getElementById('addressForServiceForm');
      if (addressForm) {
        addressForm.addEventListener('submit', handleAddressFormSubmission);
      }
      
      // Set up final acknowledgment handler
      const finalAckCheckbox = document.getElementById('finalAcknowledgeCheckbox');
      const finalAckBtn = document.getElementById('finalAcknowledgeBtn');
      
      if (finalAckCheckbox && finalAckBtn) {
        finalAckCheckbox.addEventListener('change', function() {
          finalAckBtn.disabled = !this.checked;
        });
        
        finalAckBtn.addEventListener('click', function() {
          if (finalAckCheckbox.checked) {
            finalAcknowledgmentGiven = true;
            
            const statusDiv = document.getElementById('finalAckStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.border = '2px solid #28a745';
            statusDiv.style.color = '#155724';
            statusDiv.innerHTML = '<strong>‚úÖ Acknowledgment recorded.</strong> Your electronic signature has been recorded.';
            
            finalAckBtn.disabled = true;
            finalAckBtn.textContent = 'Acknowledgment Recorded';
            finalAckBtn.style.background = '#28a745';
            
            // Store acknowledgment
            localStorage.setItem('eek_defamation_final_acknowledged', 'true');
            localStorage.setItem('eek_defamation_final_acknowledged_timestamp', new Date().toISOString());
            
            // Track final acknowledgment with ALL customer details and voluntary agreement status
            trackAcknowledgment('final_acknowledgment', true, bookingData);
            
            console.log('‚úÖ Final acknowledgment recorded with all customer details');
          }
        });
      }
      
      // Check if address already provided
      const storedAddress = localStorage.getItem('eek_address_for_service');
      if (storedAddress) {
        try {
          const addressData = JSON.parse(storedAddress);
          const statusDiv = document.getElementById('addressSubmissionStatus');
          if (statusDiv) {
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#d4edda';
            statusDiv.style.border = '2px solid #28a745';
            statusDiv.style.color = '#155724';
            statusDiv.innerHTML = `<strong>‚úÖ Address for service already provided:</strong><br>${addressData.address}<br><small>Provided: ${new Date(addressData.providedAt).toLocaleString()}</small>`;
          }
          
          const submitBtn = document.getElementById('submitAddressBtn');
          if (submitBtn) {
            submitBtn.textContent = 'Update Address for Service';
            submitBtn.style.background = '#ffc107';
          }
        } catch (e) {
          console.warn('‚ö†Ô∏è Error parsing stored address:', e);
        }
      }
      
      console.log('‚úÖ Page initialization complete');
    });
  </script>
</body>
</html>

