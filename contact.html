<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us | EEK Mechanical</title>
    <meta name="description" content="Contact EEK Mechanical for inquiries, support, or general questions. Professional mobile mechanics across New Zealand.">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net https://static.cloudflareinsights.com;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://conversions-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com https://www.googleadservices.com https://www.google.hn https://www.eek.nz https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com https://static.cloudflareinsights.com;
        frame-src 'self' https://td.doubleclick.net https://www.googletagmanager.com;
        font-src 'self' data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <!-- Google Analytics (GA4 only - no ads tracking) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQNKF1YLWR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DQNKF1YLWR');
    </script>
    
    <!-- Centralized Phone Number Management -->
    <script src="/phone-manager.js?v={{ site.version }}"></script>
    
    <!-- Data Sanitizer (must load before tracking systems) -->
    <script src="/data-sanitizer.js?v=20251224.1"></script>
    <!-- Unified Tracking System -->
    <script src="/unified-tracking.js?v=20251224.1"></script>
    
    <!-- Centralized Footer Management -->
    <script src="/footer-new.js?v={{ site.version }}"></script>

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <style>
        :root {
            --primary: #ff5500;
            --primary-dark: #e64900;
            --secondary: #17a2b8;
            --accent: #17a2b8;
            --success: #28a745;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --white: #ffffff;
            --font-primary: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            --space-xs: 0.5rem;
            --space-sm: 0.75rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: var(--space-md);
            color: var(--gray-800);
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
        }

        .header-section {
            background: var(--white);
            padding: var(--space-xl);
            border-radius: 12px;
            margin-bottom: var(--space-lg);
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-section img {
            max-width: 200px;
            margin-bottom: var(--space-md);
        }

        .header-section h1 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: var(--space-xs);
        }

        .header-section p {
            color: var(--gray-600);
            font-size: 1.1rem;
        }

        .form-container {
            background: var(--white);
            padding: var(--space-xl);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-xs);
            font-size: 0.95rem;
        }

        .required {
            color: #ef4444;
        }

        input, select, textarea {
            width: 100%;
            padding: var(--space-md);
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-primary);
            transition: border-color 0.3s;
            background: var(--white);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 85, 0, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: var(--primary);
            color: var(--white);
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            transform: none;
        }

        .btn-loading {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .alert.visible {
            display: block;
        }

        .info-text {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 0.25rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header-section {
                padding: 1.5rem;
            }

            .header-section h1 {
                font-size: 1.5rem;
            }

            .form-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <img src="/brand-image.png" alt="EEK Mechanical" onerror="this.style.display='none'">
            <h1 id="pageTitle">Contact Us</h1>
            <p id="pageSubtitle">Get in touch with EEK Mechanical</p>
        </div>

        <div class="form-container">
            <div id="alertSuccess" class="alert alert-success">
                ✅ Your message has been sent successfully! We'll get back to you soon.
            </div>
            <div id="alertError" class="alert alert-error">
                ❌ Something went wrong. Please try again or call us directly.
            </div>

            <form id="contactForm" novalidate>
                <div class="form-group">
                    <label for="name">Your Name <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required placeholder="John Smith" autocomplete="name">
                </div>

                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="your.email@example.com" autocomplete="email">
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" placeholder="021 123 4567" autocomplete="tel">
                </div>

                <div class="form-group" id="subjectGroup">
                    <label for="subject">Subject <span class="required">*</span></label>
                    <select id="subject" name="subject" required>
                        <option value="">Select a subject...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="message">Your Message <span class="required">*</span></label>
                    <textarea id="message" name="message" required placeholder="Please tell us how we can help you..."></textarea>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    Send Message
                </button>
            </form>
        </div>
    </div>

    <script>
        // Power Automate endpoint
        const POWER_AUTOMATE_URL = 'https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/252cde504791494e823972d9651d0cee/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Qw5TH6rHqrevOeXH2VjtBtLGb1ggI7zRCIYEhBl3Xrw';

        // Form type configuration - maps URL paths to form types and options
        const FORM_TYPE_CONFIG = {
            'default': {
                formType: 'General Contact',
                pageTitle: 'Contact Us | EEK Mechanical',
                pageSubtitle: 'Get in touch with EEK Mechanical',
                subjectOptions: [
                    { value: 'general', text: 'General Inquiry' },
                    { value: 'service', text: 'Service Question' },
                    { value: 'billing', text: 'Billing Question' },
                    { value: 'other', text: 'Other' }
                ],
                messagePlaceholder: 'Please tell us how we can help you...'
            },
            'customer-escalation': {
                formType: 'Customer Escalation',
                pageTitle: 'Customer Escalation | EEK Mechanical',
                pageSubtitle: 'Escalate a customer service issue',
                subjectOptions: [
                    { value: 'complaint', text: 'Complaint' },
                    { value: 'service-issue', text: 'Service Issue' },
                    { value: 'billing-dispute', text: 'Billing Dispute' },
                    { value: 'refund-request', text: 'Refund Request' },
                    { value: 'other', text: 'Other' }
                ],
                messagePlaceholder: 'Please provide details about your concern or issue...'
            },
            'dispute-form': {
                formType: 'Dispute Form',
                pageTitle: 'Dispute Form | EEK Mechanical',
                pageSubtitle: 'Submit a formal dispute',
                subjectOptions: [
                    { value: 'service-dispute', text: 'Service Dispute' },
                    { value: 'billing-dispute', text: 'Billing Dispute' },
                    { value: 'contract-dispute', text: 'Contract Dispute' },
                    { value: 'other', text: 'Other' }
                ],
                messagePlaceholder: 'Please provide detailed information about your dispute...'
            },
            'helper-form': {
                formType: 'Helper Form',
                pageTitle: 'Helper Form | EEK Mechanical',
                pageSubtitle: 'Request assistance or support',
                subjectOptions: [
                    { value: 'technical-help', text: 'Technical Help' },
                    { value: 'account-help', text: 'Account Help' },
                    { value: 'booking-help', text: 'Booking Help' },
                    { value: 'other', text: 'Other' }
                ],
                messagePlaceholder: 'Please describe what kind of help you need...'
            }
        };

        // Get form type from URL path
        function getFormTypeFromPath() {
            const path = window.location.pathname.toLowerCase();
            const pathParts = path.split('/').filter(p => p);
            
            // Check for known form types in path (e.g., /customer-escalation, /dispute-form)
            for (const [key, config] of Object.entries(FORM_TYPE_CONFIG)) {
                if (key === 'default') continue;
                
                // Check if path contains the form type key
                if (pathParts.includes(key) || 
                    pathParts.includes(key.replace('-', '')) ||
                    path.includes(key)) {
                    return key;
                }
            }
            
            // Check URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const formTypeParam = urlParams.get('formType') || urlParams.get('type');
            if (formTypeParam && FORM_TYPE_CONFIG[formTypeParam]) {
                return formTypeParam;
            }
            
            return 'default';
        }

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            const formType = getFormTypeFromPath();
            const config = FORM_TYPE_CONFIG[formType] || FORM_TYPE_CONFIG['default'];
            
            // Update page content
            document.title = config.pageTitle;
            document.getElementById('pageTitle').textContent = config.formType;
            document.getElementById('pageSubtitle').textContent = config.pageSubtitle;
            
            // Populate subject dropdown
            const subjectSelect = document.getElementById('subject');
            subjectSelect.innerHTML = '<option value="">Select a subject...</option>' +
                config.subjectOptions.map(opt => 
                    `<option value="${opt.value}">${opt.text}</option>`
                ).join('');
            
            // Update message placeholder
            document.getElementById('message').placeholder = config.messagePlaceholder;

            // Form submission
            document.getElementById('contactForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const submitBtn = document.getElementById('submitBtn');
                const alertSuccess = document.getElementById('alertSuccess');
                const alertError = document.getElementById('alertError');

                alertSuccess.classList.remove('visible');
                alertError.classList.remove('visible');

                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="btn-loading"><span class="spinner"></span> Sending...</span>';

                try {
                    const formData = {
                        formType: formType,
                        formVersion: '1.0',
                        submittedAt: new Date().toISOString(),
                        
                        // Form fields
                        name: document.getElementById('name').value.trim(),
                        email: document.getElementById('email').value.trim(),
                        phone: document.getElementById('phone').value.trim(),
                        subject: document.getElementById('subject').value,
                        message: document.getElementById('message').value.trim(),
                        
                        // Fields array for dynamic email builder
                        fields: [
                            { name: 'Name', value: document.getElementById('name').value.trim() },
                            { name: 'Email', value: document.getElementById('email').value.trim() },
                            { name: 'Phone', value: document.getElementById('phone').value.trim() || 'Not provided' },
                            { name: 'Subject', value: document.getElementById('subject').value },
                            { name: 'Message', value: document.getElementById('message').value.trim() }
                        ]
                    };

                    if (typeof gtag === 'function') {
                        gtag('event', 'form_submit', {
                            form_type: formType
                        });
                    }

                    const response = await fetch(POWER_AUTOMATE_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    if (response.ok) {
                        alertSuccess.classList.add('visible');
                        document.getElementById('contactForm').reset();
                        
                        if (typeof gtag === 'function') {
                            gtag('event', 'form_submit_success', {
                                form_type: formType
                            });
                        }
                    } else {
                        throw new Error('Server returned ' + response.status);
                    }
                } catch (error) {
                    console.error('Form submission error:', error);
                    alertError.classList.add('visible');
                    
                    if (typeof gtag === 'function') {
                        gtag('event', 'form_submit_error', {
                            form_type: formType,
                            error_message: error.message
                        });
                    }
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Send Message';
                }
            });
        });
    </script>
</body>
</html>

