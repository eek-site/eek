<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Don't Buy a Lemon! Pre Purchase Vehicle Inspection - Today & Weekends - Eek Mechanical</title>
  <meta name="description" content="Same-day & weekend vehicle inspections. 353+ vetted mechanics nationwide. Report delivered within 90 minutes. Don't buy a lemon! Book your inspection today." />
  <meta name="keywords" content="pre purchase inspection, same day inspection, weekend vehicle inspection, car inspection NZ, don't buy a lemon, urgent inspection" />

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net;
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: https:;
      connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com;
      frame-src 'self' https://www.googletagmanager.com https://www.google.com;
    ">

  <!-- Reddit Pixel -->
  <script>
    !function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}
    (window,document);
    rdt('init', 'a2_hf16791nsdhx');
    rdt('track', 'PageVisit');
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084465163"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'AW-17084465163');
    gtag('config', 'G-DQNKF1YLWR');
  </script>
  
  <!-- Centralized Phone Number Management -->
  <script src="/phone-manager.js"></script>
  
  <!-- Centralized Tracking Management -->
  <script src="/tracking-manager.js"></script>
  
  <!-- Centralized Footer Management -->
  <script src="/footer.js"></script>

  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <style>
    :root {
      /* Brand Colors */
      --primary: #ff5500;
      --primary-light: #ff7733;
      --primary-dark: #e04400;
      --secondary: #28a745;
      --secondary-light: #20c997;
      --accent: #17a2b8;
      --danger: #dc3545;
      --warning: #ffc107;
      --success: #28a745;
      
      /* Neutral Colors */
      --white: #ffffff;
      --gray-50: #f8f9fa;
      --gray-100: #f5f5f5;
      --gray-200: #e9ecef;
      --gray-300: #dee2e6;
      --gray-400: #ced4da;
      --gray-500: #adb5bd;
      --gray-600: #6c757d;
      --gray-700: #495057;
      --gray-800: #343a40;
      --gray-900: #212529;
      
      /* Typography */
      --font-primary: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
      --font-heading: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      /* Transitions */
      --transition-fast: 150ms ease-in-out;
      --transition-normal: 300ms ease-in-out;
      --transition-slow: 500ms ease-in-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-primary);
      background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
      margin: 0;
      padding: 0 0 80px 0;
      color: var(--gray-800);
      text-align: center;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    header {
      background: var(--white);
      padding: var(--space-2xl) var(--space-xl);
      max-width: 1200px;
      margin: 0 auto var(--space-xl);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      text-align: center;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
    }
    
    .business-name {
      font-size: clamp(2rem, 5vw, 2.5rem);
      font-weight: 800;
      color: var(--primary);
      margin: var(--space-lg) 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      letter-spacing: -0.02em;
    }
    
    header img {
      max-width: min(250px, 80vw);
      height: auto;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-normal);
      display: block;
      margin: 0 auto;
    }
    
    header img:hover {
      transform: translateY(-2px);
    }
    
    h1 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      margin: var(--space-lg) 0 var(--space-md);
      color: var(--gray-800);
      font-weight: 700;
      line-height: 1.2;
    }

    .breadcrumb{background:#e8f4f8;padding:10px 20px;margin:0;text-align:left;font-size:.9em}
    .breadcrumb a{color:var(--brand);text-decoration:none}
    .breadcrumb a:hover{text-decoration:underline}

    .booking-container {
      max-width: 1200px;
      margin: var(--space-xl) auto;
      background: var(--white);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
      position: relative;
    }
    
    .booking-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    .booking-header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      padding: var(--space-2xl);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .booking-header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .booking-header h2 {
      margin: 0 0 var(--space-md) 0;
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      font-weight: 800;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }
    
    .booking-header p {
      margin: 0;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      opacity: 0.95;
      position: relative;
      z-index: 1;
    }

    .availability-banner{background:#28a745;color:#fff;padding:20px;margin-bottom:0;text-align:center}
    .availability-banner h3{margin:0 0 10px 0;font-size:1.6em;font-weight:800}
    .availability-banner p{margin:5px 0;font-size:1.1em}
    .availability-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:15px}
    .availability-item{background:rgba(255,255,255,.2);padding:15px;border-radius:8px}
    .availability-number{font-size:2em;font-weight:900;display:block;margin-bottom:5px}

    /* Mobile-First Progress Bar */
    .progress-bar{
      display:flex;
      justify-content:space-between;
      margin:20px 0;
      padding:0 5px;
      overflow-x:auto;
      gap:5px;
    }
    
    .progress-step{
      flex:1;
      text-align:center;
      position:relative;
      min-width:50px;
    }
    
    .progress-step::before{
      content:'';
      width:20px;
      height:20px;
      border-radius:50%;
      background:#ddd;
      display:block;
      margin:0 auto 4px;
      transition:all 0.3s ease;
    }
    
    .progress-step.active::before{
      background:#ff5500;
      box-shadow:0 0 0 3px rgba(255,85,0,0.2);
    }
    
    .progress-step.completed::before{
      background:#28a745;
      box-shadow:0 0 0 3px rgba(40,167,69,0.2);
    }
    
    .progress-step span{
      font-size:.75em;
      color:#666;
      font-weight:500;
      line-height:1.2;
    }
    
    .progress-step.active span{
      color:#ff5500;
      font-weight:700;
    }
    
    .progress-step.completed span{
      color:#28a745;
      font-weight:600;
    }
    
    /* Mobile improvements */
    @media (max-width: 480px) {
      .progress-step span{
        font-size:.7em;
      }
      
      .progress-step::before{
        width:18px;
        height:18px;
      }
    }

    .booking-steps{padding:30px}
    .step{display:none;text-align:left}
    .step.active{display:block}
    .step h3{color:var(--brand);margin-bottom:20px;font-size:1.4em}

    /* Mobile-First Service Selection */
    .service-selector{
      display:flex;
      flex-direction:column;
      gap:20px;
      margin:20px 0;
      padding:0 10px;
    }
    
    .service-option{
      background:#fff;
      border:3px solid #e9ecef;
      border-radius:20px;
      padding:25px;
      cursor:pointer;
      transition:all .3s ease;
      position:relative;
      box-shadow:0 4px 12px rgba(0,0,0,.1);
      text-align:center;
      min-height:200px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      margin-top:20px; /* Space for badge */
    }
    
    .service-option:hover{
      transform:translateY(-2px);
      border-color:#ff5500;
      box-shadow:0 8px 25px rgba(255,85,0,.15);
    }
    
    .service-option.selected{
      border-color:#ff5500;
      background:linear-gradient(135deg,#fff5f0,#ffe8df);
      box-shadow:0 8px 25px rgba(255,85,0,.2);
      transform:translateY(-2px);
    }
    
    .service-option.recommended{
      border-color:#28a745;
      background:linear-gradient(135deg,#f8fff9,#f0fff4);
    }
    
    .service-option.recommended::before{
      content:'MOST POPULAR';
      position:absolute;
      top:-12px;
      left:50%;
      transform:translateX(-50%);
      background:#28a745;
      color:#fff;
      padding:6px 16px;
      border-radius:20px;
      font-size:.75em;
      font-weight:800;
      letter-spacing:.3px;
      box-shadow:0 3px 8px rgba(40,167,69,0.3);
      border:2px solid #fff;
      z-index:10;
      white-space:nowrap;
    }
    
    .service-option.recommended.selected{
      border-color:#28a745;
      background:linear-gradient(135deg,#e8f5e8,#d4f8db);
    }
    
    .service-title{
      font-size:1.6em;
      font-weight:800;
      margin-bottom:10px;
      color:#333;
    }
    
    .service-price{
      font-size:2.5em;
      font-weight:900;
      color:#ff5500;
      margin:15px 0;
      line-height:1;
    }
    
    .service-option.recommended .service-price{
      color:#28a745;
    }
    
    .service-description{
      color:#666;
      font-size:1.1em;
      line-height:1.4;
      margin-bottom:20px;
      font-weight:500;
    }
    
    .service-features{
      list-style:none;
      padding:0;
      margin:20px 0;
      text-align:left;
    }
    
    .service-features li{
      padding:10px 0;
      border-bottom:1px solid #f0f0f0;
      display:flex;
      align-items:flex-start;
      font-size:1em;
      font-weight:500;
    }
    
    .service-features li:last-child{
      border-bottom:none;
    }
    
    .service-features li::before{
      content:'‚úì';
      color:#28a745;
      font-weight:700;
      margin-right:12px;
      font-size:1.3em;
      flex-shrink:0;
    }
    
    .service-option.recommended .service-features li::before{
      color:#28a745;
    }
    
    .service-savings{
      background:#fff3cd;
      border:2px solid #ffc107;
      border-radius:12px;
      padding:15px;
      margin-top:20px;
      font-size:1em;
      color:#856404;
      font-weight:700;
      text-align:center;
    }
    
    .service-badge{
      position:absolute;
      top:10px;
      right:10px;
      background:rgba(255,255,255,0.95);
      padding:4px 8px;
      border-radius:12px;
      font-size:0.7em;
      font-weight:600;
      color:#666;
      border:1px solid #e9ecef;
      z-index:5;
    }
    
    /* Service Selection Modal */
    .service-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .service-modal.show {
      display: flex;
    }

    .service-modal-content {
      background: white;
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .service-modal-header {
      background: linear-gradient(135deg, #ff5500, #ff7733);
      color: white;
      padding: 25px;
      border-radius: 20px 20px 0 0;
      position: relative;
      text-align: center;
    }

    .service-modal-header h3 {
      margin: 0 0 8px 0;
      font-size: 1.6em;
      font-weight: 700;
    }

    .service-modal-header p {
      margin: 0;
      opacity: 0.9;
      font-size: 1em;
    }

    .service-modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      font-size: 24px;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
    }

    .service-modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .service-modal-body {
      padding: 25px;
    }

    .service-modal-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .service-modal-option {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px;
      border: 3px solid #e9ecef;
      border-radius: 15px;
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      width: 100%;
    }

    .service-modal-option:hover {
      border-color: #ff5500;
      background: #fff5f0;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 85, 0, 0.15);
    }

    .service-modal-option.selected {
      border-color: #ff5500;
      background: linear-gradient(135deg, #fff5f0, #ffe8df);
      box-shadow: 0 4px 12px rgba(255, 85, 0, 0.2);
    }

    .service-modal-option.recommended {
      border-color: #28a745;
      background: linear-gradient(135deg, #f8fff9, #f0fff4);
    }

    .service-modal-option.recommended:hover {
      border-color: #28a745;
      background: linear-gradient(135deg, #e8f5e8, #d4f8db);
    }
    
    .service-modal-option.selected {
      border-color: #28a745;
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
    }
    
    .service-modal-option.selected .service-modal-details h4 {
      color: #155724;
    }
    
    .service-modal-option.selected .price {
      color: #28a745;
    }

    .service-modal-icon {
      font-size: 2.5em;
      flex-shrink: 0;
    }

    .service-modal-details h4 {
      margin: 0 0 5px 0;
      font-size: 1.2em;
      font-weight: 700;
      color: #333;
    }

    .service-modal-details .price {
      font-size: 1.8em;
      font-weight: 900;
      color: #ff5500;
      margin: 5px 0;
    }

    .service-modal-option.recommended .service-modal-details .price {
      color: #28a745;
    }

    .service-modal-details p {
      margin: 0;
      font-size: 0.9em;
      color: #666;
      line-height: 1.4;
    }

    .service-modal-badge {
      background: #28a745;
      color: white;
      padding: 4px 8px;
      border-radius: 10px;
      font-size: 0.7em;
      font-weight: 600;
      position: absolute;
      top: 10px;
      right: 10px;
    }

    .service-modal-footer {
      padding: 20px 25px;
      border-top: 1px solid #e9ecef;
      text-align: center;
    }

    .service-modal-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .service-modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    .service-modal-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Mobile Responsive */
    @media (min-width: 768px) {
      .service-selector{
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:30px;
        margin:30px 0;
        padding:0;
      }
      
      .service-option{
        min-height:300px;
      }
    }

    .contact-info{margin:15px 0}
    .contact-info label{display:block;margin-bottom:8px;font-weight:700}
    .contact-info .input-wrapper{position:relative;margin-bottom:15px;}
    .contact-info input,.contact-info textarea{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1em;box-sizing:border-box;transition:all .3s ease;}
    .contact-info input:focus,.contact-info textarea:focus{border-color:var(--brand);outline:none}
    .contact-info input.valid{border-color:#28a745;background:#f8fff9}
    .contact-info input.error{border-color:#dc3545;background:#fff5f5}
    .contact-info textarea{height:100px;resize:vertical;margin-bottom:15px;}
    .validation-check{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#28a745;font-weight:900;font-size:1.2em;pointer-events:none;}
    .error-message{color:#dc3545;font-size:.9em;margin:-10px 0 10px 0;display:none}
    .error-message.show{display:block}

    .info-box{background:#e8f4f8;border:2px solid #bee5eb;border-radius:12px;padding:20px;margin:20px 0;text-align:left}
    .info-box h4{margin:0 0 15px 0;color:#0c5460}
    .info-box p{margin:10px 0;line-height:1.5;color:#0c5460}

    .highlight-box{background:#fff3cd;border:2px solid #ffeaa7;border-radius:12px;padding:20px;margin:20px 0;text-align:left}
    .highlight-box h4{margin:0 0 10px 0;color:#856404}
    .highlight-box p{margin:8px 0;color:#856404;line-height:1.5}
    .highlight-box ul{margin:10px 0;padding-left:20px;color:#856404}
    .highlight-box li{margin:8px 0;line-height:1.5}

    .competitor-box{background:#f8f9fa;border:2px solid #dee2e6;border-radius:12px;padding:20px;margin:20px 0;text-align:left}
    .competitor-box h4{margin:0 0 15px 0;color:#495057}
    .competitor-box p{margin:8px 0;color:#6c757d;line-height:1.5}

    .day-selector{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:30px 0}
    .day-option{background:#fff;border:3px solid #ddd;border-radius:16px;padding:30px;cursor:pointer;transition:all .3s ease;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.08);position:relative}
    .day-option:hover{transform:translateY(-4px);border-color:var(--brand);box-shadow:0 8px 24px rgba(255,85,0,.2)}
    .day-option.selected{border-color:var(--brand);background:linear-gradient(135deg,#fff5f0,#ffe8df);box-shadow:0 8px 24px rgba(255,85,0,.25)}
    .day-option.featured{border-color:#28a745;background:linear-gradient(135deg,#f0fff4,#e8ffed)}
    .day-option.featured::before{content:'AVAILABLE TODAY';position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:#28a745;color:#fff;padding:4px 16px;border-radius:20px;font-size:.75em;font-weight:700;letter-spacing:.5px;white-space:nowrap}
    .day-option.featured.selected{border-color:#28a745;background:linear-gradient(135deg,#e1ffe6,#d4f8db)}
    .day-title{font-size:1.8em;font-weight:800;margin-bottom:10px;color:#333}
    .day-subtitle{font-size:1.1em;color:#666;margin-bottom:15px}
    .day-description{font-size:.95em;color:#666;line-height:1.5}

    .vehicle-types{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:20px 0}
    .vehicle-type{position:relative;background:#fff;border:2px solid #ddd;border-radius:12px;padding:20px;text-align:left;cursor:pointer;transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    .vehicle-type:hover{transform:translateY(-2px);border-color:var(--brand);box-shadow:0 8px 20px rgba(255,85,0,.15)}
    .vehicle-type.selected{border-color:var(--brand);background:linear-gradient(135deg,#fff5f0,#ffe8df);box-shadow:0 8px 22px rgba(255,85,0,.18);border-width:3px}
    .vehicle-type.popular{border-color:var(--ok);background:linear-gradient(135deg,#f2fff5,#e9ffef)}
    .vehicle-type.popular.selected{border-color:var(--ok);background:linear-gradient(135deg,#eaffea,#dbf8e0);border-width:3px}
    .vehicle-type-title{font-size:1.15rem;font-weight:800;margin-bottom:6px}
    .vehicle-type-subtitle{color:#555;font-size:1rem;margin-bottom:6px}
    .vehicle-note{color:#666;font-size:.95rem;margin-top:6px}

    .reservation-summary{background:#e8f4f8;border-radius:8px;padding:20px;margin:20px 0}
    .reservation-summary h4{margin:0 0 15px 0}
    .summary-item{display:flex;justify-content:space-between;margin:8px 0;align-items:center;font-size:.95em}
    .summary-item strong{color:var(--brand)}

    .trust-badges{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:20px 0;text-align:center}
    .trust-badge{padding:15px;background:#f8f9fa;border-radius:8px;border:2px solid #e9ecef;}
    .trust-badge-icon{font-size:2em;margin-bottom:8px;}
    .trust-badge-text{font-size:.9em;color:#495057;font-weight:600;}

    .button{background:var(--brand);color:#fff;padding:14px 28px;border:none;border-radius:8px;cursor:pointer;font-size:1.05em;text-decoration:none;display:inline-block;transition:all .2s;margin:10px 5px;font-weight:600;min-height:44px;min-width:44px;opacity:1;visibility:visible;}
    .button:hover{background:#e04400;transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,85,0,.3)}
    .button.secondary{background:var(--muted);opacity:1;visibility:visible;}
    .button.secondary:hover{background:#545b62}
    .button:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none;opacity:1;visibility:visible;}
    .button.processing{background:var(--muted);position:relative;opacity:1;visibility:visible;}
    .button.processing::after{content:'...';animation:dots 1.5s steps(3,end) infinite}
    @keyframes dots{0%,20%{content:'.'}40%{content:'..'}60%,100%{content:'...'}}

    .terms-section{background:#f8f9fa;border-radius:8px;padding:20px;margin:20px 0;text-align:left}
    .terms-checkbox{display:flex;align-items:flex-start;gap:10px;margin:15px 0}
    .terms-checkbox input{margin-top:4px;transform:scale(1.3);min-width:20px;min-height:20px;}
    .terms-text{font-size:.95em;line-height:1.5}
    .terms-text a{color:var(--brand);text-decoration:none}
    .terms-text a:hover{text-decoration:underline}

    .notification{position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#ff5500,#e04400);color:#fff;padding:15px 20px;border-radius:12px;box-shadow:0 8px 32px rgba(255,85,0,.4);z-index:1001;transform:translateX(400px);opacity:0;transition:all .4s ease;max-width:320px;border-left:4px solid rgba(255,255,255,.3)}
    .notification.show{transform:translateX(0);opacity:1}
    .notification.error{background:linear-gradient(135deg,#dc3545,#c82333);box-shadow:0 8px 32px rgba(220,53,69,.4)}
    .notification-content{display:flex;align-items:center;gap:12px}
    .notification-icon{font-size:1.5em;flex-shrink:0}
    .notification-text{flex:1;font-size:.95em;line-height:1.4}
    .notification-close{background:none;border:none;color:#fff;cursor:pointer;font-size:1.2em;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s ease;flex-shrink:0}
    .notification-close:hover{background:rgba(255,255,255,.2)}

    .exit-popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:9999;display:none;align-items:center;justify-content:center;padding:20px;}
    .exit-popup.show{display:flex;}
    .exit-popup-content{background:#fff;border-radius:12px;padding:40px;max-width:500px;text-align:center;position:relative;animation:slideIn .4s ease;}
    @keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}
    .exit-popup-close{position:absolute;top:15px;right:15px;background:none;border:none;font-size:28px;cursor:pointer;color:#999;transition:color .2s;width:40px;height:40px;display:flex;align-items:center;justify-content:center;}
    .exit-popup-close:hover{color:#333;}

    /* Mobile-First Responsive Design */
    @media (max-width: 768px) {
      .booking-steps{padding:15px}
      .business-name{font-size:1.6em}
      .availability-grid{grid-template-columns:1fr;gap:15px;}
      .service-selector{grid-template-columns:1fr;gap:15px;padding:0 5px;}
      .day-selector{grid-template-columns:1fr}
      .vehicle-types{grid-template-columns:1fr}
      .trust-badges{grid-template-columns:1fr;gap:10px;}
      .notification{top:10px;right:10px;left:10px;max-width:none;transform:translateY(-100px)}
      .notification.show{transform:translateY(0)}
      .exit-popup-content{padding:20px 15px;margin:0 10px;}
      
      /* Mobile header improvements */
      header{
        padding:20px 15px;
        margin:10px auto 20px;
      }
      
      h1{
        font-size:1.4em;
        line-height:1.3;
      }
      
      /* Mobile value proposition improvements */
      .availability-banner h3 {
        font-size: 1.4em;
        margin-bottom: 15px;
      }
      
      .availability-banner p {
        font-size: 1em;
        margin-bottom: 20px;
      }
      
      /* Mobile countdown timer */
      #countdown-hours, #countdown-minutes, #countdown-seconds {
        font-size: 2em !important;
      }
      
      /* Mobile service selection button */
      .button[onclick="openServiceSelectionModal()"] {
        min-width: 90vw !important;
        font-size: 1.2em !important;
        padding: 22px 30px !important;
        margin: 20px 0 !important;
        display: block !important;
        width: 100% !important;
        box-sizing: border-box !important;
        border-radius: 15px !important;
        min-height: 60px !important;
      }
      
      /* Mobile modal improvements */
      .service-modal-content {
        margin: 10px;
        max-height: 95vh;
        border-radius: 15px;
      }
      
      .service-modal-header {
        padding: 20px;
        border-radius: 15px 15px 0 0;
      }
      
      .service-modal-header h3 {
        font-size: 1.4em;
        margin-bottom: 10px;
      }
      
      .service-modal-body {
        padding: 20px;
      }
      
      .service-modal-option {
        padding: 20px;
        flex-direction: column;
        text-align: center;
        gap: 15px;
        min-height: 200px;
        border-radius: 12px;
      }
      
      .service-modal-icon {
        font-size: 2.5em;
      }
      
      .service-modal-details h4 {
        font-size: 1.2em;
        margin-bottom: 10px;
      }
      
      .service-modal-details .price {
        font-size: 1.8em;
        margin: 10px 0;
      }
      
      .service-modal-details p {
        font-size: 0.9em;
        margin: 10px 0;
      }
      
      .service-modal-details ul {
        font-size: 0.85em;
        margin: 15px 0 0 0;
        padding-left: 15px;
        text-align: left;
      }
      
      /* Mobile continue button */
      .button[onclick="goToStep2()"] {
        min-width: 90vw !important;
        font-size: 1.1em !important;
        padding: 20px 25px !important;
        margin: 20px 0 !important;
        display: block !important;
        width: 100% !important;
        box-sizing: border-box !important;
        border-radius: 15px !important;
        min-height: 60px !important;
      }
      
      /* Mobile form improvements */
      .contact-info input, .contact-info textarea{
        font-size:16px; /* Prevents zoom on iOS */
        padding:18px;
        border-radius: 12px;
        min-height: 50px;
      }
      
      .contact-info label {
        font-size: 1.1em;
        margin-bottom: 10px;
      }
      
      /* Mobile progress bar */
      .progress-step span {
        font-size: 0.8em;
      }
      
      .progress-step::before {
        width: 22px;
        height: 22px;
      }
      
      /* Mobile statistics grid */
      .availability-item {
        padding: 20px;
        text-align: center;
      }
      
      .availability-number {
        font-size: 2.2em;
        margin-bottom: 10px;
      }
      
      /* Mobile testimonials */
      .availability-banner > div:last-child {
        padding: 20px;
      }
      
      .availability-banner > div:last-child h4 {
        font-size: 1.2em;
        margin-bottom: 15px;
      }
      
      .availability-banner > div:last-child > div {
        grid-template-columns: 1fr;
        gap: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .booking-steps{padding:10px}
      
      .service-option{
        padding:15px;
        min-height:160px;
      }
      
      .service-title{
        font-size:1.3em;
      }
      
      .service-price{
        font-size:2em;
      }
      
      .service-features li{
        font-size:0.9em;
        padding:8px 0;
      }
      
      .button[onclick="goToStep2()"] {
        font-size: 1em !important;
        padding: 16px 20px !important;
        min-width: 90vw !important;
        display: block !important;
        margin: 10px auto !important;
      }
      
      /* Ensure all navigation buttons are visible on mobile */
      .button {
        display: inline-block !important;
        visibility: visible !important;
        opacity: 1 !important;
        min-width: 120px !important;
        margin: 5px !important;
      }
      
      /* Force all continue buttons to be visible */
      .button[onclick*="goToStep"] {
        opacity: 1 !important;
        visibility: visible !important;
        display: inline-block !important;
      }
      
      /* Main continue button mobile styles */
      #main-continue-btn {
        min-width: 90vw !important;
        font-size: 1.2em !important;
        padding: 20px 30px !important;
        display: block !important;
        margin: 20px auto !important;
      }
    }
  </style>
</head>
<body>
<header id="mainHeader">
  <img src="/lemon.png" alt="Don't buy a lemon! Eek Mechanical Pre Purchase Vehicle Inspection" />
  <div class="business-name">Eek Mechanical</div>
  <h1>‚ö†Ô∏è 1 in 5 Cars We Inspect Are Rejected - Don't Buy a Lemon!</h1>
  
  <!-- URGENT: Enhanced Value Proposition with Emotional Triggers -->
  <div style="background:linear-gradient(135deg,#dc3545,#c82333);border-radius:20px;padding:35px;margin:30px auto;max-width:900px;box-shadow:0 12px 40px rgba(220,53,69,.4);border:4px solid #fff;position:relative;overflow:hidden;">
    <!-- Urgency Badge -->
    <div style="position:absolute;top:-20px;left:50%;transform:translateX(-50%);background:#ffc107;color:#000;padding:12px 35px;border-radius:25px;font-size:.9em;font-weight:800;letter-spacing:.5px;box-shadow:0 8px 25px rgba(255,193,7,.6), 0 4px 15px rgba(0,0,0,.2);border:3px solid #fff;z-index:10;animation:float 3s ease-in-out infinite;">
      üî• URGENT: Limited Same-Day Slots Available
      </div>
    
    <!-- Background Pattern -->
    <div style="position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);animation:float 6s ease-in-out infinite;"></div>
    
    <div style="position:relative;z-index:2;">
      <!-- Main Value Proposition -->
      <div style="text-align:center;margin-bottom:30px;">
        <h2 style="color:#fff;font-size:2.2em;margin:0 0 15px 0;font-weight:900;text-shadow:3px 3px 6px rgba(0,0,0,0.3);line-height:1.2;">
          Don't Buy a Lemon! Get a Pre Purchase Vehicle Inspection Today
        </h2>
        <p style="color:#fff;font-size:1.4em;margin:0;font-weight:700;text-shadow:2px 2px 4px rgba(0,0,0,0.2);">
          Don't gamble with your hard-earned money. Here's what we uncover:
        </p>
      </div>
      
      <!-- Key Benefits Grid -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:25px;text-align:center;margin:30px 0;">
        <div style="background:rgba(255,255,255,0.2);padding:25px;border-radius:15px;backdrop-filter:blur(15px);border:3px solid rgba(255,255,255,0.3);position:relative;overflow:hidden;">
          <div style="font-size:3em;margin-bottom:15px;">üîç</div>
          <div style="color:rgba(255,255,255,.95);font-size:1.2em;font-weight:700;margin-bottom:10px;">Hidden Issues</div>
          <div style="color:rgba(255,255,255,.8);font-size:0.9em;">Reveal problems not visible during test drive</div>
      </div>
        
        <div style="background:rgba(255,255,255,0.2);padding:25px;border-radius:15px;backdrop-filter:blur(15px);border:3px solid rgba(255,255,255,0.3);position:relative;overflow:hidden;">
          <div style="font-size:3em;margin-bottom:15px;">üõ°Ô∏è</div>
          <div style="color:rgba(255,255,255,.95);font-size:1.2em;font-weight:700;margin-bottom:10px;">Safety Check</div>
          <div style="color:rgba(255,255,255,.8);font-size:0.9em;">Ensure brakes, tires & suspension are safe</div>
      </div>
        
        <div style="background:rgba(255,255,255,0.2);padding:25px;border-radius:15px;backdrop-filter:blur(15px);border:3px solid rgba(255,255,255,0.3);position:relative;overflow:hidden;">
          <div style="font-size:3em;margin-bottom:15px;">üí∞</div>
          <div style="color:rgba(255,255,255,.95);font-size:1.2em;font-weight:700;margin-bottom:10px;">Save Money</div>
          <div style="color:rgba(255,255,255,.8);font-size:0.9em;">Avoid costly repairs & negotiate better price</div>
        </div>
        
        <div style="background:rgba(255,255,255,0.2);padding:25px;border-radius:15px;backdrop-filter:blur(15px);border:3px solid rgba(255,255,255,0.3);position:relative;overflow:hidden;">
          <div style="font-size:3em;margin-bottom:15px;">‚úÖ</div>
          <div style="color:rgba(255,255,255,.95);font-size:1.2em;font-weight:700;margin-bottom:10px;">Peace of Mind</div>
          <div style="color:rgba(255,255,255,.8);font-size:0.9em;">Buy with confidence knowing the real condition</div>
        </div>
      </div>
      
      <!-- Social Proof & Urgency -->
      <div style="background:rgba(255,255,255,0.15);border-radius:15px;padding:25px;margin-top:25px;text-align:center;border:2px solid rgba(255,255,255,0.3);">
        <div style="display:flex;justify-content:center;align-items:center;gap:20px;flex-wrap:wrap;margin-bottom:15px;">
          <div style="text-align:center;">
            <div style="font-size:2.5em;color:#ffc107;">‚≠ê</div>
            <div style="color:#fff;font-size:0.9em;font-weight:600;">4.9/5 Rating</div>
          </div>
          <div style="text-align:center;">
            <div style="font-size:2.5em;color:#ffc107;">üîç</div>
            <div style="color:#fff;font-size:0.9em;font-weight:600;">353+ Mechanics</div>
          </div>
          <div style="text-align:center;">
            <div style="font-size:2.5em;color:#ffc107;">‚ö°</div>
            <div style="color:#fff;font-size:0.9em;font-weight:600;">Same-Day Service</div>
          </div>
        </div>
        <p style="color:#fff;font-size:1.2em;margin:0;font-weight:700;text-shadow:1px 1px 2px rgba(0,0,0,0.2);">
          ‚ö° <strong>Only 3 same-day slots left today</strong> - Book now to secure your inspection
        </p>
      </div>
    </div>
  </div>
</header>

<div class="breadcrumb" id="mainBreadcrumb">
  <a href="/" class="tracking-link">Home</a> > Don't Buy a Lemon - Pre Purchase Inspection
</div>

<div class="availability-banner" id="mainBanner">
  <h3>üö® URGENT: Only 3 Same-Day Slots Left Today!</h3>
  <p>Other inspection services make you wait 2-3 days. We inspect TODAY and deliver your report within 90 minutes.</p>
  
  <!-- Countdown Timer -->
  <div style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; padding: 20px; border-radius: 15px; margin: 25px 0; text-align: center; box-shadow: 0 6px 20px rgba(255,107,53,0.4); border: 3px solid #fff;">
    <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap; margin-bottom: 15px;">
      <div style="text-align: center;">
        <div style="font-size: 2.5em; font-weight: 900; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);" id="countdown-hours">03</div>
        <div style="font-size: 0.9em; font-weight: 600;">HOURS</div>
      </div>
      <div style="font-size: 2em; color: #fff;">:</div>
      <div style="text-align: center;">
        <div style="font-size: 2.5em; font-weight: 900; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);" id="countdown-minutes">47</div>
        <div style="font-size: 0.9em; font-weight: 600;">MINUTES</div>
      </div>
      <div style="font-size: 2em; color: #fff;">:</div>
      <div style="text-align: center;">
        <div style="font-size: 2.5em; font-weight: 900; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);" id="countdown-seconds">23</div>
        <div style="font-size: 0.9em; font-weight: 600;">SECONDS</div>
      </div>
    </div>
    <p style="margin: 0; font-size: 1.1em; font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
      ‚ö° Book now to secure your same-day inspection slot!
    </p>
  </div>
  
  <!-- Enhanced Availability Grid -->
  <div class="availability-grid">
    <div class="availability-item" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: 3px solid #fff; box-shadow: 0 4px 15px rgba(40,167,69,0.3);">
      <span class="availability-number" style="color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">353+</span>
      <div style="font-size: 1.1em; font-weight: 700;">Vetted Mechanics</div>
      <div style="font-size: 0.9em; opacity: 0.9;">Nationwide Coverage</div>
    </div>
    <div class="availability-item" style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: 3px solid #fff; box-shadow: 0 4px 15px rgba(255,107,53,0.3);">
      <span class="availability-number" style="color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">TODAY</span>
      <div style="font-size: 1.1em; font-weight: 700;">Same-Day Service</div>
      <div style="font-size: 0.9em; opacity: 0.9;">No Waiting</div>
    </div>
    <div class="availability-item" style="background: linear-gradient(135deg, #6f42c1, #e83e8c); color: white; border: 3px solid #fff; box-shadow: 0 4px 15px rgba(111,66,193,0.3);">
      <span class="availability-number" style="color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">60-90min</span>
      <div style="font-size: 1.1em; font-weight: 700;">Report Delivery</div>
      <div style="font-size: 0.9em; opacity: 0.9;">Lightning Fast</div>
    </div>
  </div>
  
  <!-- Customer Testimonials -->
  <div style="background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px; margin-top: 25px; text-align: center; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 2px solid #e9ecef;">
    <h4 style="color: #333; margin: 0 0 20px 0; font-size: 1.3em; font-weight: 700;">What Our Customers Say</h4>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
      <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #28a745;">
        <div style="color: #ffc107; font-size: 1.2em; margin-bottom: 10px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <p style="color: #333; font-style: italic; margin: 0 0 10px 0; font-size: 0.95em;">"Saved me from buying a $15,000 lemon! Found major engine issues the seller was hiding."</p>
        <div style="color: #666; font-size: 0.9em; font-weight: 600;">- Sarah M., Auckland</div>
      </div>
      <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #28a745;">
        <div style="color: #ffc107; font-size: 1.2em; margin-bottom: 10px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        <p style="color: #333; font-style: italic; margin: 0 0 10px 0; font-size: 0.95em;">"Inspection done same day, report in 90 minutes. Other services wanted 3 days!"</p>
        <div style="color: #666; font-size: 0.9em; font-weight: 600;">- Mike T., Wellington</div>
      </div>
      </div>
    <p style="color: #666; font-size: 0.9em; margin: 0; font-weight: 600;">
      <strong>Professional workshop hoist inspection</strong> - We catch what mobile services miss
    </p>
  </div>
</div>

<div class="booking-container">
  <div class="booking-header">
    <h2>Book Your Inspection</h2>
    <p>Same-day & weekend service ‚Ä¢ 7 simple steps ‚Ä¢ Secure payment</p>
  </div>

  <div class="progress-bar">
    <div class="progress-step active" id="step1-progress"><span>Service</span></div>
    <div class="progress-step" id="step2-progress"><span>Your Info</span></div>
    <div class="progress-step" id="step3-progress"><span>Vehicle</span></div>
    <div class="progress-step" id="step4-progress"><span>Seller</span></div>
    <div class="progress-step" id="step5-progress"><span>When</span></div>
    <div class="progress-step" id="step6-progress"><span>Type</span></div>
    <div class="progress-step" id="step7-progress"><span>Confirm</span></div>
  </div>

  <!-- Main Continue Button -->
  <div style="text-align:center;margin:40px 0;">
    <button onclick="openServiceSelectionModal()" id="main-continue-btn" style="background:linear-gradient(135deg,#ff5500,#ff7733);color:#fff;padding:25px 50px;font-size:1.5em;font-weight:800;border-radius:15px;border:4px solid #fff;min-width:350px;display:inline-block;text-decoration:none;transition:all 0.3s ease;cursor:pointer;box-shadow:0 8px 30px rgba(255,85,0,0.4);" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 40px rgba(255,85,0,0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 30px rgba(255,85,0,0.4)'">
      üîß CHOOSE YOUR INSPECTION SERVICE
    </button>
    <p style="margin-top:20px;color:#666;font-size:1.1em;font-weight:600;">‚úÖ Same-day & weekend inspections available</p>
  </div>

  <div class="booking-steps">
    <!-- Step 1: Service Selection - Clean Mobile Design -->
    <div class="step active" id="step1">
      <!-- Clear Header -->
      <div style="text-align:center;margin-bottom:30px;">
        <h2 style="margin:0 0 15px 0;color:#333;font-size:1.8em;font-weight:800;">Choose Your Inspection Service</h2>
        <p style="margin:0;color:#666;font-size:1.1em;font-weight:500;">Select the service that best fits your needs</p>
      </div>

      <!-- Service Selection Button -->
      <div style="text-align:center;margin:40px 0;">
        <button onclick="openServiceSelectionModal()" id="service-selection-btn" style="background:linear-gradient(135deg,#ff5500,#ff7733);color:#fff;padding:20px 40px;font-size:1.3em;font-weight:800;border-radius:15px;border:3px solid #fff;min-width:300px;display:inline-block;text-decoration:none;transition:all 0.3s ease;cursor:pointer;box-shadow:0 6px 20px rgba(255,85,0,0.3);" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(255,85,0,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(255,85,0,0.3)'">
          üîß CHOOSE YOUR SERVICE
        </button>
        <p style="margin-top:15px;color:#666;font-size:1em;font-weight:600;">‚úÖ Same-day & weekend inspections available</p>
        </div>

      <!-- Selected Service Display -->
      <div id="selected-service-display" style="display:none;background:#f8f9fa;border:2px solid #e9ecef;border-radius:15px;padding:25px;margin:20px 0;text-align:center;">
        <h3 style="margin:0 0 10px 0;color:#333;font-size:1.4em;font-weight:700;">Selected Service</h3>
        <div id="selected-service-info"></div>
        <button onclick="openServiceSelectionModal()" style="background:#6c757d;color:#fff;padding:10px 20px;border:none;border-radius:8px;font-size:0.9em;font-weight:600;cursor:pointer;margin-top:15px;">Change Selection</button>
          </div>
          
      <!-- Selection Required Message -->
      <div id="selection-required" style="display:none;background:#fff3cd;border:2px solid #ffc107;border-radius:12px;padding:15px;margin:20px 0;text-align:center;">
        <p style="margin:0;color:#856404;font-weight:600;font-size:1.1em;">‚ö†Ô∏è Please select a service option to continue</p>
      </div>

      <!-- Continue Button -->
      <div style="text-align:center;margin:30px 0;">
        <button class="button" onclick="goToStep2()" id="continue-btn" style="background:#6c757d;color:#fff;padding:18px 40px;font-size:1.2em;font-weight:800;border-radius:12px;border:3px solid #fff;min-width:280px;display:inline-block;text-decoration:none;transition:all 0.3s ease;cursor:not-allowed;" disabled>
          üìÖ SELECT A SERVICE TO CONTINUE
        </button>
      </div>
    </div>

    <!-- Step 2: Your Information -->
    <div class="step" id="step2">
      <div style="text-align:center;margin:0 0 20px 0;">
        <img src="/sweet-ride.png" alt="Professional vehicle inspection" style="max-width:300px;height:auto;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);" />
      </div>
      
      <div style="background:linear-gradient(135deg,#ff5500,#ff7733);border-radius:12px;padding:25px;margin-bottom:25px;text-align:center;color:#fff;">
        <h2 style="margin:0 0 10px 0;font-size:1.6em;">We Inspect Today - Not Next Week</h2>
        <p style="margin:0;font-size:1.05em;opacity:.95;">Other inspection services make you wait 2-3 days. We inspect same-day and deliver your report within 90 minutes. Don't lose the car while waiting.</p>
      </div>

      <div class="info-box">
        <h4>Why this inspection matters:</h4>
        <p>Professional inspection reveals hidden issues ‚Ä¢ Identifies safety concerns ‚Ä¢ Helps negotiate fair price ‚Ä¢ Prevents costly surprises after purchase</p>
      </div>

      <div class="contact-info">
        <label for="nameInput">Full Name *</label>
        <div class="input-wrapper">
          <input type="text" id="nameInput" placeholder="John Smith" required autocomplete="name"/>
        </div>
        
        <label for="phoneInput">Phone Number *</label>
        <div class="input-wrapper">
          <input type="tel" id="phoneInput" placeholder="021 234 5678" required inputmode="tel" autocomplete="tel"/>
        </div>
        
        <label for="emailInput">Email Address *</label>
        <div class="input-wrapper">
          <input type="email" id="emailInput" placeholder="your.email@example.com" required autocomplete="email"/>
        </div>
      </div>

      <div style="text-align:center;margin:20px 0;">
        <button class="button secondary" onclick="goToStep1()">‚Üê Back</button>
        <button class="button" onclick="goToStep3()">Continue to Vehicle Details ‚Üí</button>
      </div>
    </div>

    <!-- Step 3: Vehicle Information -->
    <div class="step" id="step3">
      <div style="text-align:center;margin:0 0 20px 0;">
        <img src="/sweet-ride.png" alt="Professional vehicle inspection" style="max-width:300px;height:auto;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);" />
      </div>
      
      <div style="background:linear-gradient(135deg,#17a2b8,#20c997);border-radius:12px;padding:25px;margin-bottom:25px;text-align:center;color:#fff;">
        <h2 style="margin:0 0 10px 0;font-size:1.6em;">Workshop Hoist Inspection - Not Driveway Mobile</h2>
        <p style="margin:0;font-size:1.05em;opacity:.95;">Mobile inspections can't see rust, exhaust leaks, or undercarriage damage. Our workshop hoists catch what mobile services miss. We assign a workshop within 10 minutes of the vehicle.</p>
      </div>

      <div class="contact-info">
        <label for="regoInput">Registration</label>
        <div class="input-wrapper">
          <input type="text" id="regoInput" placeholder="ABC123" style="text-transform:uppercase;" autocapitalize="characters" spellcheck="false"/>
        </div>
        
        <label for="yearInput">Year</label>
        <div class="input-wrapper">
          <input type="text" id="yearInput" placeholder="2018" maxlength="4" pattern="\\d{4}" inputmode="numeric"/>
        </div>
        
        <label for="makeInput">Make</label>
        <div class="input-wrapper">
          <input type="text" id="makeInput" placeholder="Toyota"/>
        </div>
        
        <label for="modelInput">Model</label>
        <div class="input-wrapper">
          <input type="text" id="modelInput" placeholder="Corolla"/>
        </div>
        
        <label for="locationInput">Where is the vehicle located? *</label>
        <div class="input-wrapper">
          <input type="text" id="locationInput" placeholder="Auckland CBD, Christchurch, Wellington..." required/>
        </div>
        <p style="color:#666;margin:-10px 0 15px 0;font-size:.9em;"><strong>353+ vetted mechanics nationwide.</strong> We'll assign you to the closest one (typically within 10 minutes).</p>
      </div>

      <div style="text-align:center;margin:20px 0;">
        <button class="button secondary" onclick="goToStep2()">‚Üê Back</button>
        <button class="button" onclick="goToStep4()">Continue to Seller Info ‚Üí</button>
      </div>
    </div>

    <!-- Step 4: Seller Information -->
    <div class="step" id="step4">
      <div style="text-align:center;margin:0 0 20px 0;">
        <img src="/sweet-ride.png" alt="Professional vehicle inspection" style="max-width:300px;height:auto;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);" />
      </div>
      
      <div style="background:linear-gradient(135deg,#fd7e14,#ffc107);border-radius:12px;padding:25px;margin-bottom:25px;text-align:center;color:#fff;">
        <h2 style="margin:0 0 10px 0;font-size:1.6em;">If The Seller Refuses, The Car Is Probably A Lemon</h2>
        <p style="margin:0;font-size:1.05em;opacity:.95;">Honest sellers always cooperate. If they refuse our workshop inspection, we give you a full store credit to use on your next vehicle. You either get a thorough inspection, or you get your money back to avoid a lemon. Win-win.</p>
      </div>

      <div class="highlight-box">
        <h4>What happens next:</h4>
        <p>We contact the seller to arrange workshop drop-off. Legitimate sellers cooperate immediately - they know their vehicle will pass. If a seller refuses, that's a red flag: they're likely hiding something costly. When that happens, we give you full store credit to use on your next inspection. You just avoided a major expense.</p>
      </div>

      <div class="contact-info">
        <label for="sellerNameInput">Seller Name *</label>
        <div class="input-wrapper">
          <input type="text" id="sellerNameInput" placeholder="Seller's name or dealership" required/>
        </div>
        
        <label for="sellerPhoneInput">Seller Phone *</label>
        <div class="input-wrapper">
          <input type="tel" id="sellerPhoneInput" placeholder="021 987 6543" required inputmode="tel"/>
        </div>
        
        <label for="detailsInput">Additional details (optional)</label>
        <textarea id="detailsInput" placeholder="Any specific concerns, known issues, traveling from out of town..."></textarea>
      </div>

      <div style="text-align:center;margin:20px 0;">
        <button class="button secondary" onclick="goToStep3()">‚Üê Back</button>
        <button class="button" onclick="goToStep5()">Continue to Select Day ‚Üí</button>
      </div>
    </div>

    <!-- Step 5: Day Selection -->
    <div class="step" id="step5">
      <div style="text-align:center;margin:0 0 20px 0;">
        <img src="/sweet-ride.png" alt="Professional vehicle inspection" style="max-width:300px;height:auto;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);" />
      </div>
      
      <div style="background:linear-gradient(135deg,#6f42c1,#e83e8c);border-radius:12px;padding:25px;margin-bottom:25px;text-align:center;color:#fff;">
        <h2 style="margin:0 0 10px 0;font-size:1.6em;">Saturday & Sunday Available - Other Services Aren't</h2>
        <p style="margin:0;font-size:1.05em;opacity:.95;">Found the perfect car on the weekend? Don't wait until Monday while another buyer snaps it up. We inspect Saturdays and Sundays.</p>
      </div>

      <div class="competitor-box">
        <h4>Our Availability Advantage:</h4>
        <p><strong>Other services:</strong> 24-48 hour advance booking, weekday-only, no weekends</p>
        <p><strong>We're available:</strong> Same-day bookings, Saturday & Sunday service</p>
      </div>

      <div id="daySelector" class="day-selector"></div>

      <div style="text-align:center;margin:20px 0;">
        <button class="button secondary" onclick="goToStep4()">‚Üê Back</button>
        <button class="button" id="confirmDayBtn" onclick="goToStep6()" disabled>Continue to Vehicle Type ‚Üí</button>
      </div>
    </div>

    <!-- Step 6: Vehicle Type -->
    <div class="step" id="step6">
      <div style="text-align:center;margin:0 0 20px 0;">
        <img src="/sweet-ride.png" alt="Professional vehicle inspection" style="max-width:300px;height:auto;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);" />
      </div>
      
      <div style="background:linear-gradient(135deg,#28a745,#20c997);border-radius:12px;padding:25px;margin-bottom:25px;text-align:center;color:#fff;">
        <h2 style="margin:0 0 10px 0;font-size:1.6em;">95% Of Vehicles Are Standard Pricing</h2>
        <p style="margin:0;font-size:1.05em;opacity:.95;">No hidden fees. Most cars, SUVs, utes, and motorhomes are included in the base price. Only specialty vehicles cost extra.</p>
      </div>

      <div class="vehicle-types">
        <div class="vehicle-type popular selected" onclick="selectVehicleType('standard', 0, this)">
          <div class="vehicle-type-title">Standard Vehicle</div>
          <div class="vehicle-type-subtitle">Cars, SUVs, utes, motorhomes with standard license</div>
          <div class="vehicle-note" style="color:#28a745;font-weight:700;">No additional fee</div>
        </div>

        <div class="vehicle-type" onclick="selectVehicleType('specialty', 129, this)">
          <div class="vehicle-type-title">Classic/Specialty</div>
          <div class="vehicle-type-subtitle">Classics, modified vehicles, rare imports</div>
          <div class="vehicle-note">Specialist expertise (+$129)</div>
        </div>
      </div>

      <div style="background:#f8f9fa;border-radius:8px;padding:15px;margin:20px 0;text-align:left;">
        <p style="margin:0;color:#495057;font-size:.9em;line-height:1.5;"><strong>Note:</strong> We inspect vehicles with standard licenses. Heavy truck (HT) licenses and commercial trucks requiring special licenses are not available for inspection through this service.</p>
      </div>

      <div style="text-align:center;margin:20px 0;">
        <button class="button secondary" onclick="goToStep5()">‚Üê Back</button>
        <button class="button" onclick="goToStep7()">Review Your Booking ‚Üí</button>
      </div>
    </div>

    <!-- Step 7: Confirm -->
    <div class="step" id="step7">
      <div style="text-align:center;margin:0 0 20px 0;">
        <img src="/sweet-ride.png" alt="Professional vehicle inspection" style="max-width:300px;height:auto;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);" />
      </div>
      
      <div style="background:linear-gradient(135deg,#dc3545,#c82333);border-radius:12px;padding:25px;margin-bottom:25px;text-align:center;color:#fff;">
        <h2 style="margin:0 0 10px 0;font-size:1.6em;"><span id="dynamicPrice">$599</span> Today Could Save You Thousands Tomorrow</h2>
        <p style="margin:0;font-size:1.05em;opacity:.95;">Hidden electrical problems, safety recalls, and mechanical issues can cost thousands. Know what you're buying before you pay.</p>
      </div>

      <div class="trust-badges">
        <div class="trust-badge">
          <div class="trust-badge-icon">üîí</div>
          <div class="trust-badge-text">Secure Payment</div>
        </div>
        <div class="trust-badge">
          <div class="trust-badge-icon">‚è±Ô∏è</div>
          <div class="trust-badge-text">60-90min Report</div>
        </div>
        <div class="trust-badge">
          <div class="trust-badge-icon">üèÜ</div>
          <div class="trust-badge-text">Workshop Hoist Inspection</div>
        </div>
      </div>

      <div class="reservation-summary">
        <h4>Your Inspection Booking</h4>
        <div class="summary-item"><span>Service:</span><strong id="summaryService"></strong></div>
        <div class="summary-item"><span>Your Phone:</span><strong id="summaryPhone"></strong></div>
        <div class="summary-item"><span>Vehicle Location:</span><strong id="summaryLocation"></strong></div>
        <div class="summary-item"><span>Inspection Day:</span><strong id="summaryDate"></strong></div>
        <div class="summary-item"><span>Vehicle Type:</span><strong id="summaryVehicle"></strong></div>
        <div class="summary-item" style="border-top:2px solid #bee5eb;margin-top:10px;padding-top:10px;font-size:1.15em;"><span>Total Fee:</span><strong id="summaryPrice" style="font-size:1.4em;"></strong></div>
      </div>

      <div class="info-box">
        <h4>What Happens Next:</h4>
        <p><strong>1.</strong> Complete payment through secure Stripe checkout</p>
        <p><strong>2.</strong> We contact you within 30 minutes to confirm</p>
        <p><strong>3.</strong> We coordinate with vehicle owner for workshop drop-off</p>
        <p><strong>4.</strong> Inspection completed on your selected day</p>
        <p id="reportTimingNote"><strong>5.</strong> Report delivered within 60-90 minutes</p>
      </div>

      <div class="terms-section">
        <h4>Terms and Conditions</h4>
        <div class="terms-checkbox">
          <input type="checkbox" id="termsAgree" onchange="toggleBookingButton()" />
          <div class="terms-text">
            I understand the <a href="https://eek.nz/terms" target="_blank">booking policies</a> - inspection is at assigned workshop, vehicle owner brings vehicle, and inspection fee is non-refundable once service is completed.
          </div>
        </div>
      </div>

      <div style="text-align:center;margin:20px 0;">
        <button class="button secondary" onclick="goToStep6()">‚Üê Back</button>
        <button class="button" id="generatePaymentBtn" onclick="generatePaymentLink()" disabled style="font-size:1.15em;padding:16px 32px;">Secure My Inspection Now ‚Üí</button>
        <p style="margin:15px 0;color:#666;font-size:.9em;">üîí Secure payment processing powered by Stripe</p>
      </div>
    </div>
  </div>
</div>

<!-- Service Selection Modal -->
<div class="service-modal" id="serviceModal">
  <div class="service-modal-content">
    <div class="service-modal-header">
      <h3>üîß Choose Your Inspection Service</h3>
      <p>Select the service that best fits your needs</p>
      <button class="service-modal-close" onclick="closeServiceModal()">√ó</button>
    </div>
    <div class="service-modal-body">
      <div class="service-modal-options">
        <!-- Basic Service Option -->
        <div class="service-modal-option" onclick="selectServiceInModal('basic', 299, this)" id="modal-basic-option">
          <span class="service-modal-icon">üîß</span>
          <div class="service-modal-details">
            <h4>Basic Mechanical Inspection</h4>
            <div class="price">$299</div>
            <p style="color: #28a745; font-weight: 700; margin: 5px 0;">‚úÖ Perfect for Dealer Inspections</p>
            <ul style="margin:10px 0 0 0;padding-left:20px;font-size:0.9em;color:#666;">
              <li>44-point mechanical inspection by A-grade mechanic</li>
              <li>Full pre-purchase inspection standards</li>
              <li>Pass/fail assessment with detailed report</li>
              <li>Workshop hoist inspection</li>
              <li>Same-day service available</li>
            </ul>
            <div style="background: #d4edda; border: 2px solid #c3e6cb; border-radius: 8px; padding: 10px; margin-top: 10px; font-size: 0.85em; color: #155724;">
              <strong>‚úÖ Recommended for:</strong> Dealer purchases where you trust the seller's documentation.
            </div>
          </div>
        </div>

        <!-- Comprehensive Service Option -->
        <div class="service-modal-option recommended" onclick="selectServiceInModal('comprehensive', 599, this)" id="modal-comprehensive-option">
          <span class="service-modal-icon">üìã</span>
          <div class="service-modal-details">
            <h4>Comprehensive Report</h4>
            <div class="price">$599</div>
            <p style="color: #28a745; font-weight: 700; margin: 5px 0;">‚úÖ RECOMMENDED: Complete protection</p>
            <ul style="margin:10px 0 0 0;padding-left:20px;font-size:0.9em;color:#666;">
              <li>Everything in Basic, PLUS:</li>
              <li>Finance owing check</li>
              <li>Insurance history verification</li>
              <li>Maintenance records review</li>
              <li>Seller interview & verification</li>
              <li>BUY/DON'T BUY recommendation</li>
              <li>Professional market valuation</li>
              <li>10+ page detailed report</li>
            </ul>
            <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 8px; padding: 10px; margin-top: 10px; font-size: 0.85em; color: #155724;">
              <strong>üõ°Ô∏è Protection:</strong> If we identify it's a lemon, you get $300 store credit. You never lose money on a bad car.
            </div>
          </div>
          <div class="service-modal-badge">Most Popular</div>
        </div>
      </div>
    </div>
    <div class="service-modal-footer">
      <button class="service-modal-btn" onclick="confirmServiceSelection()" id="confirm-service-btn" disabled>
        üìÖ CONFIRM SELECTION & CONTINUE
      </button>
    </div>
  </div>
</div>

<!-- Exit Intent Popup -->
<div class="exit-popup" id="exitPopup">
  <div class="exit-popup-content">
    <button class="exit-popup-close" onclick="closeExitPopup()">√ó</button>
    <h2 style="color:#dc3545;margin:0 0 15px 0;font-size:1.8em;">Wait! Don't Risk Buying a Lemon</h2>
    <p style="font-size:1.15em;margin:0 0 20px 0;line-height:1.5;">Complete your booking in the next <strong>30 minutes</strong> and save <strong id="exitDiscount">$40</strong> on your inspection.</p>
    <div style="background:#fff3cd;padding:15px;border-radius:8px;margin:0 0 20px 0;">
      <p style="margin:0;color:#856404;font-size:.95em;">‚ö†Ô∏è <strong>1 in 5 vehicles</strong> we inspect gets rejected. Don't gamble with a bad car.</p>
    </div>
    <button class="button" onclick="closeExitPopup()" style="font-size:1.2em;padding:16px 32px;">Continue Booking & Save <span id="exitDiscountBtn">$40</span> ‚Üí</button>
    <p style="margin:15px 0 0 0;color:#999;font-size:.85em;">Limited time offer - expires in 30 minutes</p>
  </div>
</div>

<script>
// CENTRALIZED GCLID EXTRACTION
function extractGCLID(urlParams) {
  return urlParams.get('gclid') || urlParams.get('gbraid') || urlParams.get('wbraid') || null;
}

console.log('üöÄ === OPTIMIZED PRE-PURCHASE INSPECTION FORM (7-STEP) LOADED === üöÄ');

// === TRACKING ===
let sessionId = null;
let gclid = null;
let utmData = {};

function initializeTracking() {
  sessionId = getOrCreateSessionId();
  gclid = getGCLID();
  utmData = getUTMData();
  console.log('‚úÖ Tracking initialized - Session:', sessionId, 'GCLID:', gclid);
  console.log('‚úÖ UTM Data:', utmData);
  console.log('‚úÖ API URLs - Pricing:', PRICING_API_URL);
  console.log('‚úÖ API URLs - Power Automate:', POWER_AUTOMATE_URL);
}

function getOrCreateSessionId() {
  let sid = localStorage.getItem("eek_session_id");
  if (!sid) {
    const urlParams = new URLSearchParams(window.location.search);
    sid = urlParams.get('session_id') || `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    localStorage.setItem("eek_session_id", sid);
  }
  return sid;
}

function getGCLID() {
  const urlParams = new URLSearchParams(window.location.search);
  let gclidValue = extractGCLID(urlParams);
  if (gclidValue) {
    localStorage.setItem("eek_gclid", gclidValue);
    localStorage.setItem("eek_gclid_timestamp", new Date().toISOString());
    return gclidValue;
  }
  const storedGclid = localStorage.getItem("eek_gclid");
  const storedTimestamp = localStorage.getItem("eek_gclid_timestamp");
  if (storedGclid && storedTimestamp) {
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    if (new Date(storedTimestamp) > thirtyDaysAgo) return storedGclid;
    localStorage.removeItem("eek_gclid");
    localStorage.removeItem("eek_gclid_timestamp");
  }
  return null;
}

function getUTMData() {
  const urlParams = new URLSearchParams(window.location.search);
  const utm = {};
  const utmParams = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content'];
  utmParams.forEach(param => {
    const value = urlParams.get(param);
    if (value) {
      utm[param] = value;
      localStorage.setItem(`eek_${param}`, value);
    } else {
      const stored = localStorage.getItem(`eek_${param}`);
      if (stored) utm[param] = stored;
    }
  });
  return utm;
}

// === BOOKING STATUS ===
const BOOKING_STATUS = {
  INITIAL: 'booking_started',
  SERVICE_SELECTED: 'service_selected',
  CONTACT_INFO: 'contact_info_complete',
  VEHICLE_INFO: 'vehicle_info_complete',
  SELLER_INFO: 'seller_info_complete',
  DAY_SELECTED: 'day_selected',
  VEHICLE_TYPE: 'vehicle_type_selected',
  TERMS_ACCEPTED: 'terms_accepted',
  PAYMENT_PENDING: 'payment_pending'
};

const STATUS_COLORS = {
  'booking_started': '#007bff',
  'service_selected': '#17a2b8',
  'contact_info_complete': '#20c997',
  'vehicle_info_complete': '#28a745',
  'seller_info_complete': '#fd7e14',
  'day_selected': '#6f42c1',
  'vehicle_type_selected': '#e83e8c',
  'terms_accepted': '#20c997',
  'payment_pending': '#dc3545'
};

// NZ TIMEZONE
const NZ_TZ = 'Pacific/Auckland';
function nowNZ() {
  const parts = new Intl.DateTimeFormat('en-NZ', {
    timeZone: NZ_TZ, hour12: false,
    year:'numeric', month:'2-digit', day:'2-digit',
    hour:'2-digit', minute:'2-digit', second:'2-digit'
  }).formatToParts(new Date());
  const get = t => parts.find(p => p.type === t).value;
  return new Date(`${get('year')}-${get('month')}-${get('day')}T${get('hour')}:${get('minute')}:${get('second')}`);
}

function fmtDateNZ(d){
  return d.toLocaleDateString('en-NZ', { timeZone: NZ_TZ, weekday:'long', year:'numeric', month:'long', day:'numeric' });
}

function getDayName(d){
  return d.toLocaleDateString('en-NZ', { timeZone: NZ_TZ, weekday:'long' });
}

// API URLS
const POWER_AUTOMATE_URL = 'https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/dbc93a177083499caf5a06eeac87683c/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=vXidGdo8qErY4QVv03JeNaGbA79eWEoiOxuDocljL6Q';
const PRICING_API_URL = 'https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2f31c90260554c5a9d6dcffec47bc6c2/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Ou7iqzZ1YI2PzT_9X-M6PT5iVo2QRboWnFZrO3IBOL4';

// STATE
let selectedService = 'comprehensive';
let selectedServicePrice = 599;
let selectedDay = null;
let selectedDayString = '';
let selectedVehicleType = 'standard';
let vehicleTypeAddon = 0;

// EXIT INTENT STATE
let exitIntentShown = false;
let exitIntentTimer = null;

// HELPERS
function sanitizePhone(val){ return (val || '').replace(/\D/g,''); }
function sanitizeRego(val){ return (val || '').toUpperCase().replace(/\s+/g,''); }
function sanitizeText(val){ return (val || '').trim().replace(/\s+/g,' '); }

// === FIELD VALIDATION ===
function setupFieldValidation() {
  const fields = ['nameInput', 'phoneInput', 'emailInput', 'locationInput', 'sellerNameInput', 'sellerPhoneInput'];
  
  fields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
      field.addEventListener('blur', function() {
        validateField(this);
      });
      
      // Clear validation on focus
      field.addEventListener('focus', function() {
        this.classList.remove('valid', 'error');
        const wrapper = this.closest('.input-wrapper');
        if (wrapper) {
          const check = wrapper.querySelector('.validation-check');
          if (check) check.remove();
        }
      });
    }
  });
}

function validateField(field) {
  let isValid = false;
  const value = field.value.trim();
  
  if (field.id.includes('email')) {
    isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
  } else if (field.id.includes('Phone')) {
    isValid = /^[\d\s\-\+\(\)]+$/.test(value) && value.replace(/\D/g,'').length >= 9;
  } else if (field.required || field.id === 'locationInput') {
    isValid = value.length > 0;
  } else {
    return; // Don't validate optional fields
  }
  
  if (isValid) {
    field.classList.remove('error');
    field.classList.add('valid');
    
    // Add checkmark
    const wrapper = field.closest('.input-wrapper');
    if (wrapper && !wrapper.querySelector('.validation-check')) {
      const check = document.createElement('span');
      check.className = 'validation-check';
      check.textContent = '‚úì';
      wrapper.appendChild(check);
    }
  } else if (value.length > 0) {
    field.classList.remove('valid');
    field.classList.add('error');
  }
}

// === EXIT INTENT ===
function initExitIntent() {
  document.addEventListener('mouseleave', function(e) {
    if (e.clientY < 0 && !exitIntentShown) {
      const currentStep = parseInt(document.querySelector('.step.active').id.replace('step', ''));
      if (currentStep > 1 && currentStep < 7) {
        showExitIntent(currentStep);
      }
    }
  });
}

function showExitIntent(currentStep) {
  exitIntentShown = true;
  const discount = currentStep >= 6 ? 40 : 20;
  
  document.getElementById('exitDiscount').textContent = `$${discount}`;
  document.getElementById('exitDiscountBtn').textContent = `$${discount}`;
  document.getElementById('exitPopup').classList.add('show');
  
  // Set timer to hide after 30 seconds if not interacted with
  exitIntentTimer = setTimeout(() => {
    closeExitPopup();
  }, 30000);
}

function closeExitPopup() {
  document.getElementById('exitPopup').classList.remove('show');
  if (exitIntentTimer) {
    clearTimeout(exitIntentTimer);
    exitIntentTimer = null;
  }
}

// === SERVICE SELECTION MODAL ===
let modalSelectedService = null;
let modalSelectedServicePrice = 0;

function openServiceSelectionModal() {
  const modal = document.getElementById('serviceModal');
  if (modal) {
    modal.classList.add('show');
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
  }
}

function closeServiceModal() {
  const modal = document.getElementById('serviceModal');
  if (modal) {
    modal.classList.remove('show');
    document.body.style.overflow = ''; // Restore scrolling
  }
}

function selectServiceInModal(type, price, element) {
  // Remove selection from all modal options
  document.querySelectorAll('.service-modal-option.selected').forEach(el => el.classList.remove('selected'));
  
  // Add selection to clicked option
  element.classList.add('selected');
  
  // Update modal variables
  modalSelectedService = type;
  modalSelectedServicePrice = price;
  
  // Update modal confirm button
  updateModalConfirmButton();
  
  console.log('üìã Modal service selected:', type, '$' + price);
}

function updateModalConfirmButton() {
  const confirmBtn = document.getElementById('confirm-service-btn');
  if (!confirmBtn) return;
  
  if (modalSelectedService) {
    confirmBtn.disabled = false;
    confirmBtn.style.background = 'linear-gradient(135deg,#28a745,#20c997)';
    confirmBtn.style.cursor = 'pointer';
  } else {
    confirmBtn.disabled = true;
    confirmBtn.style.background = '#6c757d';
    confirmBtn.style.cursor = 'not-allowed';
  }
}

function confirmServiceSelection() {
  if (!modalSelectedService) return;
  
  // Update global variables
  selectedService = modalSelectedService;
  selectedServicePrice = modalSelectedServicePrice;
  
  // Update main page display
  updateSelectedServiceDisplay();
  updateContinueButton();
  
  // Close modal
  closeServiceModal();
  
  // Hide selection required message
  const selectionRequired = document.getElementById('selection-required');
  if (selectionRequired) {
    selectionRequired.style.display = 'none';
  }
  
  console.log('‚úÖ Service confirmed:', selectedService, '$' + selectedServicePrice);
}

function updateSelectedServiceDisplay() {
  const display = document.getElementById('selected-service-display');
  const info = document.getElementById('selected-service-info');
  const selectionBtn = document.getElementById('service-selection-btn');
  
  if (!display || !info || !selectionBtn) return;
  
  if (selectedService) {
    const serviceName = selectedService === 'basic' ? 'Basic Mechanical Inspection' : 'Comprehensive Report';
    const servicePrice = selectedServicePrice;
    const serviceColor = selectedService === 'basic' ? '#ff5500' : '#28a745';
    
    info.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:center;gap:15px;margin-bottom:10px;">
        <span style="font-size:2em;">${selectedService === 'basic' ? 'üîß' : 'üìã'}</span>
        <div>
          <h4 style="margin:0;color:#333;font-size:1.2em;font-weight:700;">${serviceName}</h4>
          <div style="font-size:1.8em;font-weight:900;color:${serviceColor};">$${servicePrice}</div>
        </div>
      </div>
    `;
    
    display.style.display = 'block';
    selectionBtn.style.display = 'none';
  } else {
    display.style.display = 'none';
    selectionBtn.style.display = 'inline-block';
  }
}

// Update continue button based on selection
function updateContinueButton() {
  const continueBtn = document.getElementById('continue-btn');
  if (!continueBtn) return;
  
  if (selectedService) {
    // Enable button with green styling
    continueBtn.disabled = false;
    continueBtn.style.background = 'linear-gradient(135deg,#28a745,#20c997)';
    continueBtn.style.cursor = 'pointer';
    continueBtn.innerHTML = 'üìÖ CONTINUE TO BOOKING ‚Üí';
    
    // Add hover effects
    continueBtn.onmouseover = function() {
      this.style.transform = 'translateY(-3px)';
      this.style.boxShadow = '0 8px 25px rgba(40,167,69,0.5)';
    };
    continueBtn.onmouseout = function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 6px 20px rgba(40,167,69,0.4)';
    };
  } else {
    // Disable button with gray styling
    continueBtn.disabled = true;
    continueBtn.style.background = '#6c757d';
    continueBtn.style.cursor = 'not-allowed';
    continueBtn.innerHTML = 'üìÖ SELECT A SERVICE TO CONTINUE';
    continueBtn.onmouseover = null;
    continueBtn.onmouseout = null;
  }
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
  const modal = document.getElementById('serviceModal');
  if (event.target === modal) {
    closeServiceModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeServiceModal();
  }
});

// === DATA BUILDER ===
function buildInspectionData(status) {
  return {
    sessionId, gclid,
    bookingStatus: status,
    statusColor: STATUS_COLORS[status] || '#6c757d',
    timestamp: new Date().toISOString(),
    
    name: sanitizeText(document.getElementById('nameInput').value),
    phone: sanitizePhone(document.getElementById('phoneInput').value),
    email: document.getElementById('emailInput').value.trim(),
    location: sanitizeText(document.getElementById('locationInput').value),
    details: document.getElementById('detailsInput').value || '',
    
    rego: sanitizeRego(document.getElementById('regoInput').value),
    vehicleRego: sanitizeRego(document.getElementById('regoInput').value),
    year: document.getElementById('yearInput').value.trim(),
    vehicleYear: document.getElementById('yearInput').value.trim(),
    make: sanitizeText(document.getElementById('makeInput').value),
    vehicleMake: sanitizeText(document.getElementById('makeInput').value),
    model: sanitizeText(document.getElementById('modelInput').value),
    vehicleModel: sanitizeText(document.getElementById('modelInput').value),
    vehicleType: selectedVehicleType,
    batteryVoltage: '',
    
    sellerName: sanitizeText(document.getElementById('sellerNameInput').value),
    sellerPhone: sanitizePhone(document.getElementById('sellerPhoneInput').value),
    
    service: selectedService === 'basic' ? 'inspection_basic' : 'inspection_comprehensive',
    serviceCode: selectedService === 'basic' ? 'INSP_BASIC' : 'INSP_COMP',
    serviceTitle: selectedService === 'basic' ? 'Basic Mechanical Inspection' : 'Comprehensive Pre-Purchase Report',
    serviceTier: selectedService,
    basePrice: selectedServicePrice,
    
    scheduledDate: selectedDayString,
    scheduledDateISO: selectedDay ? selectedDay.toISOString() : '',
    scheduledDateNZ: selectedDay ? selectedDay.toLocaleString('sv-SE', { timeZone: NZ_TZ, hour12: false }) : '',
    timeWindow: 'Flexible same-day',
    timeWindowId: 'same-day-flexible',
    
    selectedVehicleType,
    vehicleTypeAddon,
    totalPrice: selectedServicePrice + vehicleTypeAddon,
    calculatedPrice: selectedServicePrice + vehicleTypeAddon,
    finalPrice: selectedServicePrice + vehicleTypeAddon,
    price: String(selectedServicePrice + vehicleTypeAddon),
    
    urgencyLevel: 'Same-Day',
    emergencyType: '',
    quoteReference: '',
    isWinz: 'false',
    
    utm: {
      source: utmData.utm_source || null,
      medium: utmData.utm_medium || null,
      campaign: utmData.utm_campaign || null,
      term: utmData.utm_term || null,
      content: utmData.utm_content || null,
      gclid
    },
    
    source: 'inspection_booking_form',
    formVersion: '5.1'
  };
}

async function sendInspectionUpdate(status) {
  const data = buildInspectionData(status);
  console.log(`üì° Sending ${status}:`, data);
  console.log(`üì° API URL:`, PRICING_API_URL);
  try {
    const response = await fetch(PRICING_API_URL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    console.log(`‚úÖ API Response: ${response.status} - ${response.statusText}`);
    if (!response.ok) {
      console.error(`‚ùå API Error: ${response.status} - ${response.statusText}`);
      const errorText = await response.text();
      console.error(`‚ùå Error Details:`, errorText);
    }
    return response;
  } catch (err) {
    console.error(`‚ùå Network Error:`, err);
    console.error(`‚ùå Error Details:`, err.message);
  }
}

// === NAVIGATION ===
function updateProgress(currentStep) {
  document.querySelectorAll('.progress-step').forEach((el, idx) => {
    el.classList.remove('active', 'completed');
    if (idx + 1 < currentStep) el.classList.add('completed');
    if (idx + 1 === currentStep) el.classList.add('active');
  });
}

function showStep(stepNum) {
  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  document.getElementById('step' + stepNum).classList.add('active');
  updateProgress(stepNum);
  
  // Hide main header/banner after step 1
  if (stepNum > 1) {
    document.getElementById('mainHeader').style.display = 'none';
    document.getElementById('mainBreadcrumb').style.display = 'none';
    document.getElementById('mainBanner').style.display = 'none';
  } else {
    document.getElementById('mainHeader').style.display = 'block';
    document.getElementById('mainBreadcrumb').style.display = 'block';
    document.getElementById('mainBanner').style.display = 'block';
  }
  
  window.scrollTo(0, 0);
}

function goToStep1() { showStep(1); }

async function goToStep2() {
  // Check if a service is selected
  if (!selectedService) {
    // Show selection required message
    const selectionRequired = document.getElementById('selection-required');
    if (selectionRequired) {
      selectionRequired.style.display = 'block';
    }
    
    // Scroll to service options
    const serviceSelector = document.querySelector('.service-selector');
    if (serviceSelector) {
      serviceSelector.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    return;
  }
  
  await sendInspectionUpdate(BOOKING_STATUS.SERVICE_SELECTED);
  showStep(2);
}

async function goToStep3() {
  document.querySelectorAll('.contact-info input').forEach(input => input.classList.remove('error'));
  document.querySelectorAll('.error-message').forEach(msg => msg.classList.remove('show'));
  
  const name = document.getElementById('nameInput').value.trim();
  const phone = document.getElementById('phoneInput').value.trim();
  const email = document.getElementById('emailInput').value.trim();
  
  let firstErrorField = null;
  
  if (!name) { showInlineError('nameInput', 'Please enter your full name'); firstErrorField = firstErrorField || document.getElementById('nameInput'); }
  if (!phone) { showInlineError('phoneInput', 'Please enter your phone number'); firstErrorField = firstErrorField || document.getElementById('phoneInput'); }
  else if (!/^[\d\s\-\+\(\)]+$/.test(phone) || phone.replace(/\D/g,'').length < 9) { showInlineError('phoneInput', 'Please enter a valid phone number'); firstErrorField = firstErrorField || document.getElementById('phoneInput'); }
  if (!email) { showInlineError('emailInput', 'Please enter your email'); firstErrorField = firstErrorField || document.getElementById('emailInput'); }
  else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showInlineError('emailInput', 'Please enter a valid email'); firstErrorField = firstErrorField || document.getElementById('emailInput'); }
  
  if (firstErrorField) {
    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
    firstErrorField.focus();
    showNotification('Required Fields', 'Please correct the errors highlighted', 'error');
    return;
  }
  
  await sendInspectionUpdate(BOOKING_STATUS.CONTACT_INFO);
  showStep(3);
}

async function goToStep4() {
  document.querySelectorAll('.contact-info input').forEach(input => input.classList.remove('error'));
  document.querySelectorAll('.error-message').forEach(msg => msg.classList.remove('show'));
  
  const location = document.getElementById('locationInput').value.trim();
  
  if (!location) {
    showInlineError('locationInput', 'Please enter vehicle location');
    document.getElementById('locationInput').scrollIntoView({ behavior: 'smooth', block: 'center' });
    document.getElementById('locationInput').focus();
    showNotification('Required Field', 'Please enter vehicle location', 'error');
    return;
  }
  
  await sendInspectionUpdate(BOOKING_STATUS.VEHICLE_INFO);
  showStep(4);
}

async function goToStep5() {
  document.querySelectorAll('.contact-info input').forEach(input => input.classList.remove('error'));
  document.querySelectorAll('.error-message').forEach(msg => msg.classList.remove('show'));
  
  const sellerName = document.getElementById('sellerNameInput').value.trim();
  const sellerPhone = document.getElementById('sellerPhoneInput').value.trim();
  
  let firstErrorField = null;
  
  if (!sellerName) { showInlineError('sellerNameInput', 'Please enter seller name'); firstErrorField = firstErrorField || document.getElementById('sellerNameInput'); }
  if (!sellerPhone) { showInlineError('sellerPhoneInput', 'Please enter seller phone'); firstErrorField = firstErrorField || document.getElementById('sellerPhoneInput'); }
  else if (!/^[\d\s\-\+\(\)]+$/.test(sellerPhone) || sellerPhone.replace(/\D/g,'').length < 9) { showInlineError('sellerPhoneInput', 'Please enter a valid phone number'); firstErrorField = firstErrorField || document.getElementById('sellerPhoneInput'); }
  
  if (firstErrorField) {
    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
    firstErrorField.focus();
    showNotification('Required Fields', 'Please correct the errors', 'error');
    return;
  }
  
  await sendInspectionUpdate(BOOKING_STATUS.SELLER_INFO);
  showStep(5);
}

async function goToStep6() {
  if (!selectedDay) {
    showNotification('Selection Required', 'Please select a day', 'error');
    return;
  }
  await sendInspectionUpdate(BOOKING_STATUS.DAY_SELECTED);
  showStep(6);
}

async function goToStep7() {
  await sendInspectionUpdate(BOOKING_STATUS.VEHICLE_TYPE);
  updateSummary();
  showStep(7);
}

function showInlineError(inputId, message) {
  const input = document.getElementById(inputId);
  input.classList.add('error');
  let errorMsg = input.parentElement.querySelector('.error-message');
  if (!errorMsg) {
    errorMsg = document.createElement('div');
    errorMsg.className = 'error-message';
    input.parentElement.appendChild(errorMsg);
  }
  errorMsg.textContent = message;
  errorMsg.classList.add('show');
}

// === DAY SELECTOR ===
function initializeDaySelector() {
  const today = nowNZ();
  const dayOfWeek = today.getDay();
  const container = document.getElementById('daySelector');
  let options = [];
  
  if (dayOfWeek >= 1 && dayOfWeek <= 5) {
    const todayDate = new Date(today);
    options.push({day: todayDate, title: 'Today', subtitle: getDayName(todayDate), description: 'Inspection completed today', featured: true});
    
    const daysUntilSaturday = (6 - dayOfWeek + 7) % 7 || 7;
    const saturdayDate = new Date(today);
    saturdayDate.setDate(saturdayDate.getDate() + daysUntilSaturday);
    options.push({day: saturdayDate, title: 'This Saturday', subtitle: saturdayDate.toLocaleDateString('en-NZ', {timeZone: NZ_TZ, month: 'long', day: 'numeric'}), description: 'Weekend inspection available', featured: false});
    
    const daysUntilSunday = (7 - dayOfWeek + 7) % 7 || 7;
    const sundayDate = new Date(today);
    sundayDate.setDate(sundayDate.getDate() + daysUntilSunday);
    options.push({day: sundayDate, title: 'This Sunday', subtitle: sundayDate.toLocaleDateString('en-NZ', {timeZone: NZ_TZ, month: 'long', day: 'numeric'}), description: 'Weekend inspection available', featured: false});
  } else if (dayOfWeek === 6) {
    const todayDate = new Date(today);
    options.push({day: todayDate, title: 'Today', subtitle: 'Saturday', description: 'Weekend inspection', featured: true});
    const sundayDate = new Date(today);
    sundayDate.setDate(sundayDate.getDate() + 1);
    options.push({day: sundayDate, title: 'Tomorrow', subtitle: 'Sunday', description: 'Weekend inspection', featured: false});
  } else {
    const todayDate = new Date(today);
    options.push({day: todayDate, title: 'Today', subtitle: 'Sunday', description: 'Weekend inspection', featured: true});
  }
  
  container.innerHTML = options.map((opt, idx) => {
    const featuredClass = opt.featured ? 'featured' : '';
    const selectedClass = idx === 0 ? 'selected' : '';
    return `<div class="day-option ${featuredClass} ${selectedClass}" data-day="${opt.day.toISOString()}" data-string="${fmtDateNZ(opt.day)}" onclick="selectDay('${opt.day.toISOString()}', '${fmtDateNZ(opt.day)}', this)">
      <div class="day-title">${opt.title}</div>
      <div class="day-subtitle">${opt.subtitle}</div>
      <div class="day-description">${opt.description}</div>
    </div>`;
  }).join('');
  
  if (options.length > 0) {
    selectedDay = options[0].day;
    selectedDayString = fmtDateNZ(options[0].day);
    document.getElementById('confirmDayBtn').disabled = false;
  }
}

function selectDay(dayISO, dayString, element){
  document.querySelectorAll('.day-option.selected').forEach(el => el.classList.remove('selected'));
  element.classList.add('selected');
  selectedDay = new Date(dayISO);
  selectedDayString = dayString;
  document.getElementById('confirmDayBtn').disabled = false;
}

function selectVehicleType(type, addon, el){
  document.querySelectorAll('.vehicle-type.selected').forEach(x=>x.classList.remove('selected'));
  el.classList.add('selected');
  selectedVehicleType = type;
  vehicleTypeAddon = addon;
}

function updateSummary(){
  const serviceNames = {'basic': 'Basic Mechanical', 'comprehensive': 'Comprehensive Report'};
  const vehicleNames = {'standard': 'Standard Vehicle', 'specialty': 'Classic/Specialty (+$129)'};
  
  const totalPrice = selectedServicePrice + vehicleTypeAddon;
  
  document.getElementById('summaryService').textContent = serviceNames[selectedService];
  document.getElementById('summaryPhone').textContent = document.getElementById('phoneInput').value;
  document.getElementById('summaryLocation').textContent = document.getElementById('locationInput').value;
  document.getElementById('summaryDate').textContent = selectedDayString;
  document.getElementById('summaryVehicle').textContent = vehicleNames[selectedVehicleType];
  document.getElementById('summaryPrice').textContent = `$${totalPrice}`;
  
  // Update dynamic price in red block
  document.getElementById('dynamicPrice').textContent = `$${totalPrice}`;
  
  document.getElementById('reportTimingNote').innerHTML = selectedService === 'basic' ? '<strong>5.</strong> Report delivered immediately' : '<strong>5.</strong> Report within 60-90 minutes';
}

function toggleBookingButton(){
  document.getElementById('generatePaymentBtn').disabled = !document.getElementById('termsAgree').checked;
}

function buildRedirectUrl(){
  const params = new URLSearchParams();
  params.append('name', sanitizeText(document.getElementById('nameInput').value));
  params.append('phone', sanitizePhone(document.getElementById('phoneInput').value));
  params.append('email', document.getElementById('emailInput').value.trim());
  params.append('location', sanitizeText(document.getElementById('locationInput').value));
  params.append('service', selectedService === 'basic' ? 'inspection_basic' : 'inspection_comprehensive');
  params.append('price', selectedServicePrice + vehicleTypeAddon);
  if (sessionId) params.append('session_id', sessionId);
  if (gclid) params.append('gclid', gclid);
  return `https://www.eek.nz/thanks?${params.toString()}`;
}

async function generatePaymentLink(){
  const btn = document.getElementById('generatePaymentBtn');
  if (!document.getElementById('termsAgree').checked) {
    showNotification('Terms Required', 'Please accept the terms', 'error');
    return;
  }
  
  btn.disabled = true; btn.classList.add('processing'); btn.textContent='Processing...';
  await sendInspectionUpdate(BOOKING_STATUS.TERMS_ACCEPTED);
  
  const total = selectedServicePrice + vehicleTypeAddon;
  const serviceTitle = selectedService === 'basic' ? 'Basic Mechanical Inspection' : 'Comprehensive Pre-Purchase Report';
  
  const bookingData = {
    amount: total * 100,
    currency: 'NZD',
    description: `${serviceTitle} - ${document.getElementById('locationInput').value}`,
    redirectUrl: buildRedirectUrl(),
    customerData: {
      ...buildInspectionData(BOOKING_STATUS.PAYMENT_PENDING),
      bookingDateTime: nowNZ().toLocaleString('en-NZ', { timeZone: NZ_TZ })
    }
  };
  
  try{
    const response = await fetch(POWER_AUTOMATE_URL, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(bookingData)});
    if (response.ok){
      const result = await response.json();
      if (result.url){
        btn.style.display='none';
        const successDiv = document.createElement('div');
        successDiv.style.cssText='background:#d4edda;border:3px solid #28a745;padding:25px;border-radius:12px;margin-top:20px;text-align:center;';
        successDiv.innerHTML = `<h4 style="color:#155724;margin:0 0 15px 0;font-size:1.3em;">‚úì Payment Link Ready!</h4><a href="${result.url}" class="button" style="background:#28a745;font-size:1.3em;padding:18px 36px;">Complete Secure Payment ($${total}) ‚Üí</a><p style="color:#666;font-size:.95em;margin-top:15px;line-height:1.5;">üîí Secure checkout powered by Stripe<br>We'll contact you within 30 minutes after payment</p>`;
        btn.parentElement.appendChild(successDiv);
        setTimeout(()=>{ window.location.href = result.url; },3000);
      } else throw new Error('No payment URL');
    } else throw new Error('Server error '+response.status);
  }catch(err){
    console.error(err);
    btn.disabled=false; btn.classList.remove('processing'); btn.textContent='Secure My Inspection Now ‚Üí';
    showNotification('Connection Error', 'Unable to generate link. Please try again', 'error');
  }
}

function showNotification(title, message, type = 'info') {
  const existing = document.querySelector('.notification');
  if (existing) existing.remove();
  const iconMap = { error: '‚ö†', success: '‚úì', info: '‚Ñπ' };
  const wrap = document.createElement('div');
  wrap.className = 'notification ' + type;
  wrap.innerHTML = `<div class="notification-content"><div class="notification-icon">${iconMap[type]}</div><div class="notification-text"><strong>${title}</strong><br>${message}</div><button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button></div>`;
  document.body.appendChild(wrap);
  setTimeout(() => wrap.classList.add('show'), 100);
  setTimeout(() => wrap.remove(), 5000);
}

// === COUNTDOWN TIMER ===
function startCountdownTimer() {
  // Set countdown to 3 hours 47 minutes 23 seconds from now
  const now = new Date();
  const endTime = new Date(now.getTime() + (3 * 60 + 47) * 60 * 1000 + 23 * 1000);
  
  function updateCountdown() {
    const now = new Date();
    const timeLeft = endTime - now;
    
    if (timeLeft <= 0) {
      // Reset timer when it reaches zero
      const newEndTime = new Date(now.getTime() + (3 * 60 + 47) * 60 * 1000 + 23 * 1000);
      endTime.setTime(newEndTime.getTime());
      return;
    }
    
    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    const hoursEl = document.getElementById('countdown-hours');
    const minutesEl = document.getElementById('countdown-minutes');
    const secondsEl = document.getElementById('countdown-seconds');
    
    if (hoursEl) hoursEl.textContent = hours.toString().padStart(2, '0');
    if (minutesEl) minutesEl.textContent = minutes.toString().padStart(2, '0');
    if (secondsEl) secondsEl.textContent = seconds.toString().padStart(2, '0');
  }
  
  updateCountdown();
  setInterval(updateCountdown, 1000);
}

// === ENHANCED SERVICE MODAL ===
function openServiceSelectionModal() {
  const modal = document.getElementById('serviceModal');
  if (modal) {
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    
    // Add urgency to modal
    const modalHeader = modal.querySelector('.service-modal-header');
    if (modalHeader) {
      modalHeader.innerHTML = `
        <h3>üîß Choose Your Inspection Service</h3>
        <p>Select the service that best fits your needs</p>
        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
          ‚ö° <strong>Only 3 same-day slots left!</strong> Book now to secure your inspection
        </div>
        <button class="service-modal-close" onclick="closeServiceModal()">√ó</button>
      `;
    }
  }
}

// INITIALIZE
document.addEventListener('DOMContentLoaded', function(){
  console.log('‚úÖ Optimized 7-Step Form Initialized (v5.1)');
  initializeTracking();
  sendInspectionUpdate(BOOKING_STATUS.INITIAL);
  initializeDaySelector();
  setupFieldValidation();
  initExitIntent();
  startCountdownTimer();
  
  // Initialize service selection state
  selectedService = null;
  selectedServicePrice = 0;
  updateContinueButton();
  updateSelectedServiceDisplay();
  
  // Show initial step
  showStep(1);
});
</script>
</body>
</html>

