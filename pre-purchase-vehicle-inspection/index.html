<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pre Purchase Vehicle Inspection Booking - Eek Mobile Mechanical | Mobile Mechanic NZ</title>
  <meta name="description" content="Book your pre purchase vehicle inspection with Eek Mobile Mechanical. Professional mobile mechanic service across New Zealand. 45-point certified inspection. Book online or call 0800 769 000." />
  <meta name="keywords" content="pre purchase vehicle inspection, mobile mechanic, book inspection, vehicle inspection NZ, car inspection before buying, mobile mechanic inspection, Eek Mobile Mechanical" />
  <meta property="og:title" content="Pre Purchase Vehicle Inspection Booking - Eek Mobile Mechanical" />
  <meta property="og:description" content="Book your pre purchase vehicle inspection with our professional mobile mechanics. 45-point certified inspection anywhere in NZ." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.eek.nz/prepurchase-inspection" />

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://conversions-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com; frame-src 'self' https://td.doubleclick.net https://www.googletagmanager.com;">

  <!-- Reddit Pixel -->
  <script>
    !function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}
    (window,document);
    
    rdt('init', 'a2_hf16791nsdhx');
    rdt('track', 'PageVisit');
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084465163"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17084465163');
    gtag('config', 'G-DQNKF1YLWR');
  </script>

  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0 0 80px 0;
      color: #333;
      text-align: center;
    }
    header {
      background: #ffffff;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .business-name {
      font-size: 2.2em;
      font-weight: bold;
      color: #ff5500;
      margin: 0.3em 0;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    header img {
      max-width: 250px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.8em;
      margin: 0.5em 0 0.2em;
      color: #333;
    }
    .breadcrumb {
      background: #e8f4f8;
      padding: 10px 20px;
      margin: 0;
      text-align: left;
      font-size: 0.9em;
    }
    .breadcrumb a {
      color: #ff5500;
      text-decoration: none;
    }
    .breadcrumb a:hover {
      text-decoration: underline;
    }
    .booking-container {
      max-width: 800px;
      margin: 20px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .booking-header {
      background: linear-gradient(135deg, #ff5500, #ff7733);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .booking-header h2 {
      margin: 0 0 10px 0;
      font-size: 2em;
    }
    .booking-header p {
      margin: 0;
      font-size: 1.1em;
      opacity: 0.9;
    }
    .booking-steps {
      padding: 30px;
    }
    .step {
      display: none;
      text-align: left;
    }
    .step.active {
      display: block;
    }
    .step h3 {
      color: #ff5500;
      margin-bottom: 20px;
      font-size: 1.4em;
    }
    .location-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1.1em;
      margin-bottom: 20px;
    }
    .location-input:focus {
      border-color: #ff5500;
      outline: none;
    }
    .calendar-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .calendar {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 15px;
    }
    .calendar h4 {
      margin: 0 0 15px 0;
      text-align: center;
      color: #333;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .day-header {
      text-align: center;
      font-weight: bold;
      padding: 8px 4px;
      font-size: 0.9em;
      color: #666;
    }
    .day {
      text-align: center;
      padding: 10px 4px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.9em;
      transition: all 0.2s;
    }
    .day:hover {
      background: #f0f0f0;
    }
    .day.disabled {
      color: #ccc;
      cursor: not-allowed;
    }
    .day.selected {
      background: #ff5500;
      color: white;
    }
    .day.past {
      color: #ccc;
      cursor: not-allowed;
    }
    .time-slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin: 20px 0;
    }
    .time-slot {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      position: relative;
    }
    .time-slot:hover {
      border-color: #ff5500;
    }
    .time-slot.selected {
      background: #ff5500;
      color: white;
      border-color: #ff5500;
    }
    .time-slot.limited {
      border-color: #ff9500;
      background: #fff8f0;
    }
    .time-slot .availability {
      font-size: 0.8em;
      color: #ff6600;
      margin-top: 4px;
    }
    .availability-alert {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      text-align: center;
    }
    .availability-alert.urgent {
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    .reservation-summary {
      background: #e8f4f8;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .reservation-summary h4 {
      margin: 0 0 15px 0;
      color: #333;
    }
    .summary-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }
    .summary-item strong {
      color: #ff5500;
    }
    .button {
      background: #ff5500;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1em;
      text-decoration: none;
      display: inline-block;
      transition: all 0.2s;
      margin: 10px 5px;
    }
    .button:hover {
      background: #e04400;
      transform: translateY(-1px);
    }
    .button.secondary {
      background: #6c757d;
    }
    .button.secondary:hover {
      background: #545b62;
    }
    .button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .terms-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
    }
    .terms-checkbox {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin: 15px 0;
    }
    .terms-checkbox input {
      margin-top: 4px;
      transform: scale(1.2);
    }
    .terms-text {
      font-size: 0.95em;
      line-height: 1.5;
    }
    .terms-text a {
      color: #ff5500;
      text-decoration: none;
    }
    .terms-text a:hover {
      text-decoration: underline;
    }
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      padding: 0 20px;
    }
    .progress-step {
      flex: 1;
      text-align: center;
      position: relative;
    }
    .progress-step::before {
      content: '';
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #ddd;
      display: block;
      margin: 0 auto 8px;
    }
    .progress-step.active::before {
      background: #ff5500;
    }
    .progress-step.completed::before {
      background: #28a745;
    }
    .progress-step span {
      font-size: 0.9em;
      color: #666;
    }
    .progress-step.active span {
      color: #ff5500;
      font-weight: bold;
    }
    .more-options-container {
      background: #ffffff;
      margin: 40px 20px 20px;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .more-options-header {
      margin-bottom: 30px;
    }
    
    .more-options-header h2 {
      color: #333;
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    
    .more-options-header p {
      color: #666;
      font-size: 1.1em;
      margin-bottom: 0;
    }
    
    .contact-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .contact-section {
      padding: 20px;
      border-radius: 12px;
      text-align: left;
    }
    
    .contact-section.customers {
      background: linear-gradient(135deg, #007acc, #0056b3);
      color: white;
    }
    
    .contact-section.suppliers {
      background: linear-gradient(135deg, #28a745, #1e7e34);
      color: white;
    }
    
    .contact-section.admin {
      background: linear-gradient(135deg, #6f42c1, #5a32a3);
      color: white;
    }
    
    .contact-section h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.3em;
    }
    
    .contact-section p {
      margin-bottom: 15px;
      opacity: 0.9;
      font-size: 0.95em;
    }
    
    .contact-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .contact-btn {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 0.95em;
      border: 1px solid rgba(255,255,255,0.3);
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .contact-btn:hover {
      background: rgba(255,255,255,0.25);
      border-color: rgba(255,255,255,0.5);
      transform: translateY(-1px);
    }
    
    footer {
      font-size: 0.9em;
      color: #999;
      padding: 20px 0;
      background: #f5f5f5;
    }
    
    @media (max-width: 768px) {
      .calendar-container {
        grid-template-columns: 1fr;
      }
      .booking-steps {
        padding: 20px;
      }
      .time-slots {
        grid-template-columns: repeat(2, 1fr);
      }
      .business-name {
        font-size: 1.8em;
      }
      .contact-sections {
        grid-template-columns: 1fr;
      }
      
      .more-options-container {
        margin: 20px 10px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

<header>
  <img src="lemon.png" alt="Don't buy a lemon! Eek Mobile Mechanical Pre Purchase Vehicle Inspection" />
  <div class="business-name">Eek Mobile Mechanical</div>
  <h1>Don't Buy a Lemon! Pre Purchase Vehicle Inspection</h1>
  <p style="font-size: 1.1em; color: #666; margin: 10px 0;">⚠️ Avoid costly mistakes with our professional vehicle inspection</p>
</header>

<div class="breadcrumb">
  <a href="/">Home</a> > <span>Don't Buy a Lemon - Pre Purchase Inspection</span>
</div>

<div class="booking-container">
  <div class="booking-header">
    <h2>🔍 Don't Buy a Lemon! Book Your Pre Purchase Inspection</h2>
    <p>Professional 45-point certified inspection • $199 fixed rate • Mobile service anywhere in NZ</p>
    <p style="font-size: 0.95em; opacity: 0.9; margin-top: 10px;">Protect yourself from costly hidden problems and mechanical nightmares</p>
    
    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px; margin-top: 15px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; text-align: center;">
        <div>
          <div style="font-size: 2em; font-weight: bold;">20%</div>
          <div style="font-size: 0.9em; opacity: 0.9;">of vehicles we inspect are rejected</div>
        </div>
        <div>
          <div style="font-size: 2em; font-weight: bold;">40%</div>
          <div style="font-size: 0.9em; opacity: 0.9;">of used cars have unaddressed recalls</div>
        </div>
        <div>
          <div style="font-size: 2em; font-weight: bold;">25%</div>
          <div style="font-size: 0.9em; opacity: 0.9;">have electrical system problems</div>
        </div>
        <div>
          <div style="font-size: 2em; font-weight: bold;">39%</div>
          <div style="font-size: 0.9em; opacity: 0.9;">people overpay without a report</div>
        </div>
      </div>
    </div>
  </div>

  <div class="progress-bar">
    <div class="progress-step active" id="step1-progress">
      <span>Location</span>
    </div>
    <div class="progress-step" id="step2-progress">
      <span>Date & Time</span>
    </div>
    <div class="progress-step" id="step3-progress">
      <span>Confirm</span>
    </div>
  </div>

  <div class="booking-steps">
    <!-- Step 1: Location -->
    <div class="step active" id="step1">
      <h3>Step 1: Where is the vehicle located?</h3>
      <input type="text" class="location-input" id="locationInput" placeholder="Enter address, suburb, or region (e.g. Auckland CBD, Christchurch, Wellington)" />
      <p style="color: #666; margin: 10px 0;">We service all of New Zealand. Our mobile mechanics will come to any location - dealership, private seller, or anywhere else. Don't get stuck with a lemon!</p>
      
      <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: left;">
        <h4 style="margin: 0 0 10px 0; color: #856404;">⚠️ Why You Need This Inspection:</h4>
        <ul style="margin: 0; padding-left: 20px; color: #856404;">
          <li><strong>1 in 5 vehicles</strong> we inspect have serious issues (20% rejection rate)</li>
          <li><strong>Nearly 40% of used cars</strong> have unaddressed safety recalls</li>
          <li><strong>Electrical problems</strong> are found in 25% of vehicles inspected</li>
          <li><strong>39% of buyers overpay</strong> without a professional inspection report</li>
          <li><strong>Hidden defects</strong> can cost thousands in unexpected repairs</li>
        </ul>
      </div>
      
      <button class="button" onclick="goToStep2()">Next: Select Date & Time</button>
    </div>

    <!-- Step 2: Date & Time Selection -->
    <div class="step" id="step2">
      <h3>Step 2: Select your preferred date and time</h3>
      <div id="availabilityAlert" class="availability-alert" style="display: none;"></div>
      
      <div class="calendar-container">
        <div class="calendar">
          <h4 id="currentMonth"></h4>
          <div class="calendar-grid" id="currentCalendar"></div>
        </div>
        <div class="calendar">
          <h4 id="nextMonth"></h4>
          <div class="calendar-grid" id="nextCalendar"></div>
        </div>
      </div>

      <div id="timeSlotContainer" style="display: none;">
        <h4>Available times for <span id="selectedDateDisplay"></span>:</h4>
        <div class="time-slots" id="timeSlots"></div>
      </div>

      <div style="margin: 20px 0;">
        <button class="button secondary" onclick="goToStep1()">Back</button>
        <button class="button" id="confirmTimeBtn" onclick="goToStep3()" disabled>Confirm Selection</button>
      </div>
    </div>

    <!-- Step 3: Confirmation -->
    <div class="step" id="step3">
      <h3>Step 3: Confirm your booking</h3>
      
      <div class="reservation-summary">
        <h4>🕐 Your Reserved Time Slot</h4>
        <div class="summary-item">
          <span>Service:</span>
          <strong>Don't Buy a Lemon - Pre Purchase Inspection</strong>
        </div>
        <div class="summary-item">
          <span>Location:</span>
          <strong id="summaryLocation"></strong>
        </div>
        <div class="summary-item">
          <span>Date:</span>
          <strong id="summaryDate"></strong>
        </div>
        <div class="summary-item">
          <span>Time:</span>
          <strong id="summaryTime"></strong>
        </div>
        <div class="summary-item">
          <span>Base Inspection Price:</span>
          <strong>$199</strong>
        </div>
        <div class="summary-item">
          <span>Mobile Service Fee:</span>
          <strong>$90</strong>
        </div>
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
          <div class="summary-item" style="font-size: 1.1em;">
            <span><strong>Total Price:</strong></span>
            <strong style="color: #ff5500; font-size: 1.2em;">$289</strong>
          </div>
        </div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #ff5500;">
          <div class="summary-item">
            <span style="font-size: 1.1em;">⏰ Reserved Until:</span>
            <strong style="color: #d63384;" id="reservationTimer"></strong>
          </div>
        </div>
      </div>

      <div class="terms-section">
        <h4>Terms and Conditions</h4>
        <div class="terms-checkbox">
          <input type="checkbox" id="termsAgree" />
          <div class="terms-text">
            I agree to the <a href="https://eek.nz/terms" target="_blank">Eek Mobile Mechanical Terms of Service</a> and understand that:
            <ul style="margin: 10px 0; padding-left: 20px;">
              <li>Total payment of $289 ($199 inspection + $90 mobile service fee) is required to confirm the booking</li>
              <li>The inspection includes a comprehensive 45-point mechanical assessment to avoid buying a lemon</li>
              <li>Mobile service fee covers travel time and on-site service anywhere in NZ</li>
              <li>Protect yourself from costly hidden mechanical problems - 20% of vehicles we inspect are rejected</li>
              <li>Uncover potential safety recalls (40% of used cars have unaddressed recalls)</li>
              <li>Cancellations must be made at least 24 hours in advance</li>
              <li>Our mobile mechanic will contact you 30 minutes before arrival</li>
            </ul>
          </div>
        </div>
      </div>

      <div style="text-align: center; margin: 20px 0;">
        <button class="button secondary" onclick="goToStep2()">Back to Date Selection</button>
        <br><br>
        <button class="button" id="bookOnlineBtn" onclick="bookOnline()" disabled style="font-size: 1.2em; padding: 15px 30px;">
          📅 Don't Buy a Lemon - Book Now $289
        </button>
        <br>
        <p style="margin: 15px 0; color: #666;">Or call to speak with our team:</p>
        <a href="tel:0800769000" class="button" onclick="trackConversion('prepurchase_booking_call', 'Contact')" style="background: #28a745;">
          📞 Call 0800 769 000 - Quote Total: $289
        </a>
      </div>
    </div>
  </div>
</div>

<div class="more-options-container">
  <div class="more-options-header">
    <h2>📋 More Eek Mobile Mechanical Services & Support</h2>
    <p>Looking for something else? Eek Mobile Mechanical offers comprehensive support for customers, suppliers, employment, and business partnerships.</p>
  </div>
  
  <div class="contact-sections">
    <div class="contact-section customers">
      <h3>👥 For Customers</h3>
      <p>Need mobile mechanic help or have questions about our services?</p>
      <div class="contact-buttons">
        <a href="https://forms.office.com/r/sdf0YirK6s" class="contact-btn">🚨 Emergency Mobile Mechanic Service</a>
        <a href="tel:0800769000" class="contact-btn" onclick="trackConversion('more_options_call', 'Contact')">📞 Call 0800 769 000</a>
        <a href="https://forms.office.com/r/qDtVHgBbJk" class="contact-btn">💬 Customer Support</a>
        <a href="https://form.jotform.com/251017058434047" class="contact-btn">📍 Find Me Tool</a>
      </div>
    </div>
    
    <div class="contact-section suppliers">
      <h3>🤝 For Suppliers & Partners</h3>
      <p>Join our mobile mechanic network or manage your existing partnership</p>
      <div class="contact-buttons">
        <a href="https://www.eek.nz/supplier" class="contact-btn">🤝 Official Supplier Portal</a>
        <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=vMb_Yc7Zi0WBINMhh8N3DSnleyJD3nBGm0qPafV8nlFUNE8yV1kxR0ZHQkpVMUNZMDNKUUNUTEpUUS4u" class="contact-btn">📝 Supplier Relations</a>
        <a href="https://roadandrescue.sharepoint.com/:b:/s/rar/EVItR9WqSDBHpBgS4t5JFhQBLl0heypp7-CjIRgkV-4ytg?e=bajD4c" class="contact-btn">📋 Supplier Terms</a>
      </div>
    </div>
    
    <div class="contact-section admin">
      <h3>📋 Administrative & Legal</h3>
      <p>Privacy concerns, compliance issues, or official Eek Mobile Mechanical documents</p>
      <div class="contact-buttons">
        <a href="https://www.eek.nz/mjuris" class="contact-btn">⚖️ Legal Authority</a>
        <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=vMb_Yc7Zi0WBINMhh8N3DSnleyJD3nBGm0qPafV8nlFUMzRTVVRQQVVGN0s2QjRQTUVNOEVNR1QwOC4u" class="contact-btn">🚨 Privacy Report</a>
        <a href="https://roadandrescue.sharepoint.com/:b:/s/rar/EWXiDhEQikFPtsjmoapkdWMBeytvuyMEsmlIchxhPdwyXg?e=YcldRN" class="contact-btn">🔒 Privacy Policy</a>
        <a href="https://roadandrescue.sharepoint.com/:b:/s/rar/EbMAsktroaFEkKbFZUeYxPgBm1SDkvxru4fVlG360u3i9w?e=1CDNtc" class="contact-btn">🛡️ General Terms</a>
      </div>
    </div>
  </div>
</div>

<footer>
  &copy; 2025 Eek Mobile Mechanical. All rights reserved. | 
  <a href="https://www.eek.nz/privacy" target="_blank" style="color: #666; text-decoration: underline;">Privacy Policy</a> | 
  <a href="https://www.eek.nz/more-options" style="color: #666; text-decoration: underline;">More Options</a>
</footer>

<script>
let selectedDate = null;
let selectedTime = null;
let selectedLocation = '';
let reservationExpiry = null;
let slotsRemaining = {};

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  generateCalendars();
  
  // Check if user has been here before today
  const lastVisit = localStorage.getItem('eek_last_visit');
  const today = new Date().toDateString();
  
  if (lastVisit === today) {
    // Returning visitor today - reduce slots
    const existingSlots = localStorage.getItem('eek_slots_today');
    if (existingSlots) {
      slotsRemaining = JSON.parse(existingSlots);
      // Reduce all slots by 1, minimum 1
      Object.keys(slotsRemaining).forEach(key => {
        slotsRemaining[key] = Math.max(1, slotsRemaining[key] - 1);
      });
    } else {
      // Fallback if no existing slots
      generateRandomSlots();
    }
  } else {
    // New visitor or new day - generate random slots
    generateRandomSlots();
  }
  
  localStorage.setItem('eek_last_visit', today);
  localStorage.setItem('eek_slots_today', JSON.stringify(slotsRemaining));
  
  // Update availability status AFTER generating slots
  updateAvailabilityStatus();
});

function generateRandomSlots() {
  const times = ['7:00 AM', '8:00 AM', '9:00 AM', '10:00 AM', '11:00 AM', '12:00 PM', '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM'];
  times.forEach(time => {
    slotsRemaining[time] = Math.floor(Math.random() * 4) + 1; // 1-4 slots (never 0)
  });
}

function updateAvailabilityStatus() {
  const totalSlotsToday = Object.values(slotsRemaining).reduce((a, b) => a + b, 0);
  const alertDiv = document.getElementById('availabilityAlert');
  
  if (totalSlotsToday <= 6) {
    alertDiv.style.display = 'block';
    alertDiv.className = 'availability-alert urgent';
    alertDiv.innerHTML = `⚠️ High demand today! Only ${totalSlotsToday} inspection slots remaining. Popular times book out quickly.`;
  } else {
    alertDiv.style.display = 'block';
    alertDiv.className = 'availability-alert';
    alertDiv.innerHTML = `📅 ${totalSlotsToday} inspection slots available today. Book now to secure your preferred time.`;
  }
}

function generateCalendars() {
  const now = new Date();
  const currentMonth = new Date(now.getFullYear(), now.getMonth(), 1);
  const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
  
  document.getElementById('currentMonth').textContent = currentMonth.toLocaleDateString('en-NZ', { month: 'long', year: 'numeric' });
  document.getElementById('nextMonth').textContent = nextMonth.toLocaleDateString('en-NZ', { month: 'long', year: 'numeric' });
  
  generateCalendar(currentMonth, 'currentCalendar');
  generateCalendar(nextMonth, 'nextCalendar');
}

function generateCalendar(month, containerId) {
  const container = document.getElementById(containerId);
  const now = new Date();
  
  // Create today's date more explicitly
  const todayYear = now.getFullYear();
  const todayMonth = now.getMonth();
  const todayDay = now.getDate();
  const today = new Date(todayYear, todayMonth, todayDay);
  
  const firstDay = new Date(month.getFullYear(), month.getMonth(), 1);
  const lastDay = new Date(month.getFullYear(), month.getMonth() + 1, 0);
  
  console.log('Current time:', now);
  console.log('Today (midnight):', today);
  console.log('Today values:', todayYear, todayMonth, todayDay);
  
  // Clear container
  container.innerHTML = '';
  
  // Add day headers
  const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  dayHeaders.forEach(day => {
    const header = document.createElement('div');
    header.className = 'day-header';
    header.textContent = day;
    container.appendChild(header);
  });
  
  // Add empty cells for days before the first day of the month
  for (let i = 0; i < firstDay.getDay(); i++) {
    const emptyDay = document.createElement('div');
    emptyDay.className = 'day disabled';
    container.appendChild(emptyDay);
  }
  
  // Add days of the month
  for (let day = 1; day <= lastDay.getDate(); day++) {
    const dayElement = document.createElement('div');
    const dayDate = new Date(month.getFullYear(), month.getMonth(), day);
    
    dayElement.className = 'day';
    dayElement.textContent = day;
    
    // Debug logging for the problematic date
    if (day === 24) {
      console.log('Day 24 date:', dayDate);
      console.log('Day 24 < today?', dayDate.getTime() < today.getTime());
      console.log('Day 24 === today?', dayDate.getTime() === today.getTime());
      console.log('Day 24 is Sunday?', dayDate.getDay() === 0);
    }
    
    // Disable past dates (before today) and Sundays
    if (dayDate.getTime() < today.getTime() || dayDate.getDay() === 0) {
      dayElement.className += ' past';
    } else {
      dayElement.onclick = () => selectDate(dayDate);
    }
    
    container.appendChild(dayElement);
  }
}

function selectDate(date) {
  // Remove previous selections
  document.querySelectorAll('.day.selected').forEach(el => el.classList.remove('selected'));
  
  // Add selection to clicked date
  event.target.classList.add('selected');
  
  selectedDate = date;
  document.getElementById('selectedDateDisplay').textContent = date.toLocaleDateString('en-NZ', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  generateTimeSlots();
  document.getElementById('timeSlotContainer').style.display = 'block';
}

function generateTimeSlots() {
  const container = document.getElementById('timeSlots');
  container.innerHTML = '';
  
  const times = ['7:00 AM', '8:00 AM', '9:00 AM', '10:00 AM', '11:00 AM', '12:00 PM', '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM'];
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const isToday = selectedDate.getTime() === today.getTime();
  
  times.forEach(time => {
    const slot = document.createElement('div');
    slot.className = 'time-slot';
    
    // Check if this time slot is within 2 hours from now (only for today)
    let isWithinTwoHours = false;
    if (isToday) {
      // Parse the time string to get hour
      const timeStr = time.replace(' AM', '').replace(' PM', '');
      let [hours, minutes] = timeStr.split(':').map(Number);
      
      // Convert to 24-hour format
      if (time.includes('PM') && hours !== 12) {
        hours += 12;
      } else if (time.includes('AM') && hours === 12) {
        hours = 0;
      }
      
      // Create a date object for this time slot today
      const slotTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes || 0);
      const twoHoursFromNow = new Date(now.getTime() + (2 * 60 * 60 * 1000));
      
      isWithinTwoHours = slotTime < twoHoursFromNow;
    }
    
    const remaining = slotsRemaining[time] || 1;
    
    if (remaining <= 2) {
      slot.classList.add('limited');
    }
    
    if (isWithinTwoHours) {
      slot.classList.add('past'); // Reuse the 'past' styling
      slot.style.cursor = 'not-allowed';
      slot.innerHTML = `
        <div>${time}</div>
        <div class="availability">Too soon</div>
      `;
    } else {
      slot.innerHTML = `
        <div>${time}</div>
        <div class="availability">${remaining} slot${remaining === 1 ? '' : 's'} left</div>
      `;
      slot.onclick = () => selectTime(time, slot);
    }
    
    container.appendChild(slot);
  });
}

function selectTime(time, element) {
  // Remove previous selections
  document.querySelectorAll('.time-slot.selected').forEach(el => el.classList.remove('selected'));
  
  // Add selection
  element.classList.add('selected');
  selectedTime = time;
  
  // Start reservation timer (10 minutes)
  reservationExpiry = new Date(Date.now() + 10 * 60 * 1000);
  
  document.getElementById('confirmTimeBtn').disabled = false;
}

function goToStep1() {
  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  document.getElementById('step1').classList.add('active');
  
  document.querySelectorAll('.progress-step').forEach(el => {
    el.classList.remove('active', 'completed');
  });
  document.getElementById('step1-progress').classList.add('active');
}

function goToStep2() {
  selectedLocation = document.getElementById('locationInput').value.trim();
  
  if (!selectedLocation) {
    alert('Please enter the vehicle location');
    return;
  }
  
  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  document.getElementById('step2').classList.add('active');
  
  document.getElementById('step1-progress').classList.add('completed');
  document.getElementById('step1-progress').classList.remove('active');
  document.getElementById('step2-progress').classList.add('active');
}

function goToStep3() {
  if (!selectedDate || !selectedTime) {
    alert('Please select a date and time');
    return;
  }
  
  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  document.getElementById('step3').classList.add('active');
  
  document.getElementById('step2-progress').classList.add('completed');
  document.getElementById('step2-progress').classList.remove('active');
  document.getElementById('step3-progress').classList.add('active');
  
  // Update summary
  document.getElementById('summaryLocation').textContent = selectedLocation;
  document.getElementById('summaryDate').textContent = selectedDate.toLocaleDateString('en-NZ', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  document.getElementById('summaryTime').textContent = selectedTime;
  
  // Start countdown timer
  startReservationTimer();
  
  // Enable terms checkbox functionality
  document.getElementById('termsAgree').onchange = function() {
    document.getElementById('bookOnlineBtn').disabled = !this.checked;
  };
}

function startReservationTimer() {
  const timerElement = document.getElementById('reservationTimer');
  
  function updateTimer() {
    const now = new Date();
    const timeLeft = reservationExpiry - now;
    
    if (timeLeft <= 0) {
      timerElement.textContent = 'Expired';
      timerElement.style.color = '#dc3545';
      return;
    }
    
    const minutes = Math.floor(timeLeft / 60000);
    const seconds = Math.floor((timeLeft % 60000) / 1000);
    
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (timeLeft < 2 * 60 * 1000) { // Less than 2 minutes
      timerElement.style.color = '#dc3545';
    }
  }
  
  updateTimer();
  const interval = setInterval(updateTimer, 1000);
  
  setTimeout(() => {
    clearInterval(interval);
  }, 10 * 60 * 1000);
}

function bookOnline() {
  // Track the booking attempt
  if (typeof gtag !== 'undefined') {
    gtag('event', 'prepurchase_booking_online', {
      'event_category': 'Booking',
      'event_label': 'Online Booking Click',
      'value': 289
    });
  }
  
  if (typeof rdt !== 'undefined') {
    rdt('track', 'Lead', {
      'customEventName': 'Prepurchase_Booking_Online',
      'value': 28900,
      'currency': 'NZD'
    });
  }
  
  // Redirect to booking link
  window.open('https://www.eek.nz/book-inspection', '_blank');
}

function trackConversion(eventAction, eventCategory) {
  if (typeof gtag !== 'undefined') {
    gtag('event', eventAction, {
      'event_category': eventCategory,
      'event_label': 'Phone Call Click',
      'value': 289
    });
    gtag('event', 'conversion', {
      'send_to': 'AW-17084465163/7Mh8CKFRydsaEIuAwJI_'
    });
  }
  
  if (typeof rdt !== 'undefined') {
    rdt('track', 'Lead', {
      'customEventName': 'Phone_Call_Click',
      'value': 28900,
      'currency': 'NZD',
      'serviceType': 'Pre-Purchase Inspection'
    });
  }
}
</script>

</body>
</html>
