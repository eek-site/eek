concat(
  coalesce(body('Parse_JSON')?['bookingStatus'], body('Parse_JSON')?['eventType'], 'NEW'), 
  ' | ', 
  coalesce(body('Parse_JSON')?['visitorData']?['location'], body('Parse_JSON')?['location'], 'Unknown'), 
  ' | ', 
  coalesce(body('Parse_JSON')?['visitorData']?['vehicleRego'], body('Parse_JSON')?['vehicleRego'], 'No Rego'), 
  ' | ', 
  coalesce(body('Parse_JSON')?['visitorData']?['serviceCode'], body('Parse_JSON')?['serviceCode'], body('Parse_JSON')?['visitorData']?['service'], body('Parse_JSON')?['serviceTitle'], 'Service'), 
  ' | ', 
  coalesce(body('Parse_JSON')?['pageSource']?['type'], 'Direct'), 
  ' | ',
  if(and(not(empty(body('Parse_JSON')?['visitorData']?['name'])), not(equals(string(body('Parse_JSON')?['visitorData']?['name']), ''))), 
    concat(substring(body('Parse_JSON')?['visitorData']?['name'], 0, 10), ' | '), 
    if(and(not(empty(body('Parse_JSON')?['name'])), not(equals(string(body('Parse_JSON')?['name']), ''))), 
      concat(substring(body('Parse_JSON')?['name'], 0, 10), ' | '), 
      ''
    )
  ),
  if(and(not(empty(body('Parse_JSON')?['journeyData']?['callAttemptId'])), not(equals(string(body('Parse_JSON')?['journeyData']?['callAttemptId']), ''))), 
    'CALL | ', 
    ''
  ),
  formatDateTime(utcNow(), 'HH:mm')
)

<!-- ========================================== -->
<!-- SUBJECT LINE ENDS - HTML BODY BEGINS -->
<!-- ========================================== -->

<table cellpadding="0" cellspacing="0" border="0" style="max-width: 600px; margin: 0 auto; background-color: #ffffff; width: 100%;">
<tbody>
<tr>
<td style="display: none; max-height: 0px; overflow: hidden; opacity: 0; visibility: hidden; mso-hide: all;">
@{if(and(not(empty(body('Parse_JSON')?['utm']?['campaign'])), not(equals(string(body('Parse_JSON')?['utm']?['campaign']), ''))), concat('Campaign: ', body('Parse_JSON')?['utm']?['campaign'], ' | '), '')}
@{if(and(not(empty(body('Parse_JSON')?['utm']?['term'])), not(equals(string(body('Parse_JSON')?['utm']?['term']), ''))), concat('Keyword: ', body('Parse_JSON')?['utm']?['term'], ' | '), '')}
@{if(and(not(empty(body('Parse_JSON')?['device']?['platform'])), not(equals(string(body('Parse_JSON')?['device']?['platform']), ''))), concat(body('Parse_JSON')?['device']?['platform'], ' | '), '')}
@{if(and(not(empty(body('Parse_JSON')?['matchType'])), not(equals(string(body('Parse_JSON')?['matchType']), ''))), concat('Match: ', body('Parse_JSON')?['matchType'], ' | '), '')}
@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['name'])), not(equals(string(body('Parse_JSON')?['visitorData']?['name']), ''))), concat(body('Parse_JSON')?['visitorData']?['name'], ' | '), if(and(not(empty(body('Parse_JSON')?['name'])), not(equals(string(body('Parse_JSON')?['name']), ''))), concat(body('Parse_JSON')?['name'], ' | '), ''))}
@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['phone'])), not(equals(string(body('Parse_JSON')?['visitorData']?['phone']), ''))), body('Parse_JSON')?['visitorData']?['phone'], if(and(not(empty(body('Parse_JSON')?['phone'])), not(equals(string(body('Parse_JSON')?['phone']), ''))), body('Parse_JSON')?['phone'], ''))}
@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['email'])), not(equals(string(body('Parse_JSON')?['visitorData']?['email']), ''))), concat(' | Email: ', body('Parse_JSON')?['visitorData']?['email']), if(and(not(empty(body('Parse_JSON')?['email'])), not(equals(string(body('Parse_JSON')?['email']), ''))), concat(' | Email: ', body('Parse_JSON')?['email']), ''))}
@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['vehicleRego'])), not(equals(string(body('Parse_JSON')?['visitorData']?['vehicleRego']), ''))), concat(' | Rego: ', body('Parse_JSON')?['visitorData']?['vehicleRego']), if(and(not(empty(body('Parse_JSON')?['vehicleRego'])), not(equals(string(body('Parse_JSON')?['vehicleRego']), ''))), concat(' | Rego: ', body('Parse_JSON')?['vehicleRego']), ''))}
@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['service'])), not(equals(string(body('Parse_JSON')?['visitorData']?['service']), ''))), concat(' | Service: ', body('Parse_JSON')?['visitorData']?['service']), if(and(not(empty(body('Parse_JSON')?['serviceTitle'])), not(equals(string(body('Parse_JSON')?['serviceTitle']), ''))), concat(' | Service: ', body('Parse_JSON')?['serviceTitle']), ''))}
@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['location'])), not(equals(string(body('Parse_JSON')?['visitorData']?['location']), ''))), concat(' | Location: ', body('Parse_JSON')?['visitorData']?['location']), if(and(not(empty(body('Parse_JSON')?['location'])), not(equals(string(body('Parse_JSON')?['location']), ''))), concat(' | Location: ', body('Parse_JSON')?['location']), if(and(not(empty(body('Parse_JSON')?['trackingData']?['location']?['city'])), not(equals(string(body('Parse_JSON')?['trackingData']?['location']?['city']), ''))), concat(' | Location: ', body('Parse_JSON')?['trackingData']?['location']?['city']), '')))}
@{if(and(not(empty(body('Parse_JSON')?['journeyData']?['callAttemptId'])), not(equals(string(body('Parse_JSON')?['journeyData']?['callAttemptId']), ''))), concat(' | Call ID: ', body('Parse_JSON')?['journeyData']?['callAttemptId']), '')}
@{if(and(not(empty(body('Parse_JSON')?['eventAction'])), not(equals(string(body('Parse_JSON')?['eventAction']), ''))), concat(' | Action: ', body('Parse_JSON')?['eventAction']), '')}
@{if(and(not(empty(body('Parse_JSON')?['gclid'])), not(equals(string(body('Parse_JSON')?['gclid']), ''))), concat(' | GCLID: ', body('Parse_JSON')?['gclid']), '')}
@{if(and(not(empty(body('Parse_JSON')?['sessionId'])), not(equals(string(body('Parse_JSON')?['sessionId']), ''))), concat(' | Session: ', substring(body('Parse_JSON')?['sessionId'], 0, 8), '...'), '')}
</td>
</tr>
<tr>
<td style="padding: 15px; text-align: center; background-color: #ff5500; color: white;">
<h1 style="margin: 0 0 8px 0; font-size: 20px;">Eek Mobile Mechanical</h1>
<h2 style="margin: 0 0 5px 0; font-size: 16px; font-weight: normal;">@{coalesce(body('Parse_JSON')?['serviceTitle'], body('Parse_JSON')?['eventType'], 'Notification')}</h2>
<div style="font-size: 14px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">@{coalesce(body('Parse_JSON')?['bookingStatus'], body('Parse_JSON')?['eventType'], 'NEW')}</div>
</td>
</tr>
<tr>
<td style="padding: 12px 15px; background-color: #e3f2fd; border-left: 4px solid #ff5500;">
<div style="margin-bottom: 6px; font-size: 13px;"><strong>Session:</strong> @{coalesce(body('Parse_JSON')?['sessionId'], 'Unknown')}</div>
<div style="margin-bottom: 6px; font-size: 13px;"><strong>GCLID:</strong> @{coalesce(body('Parse_JSON')?['gclid'], body('Parse_JSON')?['pageSource']?['clickIds']?['gclid'], 'None')}</div>
<div style="margin-bottom: 6px; font-size: 13px;"><strong>GCLID State:</strong> <span style="padding: 2px 6px; background-color: @{if(equals(coalesce(body('Parse_JSON')?['gclidState'], ''), 'Active'), '#28a745', '#6c757d')}; color: white; border-radius: 3px; font-size: 11px;">@{coalesce(body('Parse_JSON')?['gclidState'], 'Unknown')}</span></div>
<div style="margin-bottom: 6px; font-size: 13px;"><strong>Page Source:</strong> @{coalesce(body('Parse_JSON')?['pageSource']?['type'], 'Direct')} - @{coalesce(body('Parse_JSON')?['pageSource']?['detail'], 'Direct visit')}</div>
<div style="margin-bottom: 6px; font-size: 13px;"><strong>Event Type:</strong> @{coalesce(body('Parse_JSON')?['eventType'], 'Unknown')}</div>
<div style="margin-bottom: 6px; font-size: 13px;"><strong>Event Action:</strong> @{coalesce(body('Parse_JSON')?['eventAction'], 'Unknown')}</div>
<div style="font-size: 13px;"><strong>Time:</strong> @{formatDateTime(coalesce(body('Parse_JSON')?['timestamp'], utcNow()), 'dd/MM/yyyy HH:mm')}</div>
</td>
</tr>

<!-- Call Correlation Section -->
<tr>
<td style="padding: 0 15px 15px 15px;">
<table cellpadding="0" cellspacing="0" border="0" style="background-color: #fff8e1; border: 1px solid #ffcc02; padding: 12px; width: 100%;">
<tbody>
<tr>
<td style="font-size: 15px; font-weight: bold; color: #333; padding-bottom: 8px; border-bottom: 2px solid #ffcc02;">📞 Call Correlation</td>
</tr>
<tr>
<td style="padding: 8px 0;">
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Call Attempt ID:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['journeyData']?['callAttemptId'], body('Parse_JSON')?['callAttemptId'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Call Timestamp:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['journeyData']?['callTimestamp'])), not(equals(string(body('Parse_JSON')?['journeyData']?['callTimestamp']), ''))), formatDateTime(body('Parse_JSON')?['journeyData']?['callTimestamp'], 'dd/MM/yyyy HH:mm'), if(and(not(empty(body('Parse_JSON')?['callTimestamp'])), not(equals(string(body('Parse_JSON')?['callTimestamp']), ''))), formatDateTime(body('Parse_JSON')?['callTimestamp'], 'dd/MM/yyyy HH:mm'), '-'))}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Return Timestamp:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['journeyData']?['returnTimestamp'])), not(equals(string(body('Parse_JSON')?['journeyData']?['returnTimestamp']), ''))), formatDateTime(body('Parse_JSON')?['journeyData']?['returnTimestamp'], 'dd/MM/yyyy HH:mm'), '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Time Between Call &amp; Return:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['journeyData']?['timeBetweenCallAndReturn'])), not(equals(body('Parse_JSON')?['journeyData']?['timeBetweenCallAndReturn'], 0))), concat(div(body('Parse_JSON')?['journeyData']?['timeBetweenCallAndReturn'], 60000), ' minutes'), '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Return Source:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['journeyData']?['source'], '-')}</span></div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>

<tr>
<td style="padding: 15px;">
<table cellpadding="0" cellspacing="0" border="0" style="background-color: #f8f9fa; padding: 12px; width: 100%;">
<tbody>
<tr>
<td style="font-size: 15px; font-weight: bold; color: #333; padding-bottom: 8px; border-bottom: 2px solid #e9ecef;">Details</td>
</tr>
<tr>
<td style="padding: 8px 0;">
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Name:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['name'], body('Parse_JSON')?['name'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Phone:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['phone'], body('Parse_JSON')?['phone'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Email:</strong> <span style="color: #333; word-break: break-all;">@{coalesce(body('Parse_JSON')?['visitorData']?['email'], body('Parse_JSON')?['email'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Location:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['visitorData']?['location'])), not(equals(string(body('Parse_JSON')?['visitorData']?['location']), ''))), body('Parse_JSON')?['visitorData']?['location'], if(and(not(empty(body('Parse_JSON')?['location'])), not(equals(string(body('Parse_JSON')?['location']), ''))), body('Parse_JSON')?['location'], '-'))</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Rego:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['vehicleRego'], body('Parse_JSON')?['vehicleRego'], body('Parse_JSON')?['rego'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Vehicle:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['vehicleYear'], body('Parse_JSON')?['vehicleYear'], '')} @{coalesce(body('Parse_JSON')?['visitorData']?['vehicleMake'], body('Parse_JSON')?['vehicleMake'], body('Parse_JSON')?['make'], '')} @{coalesce(body('Parse_JSON')?['visitorData']?['vehicleModel'], body('Parse_JSON')?['vehicleModel'], body('Parse_JSON')?['model'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Service:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['service'], body('Parse_JSON')?['serviceTitle'], body('Parse_JSON')?['service'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Service Code:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['serviceCode'], body('Parse_JSON')?['serviceCode'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Price:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['basePrice'])), not(equals(body('Parse_JSON')?['basePrice'], 0))), concat('$', body('Parse_JSON')?['basePrice']), if(and(not(empty(body('Parse_JSON')?['price'])), not(equals(body('Parse_JSON')?['price'], 0))), concat('$', body('Parse_JSON')?['price']), '-'))}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Battery Voltage:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['batteryVoltage'], body('Parse_JSON')?['batteryVoltage'], body('Parse_JSON')?['selectedVoltage'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Vehicle Type:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['visitorData']?['vehicleType'], body('Parse_JSON')?['vehicleType'], '-')}</span></div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr>
<td style="padding: 0 15px 15px 15px;">
<table cellpadding="0" cellspacing="0" border="0" style="background-color: #fff9c4; border: 1px solid #fff176; padding: 12px; width: 100%;">
<tbody>
<tr>
<td style="font-size: 15px; font-weight: bold; color: #333; padding-bottom: 8px; border-bottom: 2px solid #fff176;">📋 Booking Progress</td>
</tr>
<tr>
<td style="padding: 8px 0;">
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Current Step:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['currentStep'], '-')} of @{coalesce(body('Parse_JSON')?['totalSteps'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Progress:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['stepProgress'], '0')}%</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Terms Accepted:</strong> <span style="color: #333;">@{if(equals(coalesce(body('Parse_JSON')?['termsAccepted'], false), true), '✅ Yes', '❌ No')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Marketing Consent:</strong> <span style="color: #333;">@{if(equals(coalesce(body('Parse_JSON')?['marketingConsent'], false), true), '✅ Yes', '❌ No')}</span></div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr>
<td style="padding: 0 15px 15px 15px;">
<table cellpadding="0" cellspacing="0" border="0" style="background-color: #f3e5f5; border: 1px solid #ce93d8; padding: 12px; width: 100%;">
<tbody>
<tr>
<td style="font-size: 15px; font-weight: bold; color: #333; padding-bottom: 8px; border-bottom: 2px solid #ce93d8;">📱 Device &amp; Engagement</td>
</tr>
<tr>
<td style="padding: 8px 0;">
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Screen Resolution:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['device']?['screenResolution'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Viewport Size:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['device']?['viewportSize'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Language:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['device']?['language'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Timezone:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['device']?['timezone'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Time on Page:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['engagement']?['timeOnPage'], '0')} seconds</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Scroll Depth:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['engagement']?['scrollDepth'], '0')}%</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Total Clicks:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['engagement']?['clicks'], '0')}</span></div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>

<!-- Visitor Journey Section -->
<tr>
<td style="padding: 0 15px 15px 15px;">
<table cellpadding="0" cellspacing="0" border="0" style="background-color: #e1f5fe; border: 1px solid #4fc3f7; padding: 12px; width: 100%;">
<tbody>
<tr>
<td style="font-size: 15px; font-weight: bold; color: #333; padding-bottom: 8px; border-bottom: 2px solid #4fc3f7;">🛣️ Visitor Journey</td>
</tr>
<tr>
<td style="padding: 8px 0;">
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Entry Page:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['userJourney']?['entryPage'], body('Parse_JSON')?['pageUrl'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Previous Page:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['userJourney']?['previousPage'], body('Parse_JSON')?['pageSource']?['referrer'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Total Pages:</strong> <span style="color: #333;">@{coalesce(string(body('Parse_JSON')?['userJourney']?['totalPages']), '1')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Session Duration:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['userJourney']?['sessionDuration'])), not(equals(body('Parse_JSON')?['userJourney']?['sessionDuration'], 0))), concat(div(body('Parse_JSON')?['userJourney']?['sessionDuration'], 60000), ' minutes'), '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Journey Actions:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['eventAction'], '-')}</span></div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>

<tr>
<td style="padding: 0 15px 15px 15px;">
<table cellpadding="0" cellspacing="0" border="0" style="background-color: #e8f5e8; border: 1px solid #a5d6a7; padding: 12px; width: 100%;">
<tbody>
<tr>
<td style="font-size: 15px; font-weight: bold; color: #333; padding-bottom: 8px; border-bottom: 2px solid #a5d6a7;">📍 Location Details</td>
</tr>
<tr>
<td style="padding: 8px 0;">
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Country:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['trackingData']?['location']?['country'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Region:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['trackingData']?['location']?['region'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">City:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['trackingData']?['location']?['city'], '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Coordinates:</strong> <span style="color: #333;">@{if(and(not(empty(body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['latitude'])), not(empty(body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['longitude']))), concat('<a href="https://www.google.com/maps/place/', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['latitude'], ',', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['longitude'], '/@', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['latitude'], ',', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['longitude'], ',17z/data=!3m1!4b1!4m4!3m3!8m2!3d', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['latitude'], '!4d', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['longitude'], '?entry=ttu&g_ep=EgoyMDI1MTAxNC4wIKXMDSoASAFQAw%3D%3D" style="color: #007bff; text-decoration: none;">', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['latitude'], ', ', body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['longitude'], '</a>'), '-')}</span></div>
<div style="padding: 4px 0; font-size: 13px;"><strong style="color: #555;">Accuracy:</strong> <span style="color: #333;">@{coalesce(body('Parse_JSON')?['trackingData']?['location']?['coordinates']?['accuracy'], '-')}</span></div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr>
<td style="padding: 0 15px 15px 15px;">
<a href="tel:@{coalesce(body('Parse_JSON')?['visitorData']?['phone'], body('Parse_JSON')?['phone'], '0800769000')}" style="display: block; padding: 12px; margin: 5px 0; background-color: #28a745; color: white; text-decoration: none; font-weight: bold; font-size: 14px; border-radius: 5px; text-align: center;">📞 Call Customer</a>
<a href="mailto:@{coalesce(body('Parse_JSON')?['visitorData']?['email'], body('Parse_JSON')?['email'], 'no-reply@eek.nz')}" style="display: block; padding: 12px; margin: 5px 0; background-color: #17a2b8; color: white; text-decoration: none; font-weight: bold; font-size: 14px; border-radius: 5px; text-align: center;">✉️ Email Customer</a>
<a href="https://www.carjam.co.nz/car/?plate=@{coalesce(body('Parse_JSON')?['visitorData']?['vehicleRego'], body('Parse_JSON')?['vehicleRego'], 'UNKNOWN')}" style="display: block; padding: 12px; margin: 5px 0; background-color: #6c757d; color: white; text-decoration: none; font-weight: bold; font-size: 14px; border-radius: 5px; text-align: center;">🚗 CarJam Lookup</a>
</td>
</tr>
<tr>
<td style="background-color: #333; color: #fff; padding: 15px; text-align: center; font-size: 11px;">
<strong>Eek Mobile Mechanical</strong><br>@{formatDateTime(utcNow(), 'dd/MM/yyyy HH:mm')}
</td>
</tr>
</tbody>
</table>
