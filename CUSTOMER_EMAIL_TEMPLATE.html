<!-- Customer-Facing Email Template - Payment Confirmed -->
<!-- Copy this entire template into your Power Automate Send an Email action -->

<meta>
<title>Your Eek Mobile Mechanical Service - Payment Confirmed</title>

<!-- Preheader Text -->
<div style="display:none;max-height:0px;overflow:hidden;">
@{coalesce(triggerBody()?['body']?['name'], triggerBody()?['name'], 'Customer')} - @{coalesce(triggerBody()?['body']?['serviceTitle'], triggerBody()?['serviceTitle'], 'Service')} confirmed for @{if(empty(coalesce(triggerBody()?['body']?['rego'], triggerBody()?['rego'], triggerBody()?['body']?['vehicleRego'], triggerBody()?['vehicleRego'])), 'your vehicle', toUpper(replace(trim(coalesce(triggerBody()?['body']?['rego'], triggerBody()?['rego'], triggerBody()?['body']?['vehicleRego'], triggerBody()?['vehicleRego'], '')), ' ', '')))} at @{coalesce(triggerBody()?['body']?['location'], triggerBody()?['location'], triggerBody()?['body']?['visitorData']?['location']?['address'], triggerBody()?['body']?['visitorData']?['location']?['city'], 'your location')} ‚Ä¢ $@{coalesce(triggerBody()?['body']?['price'], triggerBody()?['price'], '0')} ‚Ä¢ @{coalesce(triggerBody()?['body']?['timeWindow'], triggerBody()?['timeWindow'], triggerBody()?['body']?['urgencyLevel'], triggerBody()?['urgencyLevel'], 'Standard')} ‚Ä¢ Payment Confirmed ‚úÖ
</div>

<!-- Hidden Tracking Information -->
@{if(not(equals(coalesce(triggerBody()?['body']?['trackingData'], triggerBody()?['trackingData']), null)), concat('<div style="display: none; max-height: 0px; overflow: hidden; opacity: 0; visibility: hidden; mso-hide: all;">TRACKING: GCLID=', coalesce(triggerBody()?['body']?['trackingData']?['gclid'], triggerBody()?['trackingData']?['gclid'], 'None'), ' | Campaign=', coalesce(triggerBody()?['body']?['trackingData']?['utm']?['campaign'], triggerBody()?['trackingData']?['utm']?['campaign'], 'None'), ' | Device=', coalesce(triggerBody()?['body']?['trackingData']?['device']?['platform'], triggerBody()?['trackingData']?['device']?['platform'], 'Unknown'), ' | Location=', coalesce(triggerBody()?['body']?['trackingData']?['location']?['city'], triggerBody()?['trackingData']?['location']?['city'], 'Unknown'), ' | Session=', coalesce(triggerBody()?['body']?['sessionId'], triggerBody()?['sessionId'], 'Unknown'), ' | CallID=', coalesce(triggerBody()?['body']?['trackingData']?['journeyData']?['callAttemptId'], triggerBody()?['trackingData']?['journeyData']?['callAttemptId'], 'None'), '</div>'), '')}

<!-- Scheduling Information (conditional) -->
@{if(equals(coalesce(triggerBody()?['body']?['service'], triggerBody()?['service'], ''), 'inspection'), 
    concat('<table cellpadding="0" cellspacing="0" border="0" style="max-width: 600px; margin: 0 auto; background-color: #ffffff; font-family: Arial, sans-serif;"><tbody><tr><td style="padding: 20px 20px 0 20px;"><div style="background: #d1ecf1; border: 1px solid #17a2b8; padding: 20px; border-radius: 8px;"><strong style="font-size: 16px; color: #0c5460;">üìÖ Inspection Scheduled:</strong><br><span style="color: #333; font-size: 15px; line-height: 1.8;">', coalesce(triggerBody()?['body']?['scheduledDate'], triggerBody()?['scheduledDate'], 'TBD'), ' - ', coalesce(triggerBody()?['body']?['timeWindow'], triggerBody()?['timeWindow'], 'TBD'), '</span><br><br><strong style="font-size: 16px; color: #0c5460;">Seller:</strong> <span style="color: #333; font-size: 15px;">', coalesce(triggerBody()?['body']?['sellerName'], triggerBody()?['sellerName'], 'Not provided'), ' (', coalesce(triggerBody()?['body']?['sellerPhone'], triggerBody()?['sellerPhone'], 'Not provided'), ')</span></div></td></tr></tbody></table>'),
    concat('<table cellpadding="0" cellspacing="0" border="0" style="max-width: 600px; margin: 0 auto; background-color: #ffffff; font-family: Arial, sans-serif;"><tbody><tr><td style="padding: 20px 20px 0 20px;"><div style="background: ', if(equals(coalesce(triggerBody()?['body']?['urgencyLevel'], triggerBody()?['urgencyLevel'], 'standard'), 'emergency'), '#ffebee; border: 1px solid #f44336;', '#e8f5e9; border: 1px solid #4caf50;'), ' padding: 20px; border-radius: 8px;"><strong style="font-size: 16px; color: ', if(equals(coalesce(triggerBody()?['body']?['urgencyLevel'], triggerBody()?['urgencyLevel'], 'standard'), 'emergency'), '#c62828;', '#2e7d32;'), ';">‚è∞ Scheduled:</strong><br><span style="color: #333; font-size: 15px; line-height: 1.8;">', coalesce(triggerBody()?['body']?['timeWindow'], triggerBody()?['timeWindow'], 'TBD'), ' - ', coalesce(triggerBody()?['body']?['urgencyLevel'], triggerBody()?['urgencyLevel'], 'Standard'), '</span></div></td></tr></tbody></table>'))}

<!-- Main Email Content -->
<table cellpadding="0" cellspacing="0" border="0" style="max-width: 600px; margin: 0 auto; background-color: #ffffff; font-family: Arial, sans-serif; border-radius: 8px; overflow: hidden;">
    <tbody>
        <!-- Header Section -->
        <tr>
            <td style="padding: 40px 30px; text-align: center; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white;">
                <div style="font-size: 56px; margin-bottom: 20px;">üîß</div>
                <h1 style="margin: 0 0 12px 0; font-size: 28px; font-weight: 600; letter-spacing: -0.5px;">Your Service is Confirmed!</h1>
                <h2 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 400; opacity: 0.95;">@{coalesce(triggerBody()?['body']?['serviceTitle'], triggerBody()?['serviceTitle'], 'Mobile Mechanic Service')}</h2>
                <div style="display: inline-block; background: white; color: #27ae60; padding: 10px 24px; border-radius: 25px; font-weight: bold; font-size: 14px; letter-spacing: 1px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    ‚úÖ PAYMENT CONFIRMED
                </div>
            </td>
        </tr>

        <!-- Greeting Section -->
        <tr>
            <td style="padding: 30px 30px 20px 30px; background-color: #ffffff;">
                <div style="font-size: 18px; color: #2c3e50; line-height: 1.7;">
                    Hi <strong style="color: #27ae60;">@{coalesce(triggerBody()?['body']?['name'], triggerBody()?['name'], 'there')}</strong>,
                    <br><br>
                    Thanks for completing your booking and payment with Eek Mechanical.
                    <br><br>
                    <strong style="color: #27ae60; font-size: 19px;">Your mechanical service request has been received. Help is officially on the way.</strong>
                </div>
            </td>
        </tr>

        <!-- Job Summary Section -->
        <tr>
            <td style="padding: 0 30px 20px 30px;">
                <div style="background: #f8f9fa; padding: 14px 20px; margin: 0 0 20px 0; border-left: 4px solid #2ecc71; font-weight: bold; font-size: 17px; color: #2c3e50; border-radius: 4px 0 0 4px;">
                    üîé JOB SUMMARY
                </div>
                <table cellpadding="0" cellspacing="0" border="0" style="background-color: #f8f9fa; padding: 25px; border-radius: 8px; width: 100%; border: 1px solid #e9ecef;">
                    <tbody>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #e9ecef; vertical-align: top;">Client:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #e9ecef;">@{coalesce(triggerBody()?['body']?['name'], triggerBody()?['name'], 'Not provided')}</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #e9ecef; vertical-align: top;">Email:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #e9ecef;"><a href="mailto:@{coalesce(triggerBody()?['body']?['email'], triggerBody()?['email'], '')}" style="color: #007bff; text-decoration: none;">@{coalesce(triggerBody()?['body']?['email'], triggerBody()?['email'], 'Not provided')}</a></td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #e9ecef; vertical-align: top;">Phone:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #e9ecef;"><a href="tel:@{coalesce(triggerBody()?['body']?['phone'], triggerBody()?['phone'], '')}" style="color: #007bff; text-decoration: none;">@{coalesce(triggerBody()?['body']?['phone'], triggerBody()?['phone'], 'Not provided')}</a></td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #e9ecef; vertical-align: top;">Location:</td>
                            <td style="color: #2c3e50; font-size: 15px; font-weight: bold; padding: 12px 0; border-bottom: 1px solid #e9ecef;">@{coalesce(triggerBody()?['body']?['location'], triggerBody()?['location'], triggerBody()?['body']?['visitorData']?['location']?['address'], triggerBody()?['body']?['visitorData']?['location']?['city'], 'Not provided')}</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #e9ecef; vertical-align: top;">Service Required:</td>
                            <td style="color: #2c3e50; font-size: 15px; font-weight: bold; padding: 12px 0; border-bottom: 1px solid #e9ecef;">@{coalesce(triggerBody()?['body']?['serviceTitle'], triggerBody()?['serviceTitle'], 'Mobile Mechanic Service')}</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; vertical-align: top;">Issue Reported:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0; line-height: 1.6;">@{coalesce(triggerBody()?['body']?['details'], triggerBody()?['details'], 'No additional details provided')}</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>

        <!-- Vehicle Information -->
        <tr>
            <td style="padding: 0 30px 20px 30px;">
                <div style="background: #f8f9fa; padding: 14px 20px; margin: 0 0 20px 0; border-left: 4px solid #2ecc71; font-weight: bold; font-size: 17px; color: #2c3e50; border-radius: 4px 0 0 4px;">
                    üöó VEHICLE INFORMATION
                </div>
                <table cellpadding="0" cellspacing="0" border="0" style="background-color: #e8f5e9; padding: 25px; border-radius: 8px; width: 100%; border: 1px solid #c8e6c9;">
                    <tbody>
                        @{if(not(empty(coalesce(triggerBody()?['body']?['vehicleType'], triggerBody()?['vehicleType'], triggerBody()?['body']?['trackingData']?['visitorData']?['vehicleType'], triggerBody()?['trackingData']?['visitorData']?['vehicleType']))), concat('<tr><td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #c8e6c9; vertical-align: top;">Vehicle Type:</td><td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #c8e6c9;">', coalesce(triggerBody()?['body']?['vehicleType'], triggerBody()?['vehicleType'], triggerBody()?['body']?['trackingData']?['visitorData']?['vehicleType'], triggerBody()?['trackingData']?['visitorData']?['vehicleType'], 'Not provided'), '</td></tr>'), '')}
                        @{if(not(empty(coalesce(triggerBody()?['body']?['batteryVoltage'], triggerBody()?['batteryVoltage'], triggerBody()?['body']?['selectedVoltage'], triggerBody()?['selectedVoltage']))), concat('<tr><td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #c8e6c9; vertical-align: top;">Battery Type:</td><td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #c8e6c9;">', coalesce(triggerBody()?['body']?['batteryVoltage'], triggerBody()?['batteryVoltage'], triggerBody()?['body']?['selectedVoltage'], triggerBody()?['selectedVoltage']), '</td></tr>'), '')}
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #c8e6c9; vertical-align: top;">Registration:</td>
                            <td style="color: #2c3e50; font-size: 15px; font-weight: bold; padding: 12px 0; border-bottom: 1px solid #c8e6c9; letter-spacing: 1px;">@{if(empty(coalesce(triggerBody()?['body']?['rego'], triggerBody()?['rego'], triggerBody()?['body']?['vehicleRego'], triggerBody()?['vehicleRego'])), 'Not provided', toUpper(replace(trim(coalesce(triggerBody()?['body']?['rego'], triggerBody()?['rego'], triggerBody()?['body']?['vehicleRego'], triggerBody()?['vehicleRego'], '')), ' ', '')))}</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #c8e6c9; vertical-align: top;">Year:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #c8e6c9;">@{coalesce(triggerBody()?['body']?['year'], triggerBody()?['year'], triggerBody()?['body']?['vehicleYear'], triggerBody()?['vehicleYear'], 'Not provided')}</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; border-bottom: 1px solid #c8e6c9; vertical-align: top;">Make:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0; border-bottom: 1px solid #c8e6c9;">@{coalesce(triggerBody()?['body']?['make'], triggerBody()?['make'], triggerBody()?['body']?['vehicleMake'], triggerBody()?['vehicleMake'], 'Not provided')}</td>
                        </tr>
                        <tr>
                            <td style="font-weight: 600; color: #6c757d; min-width: 150px; font-size: 14px; padding: 12px 0; vertical-align: top;">Model:</td>
                            <td style="color: #2c3e50; font-size: 15px; padding: 12px 0;">@{coalesce(triggerBody()?['body']?['model'], triggerBody()?['model'], triggerBody()?['body']?['vehicleModel'], triggerBody()?['vehicleModel'], 'Not provided')}</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>

        <!-- Price Display -->
        <tr>
            <td style="padding: 0 30px 20px 30px;">
                <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; border: 2px solid #4caf50; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 14px; color: #558b2f; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Amount Paid</div>
                    <div style="font-size: 48px; font-weight: bold; color: #2e7d32; margin: 10px 0;">$@{coalesce(triggerBody()?['body']?['price'], triggerBody()?['price'], '0')}</div>
                    <div style="font-size: 15px; color: #558b2f; margin-top: 8px; font-weight: 600;">‚úÖ Payment Confirmed</div>
                </div>
            </td>
        </tr>

        <!-- What Happens Next -->
        <tr>
            <td style="padding: 0 30px 20px 30px;">
                <div style="background: #f8f9fa; padding: 14px 20px; margin: 0 0 20px 0; border-left: 4px solid #2ecc71; font-weight: bold; font-size: 17px; color: #2c3e50; border-radius: 4px 0 0 4px;">
                    üõ†Ô∏è WHAT HAPPENS NEXT
                </div>
                <div style="background: #e3f2fd; padding: 25px; border-radius: 8px; border: 1px solid #bbdefb;">
                    <div style="padding: 15px 0; border-bottom: 1px solid #bbdefb;">
                        <div style="font-weight: bold; color: #1565c0; margin-bottom: 8px; font-size: 16px;">üìã You're in the queue:</div>
                        <div style="color: #333; font-size: 15px; line-height: 1.7;">@{if(equals(coalesce(triggerBody()?['body']?['service'], triggerBody()?['service'], ''), 'inspection'), 'We will contact you before your scheduled inspection appointment.', if(equals(coalesce(triggerBody()?['body']?['urgencyLevel'], triggerBody()?['urgencyLevel'], 'standard'), 'scheduled'), 'We will contact you before your scheduled appointment.', 'We will be in contact shortly to confirm dispatch. Estimated wait time: 30-90 minutes.'))}</div>
                    </div>
                    <div style="padding: 15px 0; border-bottom: 1px solid #bbdefb;">
                        <div style="font-weight: bold; color: #1565c0; margin-bottom: 8px; font-size: 16px;">üöó ETA alerts:</div>
                        <div style="color: #333; font-size: 15px; line-height: 1.7;">Once a technician is assigned, you'll be notified of their estimated arrival.</div>
                    </div>
                    <div style="padding: 15px 0;">
                        <div style="font-weight: bold; color: #1565c0; margin-bottom: 8px; font-size: 16px;">üìß After the job:</div>
                        <div style="color: #333; font-size: 15px; line-height: 1.7;">You'll receive a formal invoice from Eek Mechanical.</div>
                    </div>
                </div>
            </td>
        </tr>

        <!-- Important Notes -->
        <tr>
            <td style="padding: 0 30px 20px 30px;">
                <div style="background: #f8f9fa; padding: 14px 20px; margin: 0 0 20px 0; border-left: 4px solid #2ecc71; font-weight: bold; font-size: 17px; color: #2c3e50; border-radius: 4px 0 0 4px;">
                    ‚ö†Ô∏è IMPORTANT NOTES
                </div>
                <div style="background: #fff3cd; padding: 25px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <div style="padding: 12px 0; font-size: 15px; line-height: 1.7; color: #856404;">‚Ä¢ The fee you've paid covers the <strong>BASE SERVICE ONLY</strong>.</div>
                    <div style="padding: 12px 0; font-size: 15px; line-height: 1.7; color: #856404;">‚Ä¢ Additional costs (e.g. distance, parts, tyres, labor) may apply and are charged by the technician on-site.</div>
                    <div style="padding: 12px 0; font-size: 15px; line-height: 1.7; color: #856404;">‚Ä¢ These must be paid directly to the technician before service is completed.</div>
                    <div style="padding: 12px 0; font-size: 15px; line-height: 1.7; color: #856404;">‚Ä¢ Not all issues can be resolved on-site. If needed, the technician may recommend a tow or workshop-based repair.</div>
                    <div style="padding: 15px 0 0 0; font-size: 15px;">
                        <a href="https://www.eek.nz/terms" style="color: #856404; font-weight: 600; text-decoration: underline;">üìÑ Terms &amp; Conditions: www.eek.nz/terms</a>
                    </div>
                </div>
            </td>
        </tr>

        <!-- Services Grid -->
        <tr>
            <td style="padding: 0 30px 20px 30px;">
                <div style="background: #f8f9fa; padding: 14px 20px; margin: 0 0 20px 0; border-left: 4px solid #2ecc71; font-weight: bold; font-size: 17px; color: #2c3e50; border-radius: 4px 0 0 4px;">
                    üîß OUR SERVICES
                </div>
                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                    <tbody>
                        <tr>
                            <td style="background: #f8f9fa; padding: 12px 15px; border-radius: 6px; font-size: 14px; width: 48%; border: 1px solid #e9ecef;">‚úì Jump starts</td>
                            <td style="width: 4%;"></td>
                            <td style="background: #f8f9fa; padding: 12px 15px; border-radius: 6px; font-size: 14px; width: 48%; border: 1px solid #e9ecef;">‚úì Tyre changes</td>
                        </tr>
                        <tr><td colspan="3" style="height: 10px;"></td></tr>
                        <tr>
                            <td style="background: #f8f9fa; padding: 12px 15px; border-radius: 6px; font-size: 14px; border: 1px solid #e9ecef;">‚úì Lockouts and unlocks</td>
                            <td style="width: 4%;"></td>
                            <td style="background: #f8f9fa; padding: 12px 15px; border-radius: 6px; font-size: 14px; border: 1px solid #e9ecef;">‚úì Mobile mechanical</td>
                        </tr>
                        <tr><td colspan="3" style="height: 10px;"></td></tr>
                        <tr>
                            <td style="background: #f8f9fa; padding: 12px 15px; border-radius: 6px; font-size: 14px; border: 1px solid #e9ecef;">‚úì Pre-purchase inspections</td>
                            <td style="width: 4%;"></td>
                            <td style="background: #f8f9fa; padding: 12px 15px; border-radius: 6px; font-size: 14px; border: 1px solid #e9ecef;">‚úì 24/7 across New Zealand</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>

        <!-- Footer -->
        <tr>
            <td style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 40px 30px; text-align: center; border-radius: 0 0 8px 8px;">
                <strong style="font-size: 24px; letter-spacing: 1px;">EEK MECHANICAL</strong>
                <div style="margin: 15px 0 20px 0; color: #95a5a6; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">CUSTOMER SUPPORT</div>
                <div style="margin-top: 20px; font-size: 16px; line-height: 1.8;">
                    üìû <strong style="font-size: 18px;">09 872 4612</strong>
                    <br>
                    üåê <a href="https://www.eek.nz" style="color: #3498db; text-decoration: none; font-weight: 600;">www.eek.nz</a>
                    <br><br>
                    <em style="color: #95a5a6; font-size: 13px;">24/7 Emergency Roadside Assistance</em>
                </div>
            </td>
        </tr>
    </tbody>
</table>











