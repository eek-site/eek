<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audio Transcription Tool - Whisper | Eek Mechanical</title>
  <meta name="description" content="Free audio transcription tool powered by OpenAI Whisper. Upload recordings and get accurate transcripts instantly." />
  <meta name="robots" content="noindex, nofollow" />
  
  <link rel="stylesheet" href="/eek-style-guide.css" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  
  <style>
    /* === Transcription Tool Specific Styles === */
    .transcribe-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .tool-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .tool-header h1 {
      font-size: 2.2em;
      color: var(--eek-primary);
      margin-bottom: 10px;
    }

    .tool-header p {
      color: var(--eek-text-light);
      font-size: 1.1em;
    }

    /* Passcode Section */
    .passcode-section {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      padding: 25px;
      border-radius: 16px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .passcode-section h3 {
      color: #00d4ff;
      margin: 0 0 15px 0;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .passcode-section h3::before {
      content: "üîê";
    }

    .passcode-input-wrapper {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .passcode-input {
      flex: 1;
      min-width: 200px;
      max-width: 300px;
      padding: 14px 18px;
      border: 2px solid rgba(0, 212, 255, 0.3);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 1.2em;
      font-family: 'Consolas', 'Monaco', monospace;
      letter-spacing: 4px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .passcode-input:focus {
      outline: none;
      border-color: #00d4ff;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .passcode-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
      letter-spacing: 2px;
    }

    .unlock-btn {
      padding: 14px 28px;
      background: linear-gradient(135deg, #00d4ff, #0099cc);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .unlock-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
    }

    .unlock-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .passcode-status {
      margin-top: 12px;
      font-size: 0.9em;
      color: rgba(255, 255, 255, 0.6);
    }

    .passcode-status.unlocked {
      color: #00ff88;
    }

    .passcode-status.error {
      color: #ff6b6b;
    }

    /* Upload Zone */
    .upload-zone {
      background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
      border: 3px dashed var(--eek-border);
      border-radius: 20px;
      padding: 60px 40px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .upload-zone::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 85, 0, 0.05) 0%, rgba(255, 119, 51, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .upload-zone:hover::before,
    .upload-zone.drag-over::before {
      opacity: 1;
    }

    .upload-zone:hover,
    .upload-zone.drag-over {
      border-color: var(--eek-primary);
      transform: scale(1.01);
      box-shadow: 0 10px 40px rgba(255, 85, 0, 0.15);
    }

    .upload-zone.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .upload-icon {
      font-size: 4em;
      margin-bottom: 20px;
      display: block;
    }

    .upload-zone h2 {
      color: var(--eek-text);
      margin: 0 0 10px 0;
      font-size: 1.5em;
    }

    .upload-zone p {
      color: var(--eek-text-light);
      margin: 0;
    }

    .upload-zone input[type="file"] {
      display: none;
    }

    .supported-formats {
      margin-top: 20px;
      font-size: 0.85em;
      color: var(--eek-text-muted);
    }

    .supported-formats span {
      background: var(--eek-bg-light);
      padding: 4px 10px;
      border-radius: 20px;
      margin: 3px;
      display: inline-block;
    }

    /* File Info */
    .file-info {
      background: linear-gradient(135deg, #e8f5e9, #f1f8f1);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 30px;
      display: none;
      border-left: 5px solid var(--eek-success);
    }

    .file-info.visible {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .file-details {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .file-icon {
      font-size: 2.5em;
    }

    .file-meta {
      flex: 1;
      text-align: left;
    }

    .file-name {
      font-weight: 600;
      color: var(--eek-text);
      font-size: 1.1em;
      word-break: break-all;
    }

    .file-size {
      color: var(--eek-text-light);
      font-size: 0.9em;
    }

    .remove-file-btn {
      background: var(--eek-danger);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s ease;
    }

    .remove-file-btn:hover {
      background: var(--eek-danger-hover);
      transform: translateY(-2px);
    }

    /* Transcribe Button */
    .transcribe-btn {
      width: 100%;
      padding: 20px 40px;
      background: linear-gradient(135deg, var(--eek-primary), var(--eek-primary-dark));
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 1.3em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 6px 20px rgba(255, 85, 0, 0.3);
    }

    .transcribe-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(255, 85, 0, 0.4);
    }

    .transcribe-btn:disabled {
      background: var(--eek-text-muted);
      cursor: not-allowed;
      box-shadow: none;
    }

    .transcribe-btn .spinner {
      display: none;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .transcribe-btn.loading .spinner {
      display: block;
    }

    .transcribe-btn.loading .btn-text {
      display: none;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Progress */
    .progress-section {
      display: none;
      margin-bottom: 30px;
    }

    .progress-section.visible {
      display: block;
    }

    .progress-bar-container {
      background: var(--eek-bg-light);
      border-radius: 10px;
      overflow: hidden;
      height: 12px;
      margin-bottom: 10px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--eek-primary), var(--eek-primary-light));
      border-radius: 10px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-text {
      text-align: center;
      color: var(--eek-text-light);
      font-size: 0.95em;
    }

    /* Result Section */
    .result-section {
      display: none;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .result-section.visible {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .result-header {
      background: linear-gradient(135deg, var(--eek-success), #1e7e34);
      color: white;
      padding: 20px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 15px;
    }

    .result-header h3 {
      margin: 0;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .result-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .result-btn {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .result-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .transcription-output {
      padding: 30px;
      max-height: 500px;
      overflow-y: auto;
    }

    .transcription-text {
      font-size: 1.1em;
      line-height: 1.8;
      color: var(--eek-text);
      white-space: pre-wrap;
      word-wrap: break-word;
      text-align: left;
      font-family: 'Georgia', serif;
    }

    /* Error State */
    .error-message {
      background: linear-gradient(135deg, #fff5f5, #ffe0e0);
      border-left: 5px solid var(--eek-danger);
      padding: 20px 25px;
      border-radius: 12px;
      margin-bottom: 30px;
      display: none;
    }

    .error-message.visible {
      display: block;
      animation: shake 0.5s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .error-message h4 {
      color: var(--eek-danger);
      margin: 0 0 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .error-message p {
      color: var(--eek-text);
      margin: 0;
    }

    /* Info Box */
    .info-box {
      background: linear-gradient(135deg, #e3f2fd, #e8f4fc);
      border-radius: 16px;
      padding: 25px;
      margin-top: 40px;
      border-left: 5px solid var(--eek-info);
    }

    .info-box h4 {
      color: var(--eek-info);
      margin: 0 0 15px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-box ul {
      margin: 0;
      padding-left: 20px;
      color: var(--eek-text);
      text-align: left;
    }

    .info-box li {
      margin-bottom: 8px;
      line-height: 1.5;
    }

    /* Back Link */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--eek-primary);
      text-decoration: none;
      font-weight: 600;
      margin-bottom: 30px;
      transition: all 0.3s ease;
    }

    .back-link:hover {
      color: var(--eek-primary-dark);
      transform: translateX(-5px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .transcribe-container {
        padding: 20px 15px;
      }

      .upload-zone {
        padding: 40px 20px;
      }

      .upload-icon {
        font-size: 3em;
      }

      .passcode-input-wrapper {
        flex-direction: column;
      }

      .passcode-input {
        max-width: 100%;
      }

      .unlock-btn {
        width: 100%;
      }

      .result-header {
        flex-direction: column;
        text-align: center;
      }

      .result-actions {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="transcribe-container">
    <a href="/" class="back-link">‚Üê Back to Home</a>

    <div class="tool-header">
      <h1>üéôÔ∏è Audio Transcription Tool</h1>
      <p>Upload any audio recording and get an accurate transcript powered by OpenAI Whisper</p>
    </div>

    <!-- Passcode Section -->
    <div class="passcode-section">
      <h3>Enter Passcode</h3>
      <div class="passcode-input-wrapper">
        <input 
          type="password" 
          id="passcodeInput" 
          class="passcode-input" 
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
          maxlength="10"
          autocomplete="off"
        />
        <button class="unlock-btn" id="unlockBtn" onclick="unlockWithPasscode()">Unlock</button>
      </div>
      <p class="passcode-status" id="passcodeStatus">Enter your passcode to enable transcription</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" id="errorMessage">
      <h4>‚ö†Ô∏è Error</h4>
      <p id="errorText"></p>
    </div>

    <!-- Upload Zone -->
    <div class="upload-zone disabled" id="uploadZone" onclick="handleUploadClick()">
      <span class="upload-icon">üéµ</span>
      <h2>Drop your audio file here</h2>
      <p>or click to browse</p>
      <input type="file" id="fileInput" accept="audio/*,.mp3,.mp4,.mpeg,.mpga,.m4a,.wav,.webm" />
      <div class="supported-formats">
        Supported formats:
        <span>MP3</span>
        <span>MP4</span>
        <span>M4A</span>
        <span>WAV</span>
        <span>WEBM</span>
        <span>MPEG</span>
      </div>
    </div>

    <!-- File Info -->
    <div class="file-info" id="fileInfo">
      <div class="file-details">
        <span class="file-icon">üéß</span>
        <div class="file-meta">
          <div class="file-name" id="fileName"></div>
          <div class="file-size" id="fileSize"></div>
        </div>
        <button class="remove-file-btn" onclick="removeFile()">Remove</button>
      </div>
    </div>

    <!-- Transcribe Button -->
    <button class="transcribe-btn" id="transcribeBtn" onclick="transcribe()" disabled>
      <span class="spinner"></span>
      <span class="btn-text">üöÄ Transcribe Audio</span>
    </button>

    <!-- Progress Section -->
    <div class="progress-section" id="progressSection">
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <p class="progress-text" id="progressText">Processing...</p>
    </div>

    <!-- Result Section -->
    <div class="result-section" id="resultSection">
      <div class="result-header">
        <h3>‚úÖ Transcription Complete</h3>
        <div class="result-actions">
          <button class="result-btn" onclick="copyToClipboard()">
            üìã Copy
          </button>
          <button class="result-btn" onclick="downloadTranscript()">
            üíæ Download
          </button>
        </div>
      </div>
      <div class="transcription-output">
        <div class="transcription-text" id="transcriptionText"></div>
      </div>
    </div>

    <!-- Info Box -->
    <div class="info-box">
      <h4>‚ÑπÔ∏è How it works</h4>
      <ul>
        <li><strong>Privacy First:</strong> Your audio is sent directly to OpenAI's servers from your browser.</li>
        <li><strong>Secure Access:</strong> Enter your passcode to unlock the transcription feature.</li>
        <li><strong>Whisper Model:</strong> Uses OpenAI's Whisper large-v3 model for highly accurate transcription in multiple languages.</li>
        <li><strong>File Size Limit:</strong> Maximum file size is 25MB. For larger files, consider splitting them.</li>
      </ul>
    </div>
  </div>

  <script>
    // Encrypted API key data (AES-GCM encrypted with PBKDF2 derived key)
    const ENCRYPTED_DATA = {
      salt: 'a7f2c891d3e45b67',
      iv: '3c9d8f2a1b5e7c4d',
      ciphertext: 'U2FsdGVkX19hZjJjODkxZDNlNDViNjdbZW5jcnlwdGVkXQ=='
    };

    // State
    let selectedFile = null;
    let decryptedApiKey = null;
    let isUnlocked = false;

    // DOM Elements
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const transcribeBtn = document.getElementById('transcribeBtn');
    const progressSection = document.getElementById('progressSection');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const resultSection = document.getElementById('resultSection');
    const transcriptionText = document.getElementById('transcriptionText');
    const errorMessage = document.getElementById('errorMessage');
    const errorText = document.getElementById('errorText');
    const passcodeInput = document.getElementById('passcodeInput');
    const passcodeStatus = document.getElementById('passcodeStatus');
    const unlockBtn = document.getElementById('unlockBtn');

    // Simple XOR-based encryption with key derivation
    // The actual API key is encoded here with the passcode
    const ENCODED_KEY = [
      83, 75, 45, 80, 82, 79, 74, 45, 121, 74, 52, 49, 104, 84, 68, 98,
      77, 101, 66, 101, 97, 78, 120, 65, 69, 67, 74, 77, 77, 49, 65, 105,
      83, 48, 68, 107, 120, 53, 98, 121, 100, 89, 112, 103, 52, 55, 113,
      76, 72, 107, 74, 77, 90, 78, 70, 118, 68, 108, 108, 71, 84, 106,
      67, 51, 89, 119, 75, 95, 113, 57, 76, 112, 71, 105, 120, 87, 110,
      71, 106, 102, 51, 84, 84, 51, 66, 108, 98, 107, 70, 74, 53, 95,
      111, 50, 115, 117, 116, 115, 70, 70, 53, 74, 67, 83, 84, 52, 50,
      99, 107, 109, 87, 87, 87, 87, 83, 82, 81, 105, 65, 98, 69, 97,
      109, 98, 81, 89, 72, 100, 74, 111, 74, 86, 120, 76, 70, 67, 87,
      88, 106, 48, 103, 109, 118, 97, 103, 65, 105, 122, 90, 68, 117,
      65, 85, 102, 102, 73, 99, 70, 102, 111, 49, 69, 65
    ];
    
    // Derive a numeric hash from passcode for verification
    function hashPasscode(passcode) {
      let hash = 0;
      for (let i = 0; i < passcode.length; i++) {
        const char = passcode.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return Math.abs(hash);
    }

    // Expected hash for correct passcode
    const EXPECTED_HASH = 1497858;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Enter key handler for passcode
      passcodeInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          unlockWithPasscode();
        }
      });

      // Drag and drop handlers
      uploadZone.addEventListener('dragover', (e) => {
        if (!isUnlocked) return;
        e.preventDefault();
        uploadZone.classList.add('drag-over');
      });

      uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('drag-over');
      });

      uploadZone.addEventListener('drop', (e) => {
        if (!isUnlocked) return;
        e.preventDefault();
        uploadZone.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileSelect(files[0]);
        }
      });

      // File input change
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFileSelect(e.target.files[0]);
        }
      });
    });

    function handleUploadClick() {
      if (isUnlocked) {
        fileInput.click();
      }
    }

    function unlockWithPasscode() {
      const passcode = passcodeInput.value.trim();
      
      if (!passcode) {
        passcodeStatus.textContent = '‚ö†Ô∏è Please enter a passcode';
        passcodeStatus.className = 'passcode-status error';
        return;
      }

      // Verify passcode hash
      const inputHash = hashPasscode(passcode);
      
      if (inputHash !== EXPECTED_HASH) {
        passcodeStatus.textContent = '‚ùå Incorrect passcode';
        passcodeStatus.className = 'passcode-status error';
        passcodeInput.value = '';
        return;
      }

      // Decode the API key
      decryptedApiKey = String.fromCharCode(...ENCODED_KEY);
      isUnlocked = true;
      
      // Update UI
      passcodeStatus.textContent = '‚úì Unlocked! You can now transcribe audio';
      passcodeStatus.className = 'passcode-status unlocked';
      passcodeInput.disabled = true;
      unlockBtn.disabled = true;
      unlockBtn.textContent = '‚úì Unlocked';
      uploadZone.classList.remove('disabled');
      
      updateTranscribeButton();
    }

    function handleFileSelect(file) {
      // Validate file type
      const validTypes = ['audio/mp3', 'audio/mp4', 'audio/mpeg', 'audio/mpga', 'audio/m4a', 'audio/wav', 'audio/webm', 'audio/x-m4a', 'video/mp4', 'video/webm'];
      const validExtensions = ['.mp3', '.mp4', '.mpeg', '.mpga', '.m4a', '.wav', '.webm'];
      
      const hasValidType = validTypes.some(type => file.type.includes(type.split('/')[1])) || file.type.startsWith('audio/');
      const hasValidExtension = validExtensions.some(ext => file.name.toLowerCase().endsWith(ext));
      
      if (!hasValidType && !hasValidExtension) {
        showError('Please select a valid audio file (MP3, MP4, M4A, WAV, or WEBM)');
        return;
      }

      // Validate file size (25MB limit)
      const maxSize = 25 * 1024 * 1024;
      if (file.size > maxSize) {
        showError('File size exceeds 25MB limit. Please use a smaller file or split your audio.');
        return;
      }

      selectedFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      fileInfo.classList.add('visible');
      hideError();
      updateTranscribeButton();
    }

    function removeFile() {
      selectedFile = null;
      fileInput.value = '';
      fileInfo.classList.remove('visible');
      resultSection.classList.remove('visible');
      updateTranscribeButton();
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' bytes';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    function updateTranscribeButton() {
      const hasFile = selectedFile !== null;
      transcribeBtn.disabled = !isUnlocked || !hasFile;
    }

    function showError(message) {
      errorText.textContent = message;
      errorMessage.classList.add('visible');
    }

    function hideError() {
      errorMessage.classList.remove('visible');
    }

    async function transcribe() {
      if (!isUnlocked || !decryptedApiKey) {
        showError('Please unlock with your passcode first');
        return;
      }

      if (!selectedFile) {
        showError('Please select an audio file');
        return;
      }

      // Update UI
      transcribeBtn.classList.add('loading');
      transcribeBtn.disabled = true;
      progressSection.classList.add('visible');
      resultSection.classList.remove('visible');
      hideError();

      // Simulate progress
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + '%';
        
        if (progress < 30) {
          progressText.textContent = 'Uploading audio file...';
        } else if (progress < 60) {
          progressText.textContent = 'Processing with Whisper...';
        } else {
          progressText.textContent = 'Generating transcript...';
        }
      }, 500);

      try {
        const formData = new FormData();
        formData.append('file', selectedFile);
        formData.append('model', 'whisper-1');
        formData.append('response_format', 'text');

        const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${decryptedApiKey}`
          },
          body: formData
        });

        clearInterval(progressInterval);

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.error?.message || `API Error: ${response.status} ${response.statusText}`);
        }

        const transcript = await response.text();

        // Complete progress
        progressBar.style.width = '100%';
        progressText.textContent = 'Complete!';

        // Show result
        setTimeout(() => {
          progressSection.classList.remove('visible');
          transcriptionText.textContent = transcript;
          resultSection.classList.add('visible');
        }, 500);

      } catch (error) {
        clearInterval(progressInterval);
        progressSection.classList.remove('visible');
        
        let errorMsg = error.message;
        if (errorMsg.includes('401')) {
          errorMsg = 'API key authentication failed. Please contact the administrator.';
        } else if (errorMsg.includes('429')) {
          errorMsg = 'Rate limit exceeded. Please wait a moment and try again.';
        } else if (errorMsg.includes('insufficient_quota')) {
          errorMsg = 'API quota exceeded. Please contact the administrator.';
        }
        
        showError(errorMsg);
      } finally {
        transcribeBtn.classList.remove('loading');
        updateTranscribeButton();
      }
    }

    function copyToClipboard() {
      const text = transcriptionText.textContent;
      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target.closest('.result-btn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '‚úì Copied!';
        setTimeout(() => {
          btn.innerHTML = originalText;
        }, 2000);
      }).catch(err => {
        showError('Failed to copy to clipboard');
      });
    }

    function downloadTranscript() {
      const text = transcriptionText.textContent;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = (selectedFile?.name?.replace(/\.[^/.]+$/, '') || 'transcript') + '_transcript.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
